function getPrescription(){commerceItemInfo.prescription={},commerceItemInfo.prescription.prescriptionType=$("#prescriptionType").children("option:selected").val(),commerceItemInfo.prescription.odSph=$("#odSph").children("option:selected").val(),commerceItemInfo.prescription.osSph=$("#osSph").children("option:selected").val(),commerceItemInfo.prescription.odCyl=$("#odCyl").children("option:selected").val(),commerceItemInfo.prescription.osCyl=$("#osCyl").children("option:selected").val(),commerceItemInfo.prescription.odAxis=$("#odAxis").children("option:selected").val(),commerceItemInfo.prescription.osAxis=$("#osAxis").children("option:selected").val(),commerceItemInfo.prescription.nvAdd=$("#nvAdd").children("option:selected").val(),commerceItemInfo.prescription.odPrismValueVertical=$("#odPrismValueVertical").children("option:selected").val(),commerceItemInfo.prescription.odBaseDirectionVertical=$("#odBaseDirectionVertical").children("option:selected").val(),commerceItemInfo.prescription.osPrismValueVertical=$("#osPrismValueVertical").children("option:selected").val(),commerceItemInfo.prescription.osBaseDirectionVertical=$("#osBaseDirectionVertical").children("option:selected").val(),commerceItemInfo.prescription.odPrismValueHorizontal=$("#odPrismValueHorizontal").children("option:selected").val(),commerceItemInfo.prescription.odBaseDirectionHorizontal=$("#odBaseDirectionHorizontal").children("option:selected").val(),commerceItemInfo.prescription.osPrismValueHorizontal=$("#osPrismValueHorizontal").children("option:selected").val(),commerceItemInfo.prescription.osBaseDirectionHorizontal=$("#osBaseDirectionHorizontal").children("option:selected").val(),commerceItemInfo.prescription.pdSingle=$("#pdSingle").children("option:selected").val(),commerceItemInfo.prescription.pdRight=$("#pdRight").children("option:selected").val(),commerceItemInfo.prescription.pdLeft=$("#pdLeft").children("option:selected").val(),commerceItemInfo.prescription.prescriptionSavedName=$("#prescriptionSavedName").val(),commerceItemInfo.prescription.prescriptionSavedMonth=$("#prescriptionSavedMonth").children("option:selected").val(),commerceItemInfo.prescription.prescriptionSavedDay=$("#prescriptionSavedDay").children("option:selected").val(),commerceItemInfo.prescription.prescriptionSavedYear=$("#prescriptionSavedYear").children("option:selected").val(),commerceItemInfo.prescription.prescriptionRenewMonths=$("#prescriptionRenewMonths").children("option:selected").val(),commerceItemInfo.prescription.singlePd=$('input:radio[class="pdGroupRadio"]:checked').val(),commerceItemInfo.prescription.prescriptionIsToBeSaved=$("#prescriptionIsToBeSaved").is(":checked"),commerceItemInfo.prescription.prescriptionIsRenew=$("#prescriptionIsRenew").is(":checked"),commerceItemInfo.prescription.prismEnabled=$('input:radio[class="prismGroupRadio"]:checked').val()}function orderNextClick(step){var step_desc;if(step)switch(step){case"1":step_desc="1 RX";break;case"2":step_desc="2 Lenses";break;case"3":step_desc="3 Add-Ons"}var skuId=$("#skuId").val();if(dataLayer.push({event:"trackEvent",eventCategory:"Full Checkout Process",Step:step_desc,id:skuId}),"3"==step){var addToCartBtn=$("#addonFormId").find("div.addToCart"),total=$(addToCartBtn).find("div.innerBox input#subTotal").val(),quantity=$(addToCartBtn).find("div.innerBox div.qtyMsg span.select label").text();dataLayer.push({event:"addToCart",ecommerce:{add:{products:[{id:skuId,price:total,quantity:quantity,dimension16:"true"}]}}})}}function sendGAOrderInteraction(step,eventLabel){var eventAction;if(step)switch(step){case"1":eventAction="Step 1 RX";break;case"2":eventAction="Step 2 Lenses";break;case"3":eventAction="Step 3 Add-Ons"}dataLayer.push({event:"trackEvent",eventCategory:"Checkout Interaction",eventAction:eventAction,eventLabel:eventLabel})}function sendGAHoverInteraction(step,eventLabel){eventLabel="Hover - "+eventLabel,sendGAOrderInteraction(step,eventLabel)}function sendGAHoverInteractionByKey(step,key,pageId,defaultLabel){var eventAction;if(step)switch(step){case"1":eventAction="Step 1 RX";break;case"2":eventAction="Step 2 Lenses";break;case"3":eventAction="Step 3 Add-Ons"}$.ajax({dataType:"json",async:!1,data:{event:"trackEvent",eventCategory:"Check Interaction",eventAction:eventAction,key:key,pageId:pageId,defaultLabel:defaultLabel},url:"/common/analysis/order_interaction_helpmark_hover.jsp",success:function(data){data&&data.result&&dataLayer.push(data.result)},error:function(){console.log("[sendGAOrderInteractionByKey]can not get json array!")}})}function showConfirmationPopup(){$(this).acsPopup({popupContentPreload:$("#prescTable #presTabCon"),popupTitle:"<h3>Does this match your prescription?</h3><p>Please double check the (+/-) value for both Sphere and Cylinder</p>",initWidth:720,initHeight:"auto",popupID:"confirm_prescPop",callBack:function(setting){setPrescModal(prescArr,prismArr),$("body").off("click",".btnEdit"),$("body").on("click",".btnEdit",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)}),$("body").off("click","#confirm_prescPop .btnConfirm"),$("body").on("click","#confirm_prescPop .btnConfirm",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting),submitPrescription()})}}),$(".popupContent .btnConfirm").focus()}function validatePrescription(){getPrescription();var prescriptionType=$("#prescriptionType").children("option:selected").val();if(""==prescriptionType)return $("#prescriptionType").parent().parent().find("span:first-child").addClass("error"),void showSingalErrorMessage(prescriptionErrorContainer.noPrescriptionTypeError,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"!=commerceItemInfo.prescription.odPrismValueHorizontal&&""==commerceItemInfo.prescription.odBaseDirectionHorizontal)return $("#odPrismValueHorizontal").parent().addClass("error"),$("#odBaseDirectionHorizontal").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismDirectionNull.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"==commerceItemInfo.prescription.odPrismValueHorizontal&&""!=commerceItemInfo.prescription.odBaseDirectionHorizontal)return $("#odPrismValueHorizontal").parent().addClass("error"),$("#odBaseDirectionHorizontal").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismValueAndDirection.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"!=commerceItemInfo.prescription.odPrismValueVertical&&""==commerceItemInfo.prescription.odBaseDirectionVertical)return $("#odPrismValueVertical").parent().addClass("error"),$("#odBaseDirectionVertical").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismDirectionNull.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"==commerceItemInfo.prescription.odPrismValueVertical&&""!=commerceItemInfo.prescription.odBaseDirectionVertical)return $("#odPrismValueVertical").parent().addClass("error"),$("#odBaseDirectionVertical").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismValueAndDirection.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"!=commerceItemInfo.prescription.osPrismValueHorizontal&&""==commerceItemInfo.prescription.osBaseDirectionHorizontal)return $("#osPrismValueHorizontal").parent().addClass("error"),$("#osBaseDirectionHorizontal").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismDirectionNull.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"==commerceItemInfo.prescription.osPrismValueHorizontal&&""!=commerceItemInfo.prescription.osBaseDirectionHorizontal)return $("#osPrismValueHorizontal").parent().addClass("error"),$("#osBaseDirectionHorizontal").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismValueAndDirection.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"!=commerceItemInfo.prescription.osPrismValueVertical&&""==commerceItemInfo.prescription.osBaseDirectionVertical)return $("#osPrismValueVertical").parent().addClass("error"),$("#osBaseDirectionVertical").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismDirectionNull.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("0.00"==commerceItemInfo.prescription.osPrismValueVertical&&""!=commerceItemInfo.prescription.osBaseDirectionVertical)return $("#osPrismValueVertical").parent().addClass("error"),$("#osBaseDirectionVertical").parent().addClass("error"),void showSingalErrorMessage(PrescriptionRules.validateOdPrismValueAndDirection.error,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);if("nonPrescription"==prescriptionType||"frameOnly"==prescriptionType)return void submitPrescription();var isSaved=$("#prescriptionIsToBeSaved").is(":checked"),saveName=$("#prescriptionSavedName").val();if(saveName.match(/[<>]/g)&&$("#prescriptionSavedName").val(saveName.replace(/[<>]/g,"+")),isSaved&&""==saveName)return $("#prescriptionSavedName").addClass("error"),void showSingalErrorMessage(prescriptionErrorContainer.emptyPrescriptionName,"prescriptionErrorSection",prescriptionErrorContainer.errorHead);commerceItemInfo.lensShape;targetElement.length=0,errorMessage.msgs=new Array,warningMessage.msgs=new Array;var result=validateAll();splitMessage(result);var length=result.length,isAllWarning=isAllWarningMessage(result),hasComfirmPopWindow=$("#confirm_prescPop").length||$(".popupCov").length;if(0==length){if($("#prescriptionIsToBeSavedLabel").hasClass("checked")&&"undefined"!=typeof dataLayer){var skuId=$("#skuId").val(),prescriptionType=$("#prescriptionType").val();dataLayer.push({event:"zenni_event",eventCategory:"Product Detail",operation:"Add Prescription",eventLabel:prescriptionType,skuId:skuId})}var prescType=$.trim($("#prescriptionType").val()),currentObj=commerceItemInfo.prescription;"SingleVision"==prescType&&"0.00"===currentObj.odSph&&"0.00"===currentObj.osSph&&"0.00"===currentObj.osCyl&&"0.00"===currentObj.odCyl&&"0"===currentObj.osAxis&&"0"===currentObj.odAxis||hasComfirmPopWindow||showConfirmationPopup()}isAllWarning&&0!=length&&!hasComfirmPopWindow&&showWarningMessage(),isAllWarning||0==length||hasComfirmPopWindow||(showPrescriptionErrorMessage(),addErrorTip())}function splitMessage(result){for(var length=result.length,i=0;i<=length-1;i++){var failedresult=result[i];"warning"==failedresult.messageType?warningMessage.msgs.push(failedresult.message):errorMessage.msgs.push(failedresult.message)}}function addErrorTip(){jQuery.each(targetElement,function(index,domEle){$("#"+domEle).closest(".select").addClass("error")}),"true"==commerceItemInfo.prescription.singlePd?($("#pdRight").parent().parent().find("span:first-child").removeClass("error"),$("#pdLeft").parent().parent().find("span:first-child").removeClass("error")):$("#pdSingle").parent().parent().find("span:first-child").removeClass("error")}function isAllWarningMessage(errorMessage){for(var length=errorMessage.length,sum=0,i=0;i<=length-1;i++){var failedresult=errorMessage[i];"warning"==failedresult.messageType&&(sum+=1)}return sum==length}function submitLensForm(){orderNextClick("2");var selectedLensSku=$("#lensFormId .tlist span.radio.checked").find('input:radio[class="lensRadio"]').val(),selectedTintProduct=$("#lensFormId .tlist span.radio.checked").find('input:radio[class="tintRadio"]').val();if("undefined"==typeof selectedLensSku)return showSingalErrorMessage(prescriptionErrorContainer.lensSectionInfo,"lensSectionError",prescriptionErrorContainer.lensSectionTitle),!1;if("undefined"!=typeof selectedTintProduct){var selectedTint=$("#"+selectedTintProduct).children("option:selected").val();if(""==selectedTint)return showSingalErrorMessage(prescriptionErrorContainer.tintErrorInfo,"lensSectionError",prescriptionErrorContainer.tintErrorTitle),!1;$("#tintSkuId").val(selectedTint)}var form=$("#lensFormId");$("#lensInfo").css("position","relative"),$("#lensInfo").append("<div class='loading'><span></span></div>"),form.ajaxSubmit({type:"post",dataType:"html",url:"/productdetail/lensInfo_form.jsp",success:function(data){if("error"==data)showSingalErrorMessage(prescriptionErrorContainer.backendErrorForLense,"processLense",prescriptionErrorContainer.errorTitle);else{var responseDate=$(data),prescriptInfo=responseDate.find("#prescriptInfo").html();$("#prescriptInfo").html(prescriptInfo);var lensInfo=responseDate.find("#lensInfo").html();$("#lensInfo").html(lensInfo);var addOnsInfo=responseDate.find("#addOnsInfo").html();$("#addOnsInfo").html(addOnsInfo),$("#addOnsInfo").removeClass("disable"),$.pdpCommonUtils.doAnimate($("#addOnsInfo"));var orderSummary=responseDate.find("#orderItem").html();$("#orderItem").html(orderSummary),calcPrice();var exchargeDetail=responseDate.find("#lensExcharge").html(),exchargeDetailTrim=$.trim(exchargeDetail);if(""!=exchargeDetailTrim&&showSingalErrorMessage(exchargeDetailTrim,"exchargeMessage",prescriptionErrorContainer.exchargeFeeTitle),"undefined"!=typeof dataLayer){var skuId=$("#skuId").val(),lensSelected="Lens-"+$(".radio.checked input:radio").val();dataLayer.push({event:"zenni_event",eventCategory:"Product Detail",operation:"Lens Selected",eventLabel:lensSelected,skuId:skuId})}}},error:function(data){window.location.reload()}})}function validateAll(){var errorMessage=new Array;for(var validateFunction in PrescriptionRules){var functionBody=PrescriptionRules[validateFunction];if(jQuery.isFunction(functionBody)){var targetElementName=PrescriptionRules[validateFunction][elementName],targetEventName=PrescriptionRules[validateFunction][eventName];if("undefined"!=typeof targetEventName&&"undefined"!=typeof targetElementName&&"prescriptionNext"==targetElementName&&"onclick"==targetEventName){var callFunction="PrescriptionRules."+validateFunction+"(commerceItemInfo)",evalValue=eval(callFunction);"success"!=evalValue&&errorMessage.push(getMessage(PrescriptionRules,validateFunction,evalValue))}}}return errorMessage}function getMessage(functionGroup,functionName,messageProperty){var message=functionGroup[functionName][messageProperty],validateResult={messageType:messageProperty,message:message},singalTargetElement=functionGroup[functionName].targetElement;return jQuery.each(singalTargetElement,function(index,domEle){targetElement.push(domEle)}),validateResult}function processOptions(){if("undefined"!=typeof PrescriptionRules){var prescriptionParameter=PrescriptionRules.prescriptionParameter;"undefined"!=typeof prescriptionParameter&&jQuery.each(prescriptionParameter,function(index,domEle){fillOption(index,domEle)}),fillUsageAndNose()}}function processDefaultValue(){if("undefined"!=typeof PrescriptionRules){var defaultValue=PrescriptionRules.defaultValue;"undefined"!=typeof defaultValue&&jQuery.each(defaultValue,function(index,domEle){$("#"+index).parent().find("label:first-child").text(domEle.defaultDisplay),jQuery("#"+index+" option[value='"+domEle.defaultValue+"']").attr("selected",!0)})}}function fillOption(targetId,targetOptions){for(var start=targetOptions.min,end=targetOptions.max,step=targetOptions.step,precision=targetOptions.precision,hasSymbol=targetOptions.hasSymbol,k=100*start;k<=100*end;k+=100*step){var optionVlaue=(k/100).toFixed(precision);optionVlaue>0&&hasSymbol?$("#"+targetId).append("<option value="+optionVlaue+">+"+optionVlaue+"</option>"):$("#"+targetId).append("<option value="+optionVlaue+">"+optionVlaue+"</option>")}}function fillUsageAndNose(){var usage=rxOpimization.usage,nosePos=rxOpimization.nosePos;jQuery.each(usage,function(index,domEle){0==index&&$("#purposeForGlass").parent().find("label:first-child").text(domEle.description),$("#purposeForGlass").append('<option value="'+domEle.code+'">'+domEle.description+"</option>")}),jQuery.each(nosePos,function(index,domEle){0==index&&$("#wearOnNose").parent().find("label:first-child").text(domEle.description),$("#wearOnNose").append('<option value="'+domEle.code+'">'+domEle.description+"</option>")})}function fillBaseDirection(){jQuery.each(prismDirection,function(index,domEle){$("#odPrismDirection").append('<option value="'+domEle.code+'">'+domEle.description+"</option>")}),jQuery.each(prismDirection,function(index,domEle){$("#osPrismDirection").append('<option value="'+domEle.code+'">'+domEle.description+"</option>")})}function bindEvent(){if("undefined"!=typeof PrescriptionRules){for(var validateFunction in PrescriptionRules){var functionBody=PrescriptionRules[validateFunction];if(jQuery.isFunction(functionBody)){var targetElementName=PrescriptionRules[validateFunction][elementName],targetEventName=PrescriptionRules[validateFunction][eventName];if("undefined"!=typeof targetEventName&&"undefined"!=typeof targetElementName){if("prescriptionNext"==targetElementName||"pdSingle"==targetElementName)continue;if("prescriptionType"==targetElementName){var change=validateFunction;$("#"+targetElementName).live(targetEventName,function(){PrescriptionRules[change]()});continue}if("odSph"==targetElementName){var changeSph=validateFunction;$("#"+targetElementName).live(targetEventName,function(){PrescriptionRules[changeSph]()}),$("#osSph").live(targetEventName,function(){PrescriptionRules[changeSph]()}),$("#odCyl").live(targetEventName,function(){PrescriptionRules[changeSph]()}),$("#osCyl").live(targetEventName,function(){PrescriptionRules[changeSph]()})}}}}$("#prescriptionNext").live("click",function(){orderNextClick("1"),validatePrescription(),$(this).blur()}),$("#prismInfo .select select").live("change",function(event){var orignTarget,distTarget,eventname=event.currentTarget.id;switch(eventname){case"odPrismValueHorizontal":orignTarget=$("#odPrismValueHorizontal"),distTarget=$("#odPrismValueVertical");break;case"odPrismValueVertical":orignTarget=$("#odPrismValueVertical"),distTarget=$("#odPrismValueHorizontal");break;case"osPrismValueHorizontal":orignTarget=$("#osPrismValueHorizontal"),distTarget=$("#osPrismValueVertical");break;case"osPrismValueVertical":orignTarget=$("#osPrismValueVertical"),distTarget=$("#osPrismValueHorizontal");break;default:return!0}var orignVal=$(this).val(),distVal=distTarget.parent(".select").find("label").text(),count=Math.pow(orignVal,2)+Math.pow(distVal,2),filterVal=Math.sqrt(25-Math.pow(orignVal,2));if(count>25){distTarget.parent(".select").find("label").text("0.00");var distoption=distTarget.parent(".select").find("option").eq(0);distoption.siblings().removeAttr("selected"),distoption.attr("selected",!0),distTarget.parents("dd").next().find("label").eq(0).text("Choose"),distTarget.parents("dd").next().find("select option").eq(0).attr("selected",!0).siblings().removeAttr("selected")}distTarget.find("option").removeClass("hidden").removeAttr("disabled",!0),distTarget.find("option").each(function(){var curVal=$(this).val()||$(this).text();curVal=parseFloat(curVal),curVal>filterVal&&$(this).addClass("hidden").attr("disabled",!0)})}),$("#pdSingle").live("change",function(){window.setTimeout(function(){validatePD(!0)},0)}),$("#pdRight").live("change",function(){window.setTimeout(function(){validatePD(!1)},0)}),$("#pdLeft").live("change",function(){window.setTimeout(function(){validatePD(!1)},0)}),$("#error_processPrescription .popupClose").live("click",function(){return $("#prescriptInfo").find(".loading").remove(),$("#prescriptInfo").removeClass("position"),!0}),$("#error_processLense .popupClose").live("click",function(){return $("#lensInfo").find(".loading").remove(),$("#lensInfo").removeClass("position"),!0}),$("#error_processPrescription .btnOK").live("click",function(){return $("#prescriptInfo").find(".loading").remove(),$("#prescriptInfo").removeClass("position"),!0}),$("#error_processLense .btnOK").live("click",function(){return $("#lensInfo").find(".loading").remove(),$("#lensInfo").removeClass("position"),!0})}}function showPCWarning(obj,title,warningStatus){if("TRUE"!=warningStatus)return!0;var skuId=$(obj).val();return"141"!=skuId?($(".radio .lensRadio").each(function(){$(this).closest("dl").find(".text-small").css("display","none")}),!0):($(".radio .lensRadio").each(function(){$(this).closest("dl").find(".text-small").css("display","none")}),void(title.toLowerCase().indexOf("polycarbonate")>0&&$(obj).closest("dl").find(".text-small").css("display","block")))}function changeLensSku(price,displayName,id,lensSkuId){var _windowId=$("#_windowId").val();$.get("/misc/ajax/productOrder/tintSection.jsp",{selectedLensSkuId:lensSkuId,_windowid:_windowId},function(data){var responseDate=$(data),lensTintChooseDom=responseDate.find("#lensTintChoose").html();$("#lensTintChoose").html(lensTintChooseDom),appendToOrderSummary(price,displayName,id),$("#lensPrice").val(price);var total=parseFloat($("#subtotal").val())+parseFloat($("#lensPrice").val())+parseFloat($("#tintPrice").val());$("#orderSummaryPrice").text("$"+total.toFixed(2)),addTintToOrderSummary()})}function addLensToOrderSummary(){var selectedLensSku=$('input:radio[class="lensRadio"]:checked').val(),t=$('input:radio[class="lensRadio"][value="'+selectedLensSku+'"]');if(void 0!=t){var orderSummaryId=t.attr("orderSummaryId");if(void 0!=orderSummaryId){var title=t.attr("title"),price=parseFloat(t.attr("price"));appendToOrderSummary(price.toFixed(2),title,orderSummaryId),$("#lensPrice").val(price);var total=parseFloat($("#subtotal").val())+parseFloat($("#lensPrice").val())+parseFloat($("#tintPrice").val());$("#orderSummaryPrice").text("$"+total.toFixed(2))}}}function addTintToOrderSummary(){var selectedTintProduct=$('input:radio[class="tintRadio"]:checked').val();if(void 0!=selectedTintProduct){var tintObject=$("#"+selectedTintProduct).children("option:selected");if(void 0!=tintObject&&""!=tintObject.val()){var orderSummaryId=tintObject.attr("orderSummaryId"),title=tintObject.attr("title");if("tsku300001"!=tintObject.val()){var price=parseFloat(tintObject.attr("price"));appendToOrderSummary(price.toFixed(2),title,orderSummaryId),$("#tintPrice").val(price);var total=parseFloat($("#subtotal").val())+parseFloat($("#lensPrice").val())+parseFloat($("#tintPrice").val());$("#orderSummaryPrice").text("$"+total.toFixed(2))}else{$("#"+orderSummaryId).remove();var total=parseFloat($("#subtotal").val())+parseFloat($("#lensPrice").val());$("#orderSummaryPrice").text("$"+total.toFixed(2))}}}else{var selectedLensSku=$('input:radio[class="lensRadio"]:checked').val();if(void 0!=selectedLensSku){$("#tint").remove();var total=parseFloat($("#subtotal").val())+parseFloat($("#lensPrice").val());$("#orderSummaryPrice").text("$"+total.toFixed(2))}}}function appendToOrderSummary(price,displayName,id){$("#"+id).remove();var renderText="",priceFormate=parseFloat(price).toFixed(2);renderText=0==parseFloat(price)?"Free":"$"+priceFormate,$(".totalPrice").before('<dl id="'+id+'"><dt>'+displayName+"</dt><dd>"+renderText+"</dd></dl>")}function addToShoppingCart(){var fillAllOption=validatePersonalization();if(fillAllOption){var form=$("#addonFormId");form.submit()}}function processSelectedPrescription(){processSelectPrescriptionSelectBox(),processSelectPrescriptionRadio(),processSelectPrescriptionText()}function processSelectPrescriptionText(){for(var name in selectedPrescriptionText){var selectedValue=selectedPrescriptionText[name];""!=selectedValue&&$("#"+name).val(selectedValue)}}function processSelectPrescriptionSelectBox(){var bro=$.browser,isIE11=!!navigator.userAgent.match(/Trident\/7\./);for(var name in selectedPrescriptionSelectBox){var selectedValue=selectedPrescriptionSelectBox[name];if(""!=selectedValue){$("#"+name).parent().find("label:first-child").removeClass("gray"),(bro.msie||isIE11)&&$("#"+name).children("option:selected").removeAttr("selected");var processObejct=$("#"+name+" option[value='"+selectedValue+"']");$("#"+name).parent().find("label:first-child").text(processObejct.text()),processObejct.attr("selected",!0)}"prescriptionType"==name&&"SingleVision"==selectedValue&&($("#NVAddTitle").hide(),$("#selNVAdd").hide()),"prescriptionType"!=name||"frameOnly"!=selectedValue&&"nonPrescription"!=selectedValue||($("#prescriptionFormId .fieldset .prescriptionTip").hide(),$("#infoODOS").hide(),$("#prismInfo").hide(),$("#pdInfo").hide(),$("#savePrescript").hide(),$("#prescriptionNext").parent(".btnBox").addClass("btnBox-top0")),"prescriptionType"!=name||"Bifocal"!=selectedValue&&"Progressive"!=selectedValue||$("#prismInfo").hide()}}function processSelectPrescriptionRadio(){for(var name in selectedPrescriptionRadio){var selectedValue=selectedPrescriptionRadio[name];""!=selectedValue&&$("input:radio[class='"+name+"'][value='"+selectedValue+"']").attr("checked","checked")}var singlePd=$('input:radio[class="pdGroupRadio"]:checked').val();"true"!=singlePd&&($("#spanSignlePD").removeClass("checked"),$("#spanDoulePD").addClass("checked"),$(".singlePDBox").hide(),$(".doublePDBox").show());var frametype=$(".frameInfo").attr("data-frametype"),selected=$("#prescriptionType").children("option:selected").val(),odSph=parseFloat($("#odSph").children("option:selected").val()),osSph=parseFloat($("#osSph").children("option:selected").val()),odCyl=parseFloat($("#odCyl").children("option:selected").val()),osCyl=parseFloat($("#osCyl").children("option:selected").val()),minSph=odSph<osSph?odSph:osSph,maxJoint=odSph+odCyl>osSph+osCyl?odSph+odCyl:osSph+osCyl;minSph<-12||maxJoint>6||frametype&&frametype.search(/PremiumSunglasses/gi)>=0?$("#prismInfo").hide():"SingleVision"!=selected&&""!=selected||$("#prismInfo").show(),$("#prismInfo").is(":hidden")&&($("input:radio[class='prismGroupRadio'][value='false']").attr("checked","checked"),$("#notEnablePrism").addClass("checked"));var prismenable=$('input:radio[class="prismGroupRadio"]:checked').val();"true"==prismenable&&($("#enablePrism").addClass("checked"),$("#notEnablePrism").removeClass("checked"),$(".infoODOS ").show())}function processSelectPrescriptionCheckBox(){for(var name in selectedPrescriptionCheckBox){var selectedValue=selectedPrescriptionCheckBox[name];"true"==selectedValue&&$("#"+name+"[value='"+selectedValue+"']").attr("checked",!0)}var prescriptionIsToBeSaved=$("#prescriptionIsToBeSaved").is(":checked");if(prescriptionIsToBeSaved){$("#prescriptionIsToBeSaved").parent().addClass("checked");var section=$("#savePrescriptBody");section.removeClass("hidden"),section.show()}}function editSelectedAddonSection(step){var windowId=$("#_windowId").val(),rad=Math.floor(1e3*Math.random()+1);$.get("/misc/ajax/productOrder/editSelectedAddonSection.jsp",{currentStep:step,_windowid:windowId,rad:rad},function(data){var responseDate=$(data),prescriptInfo=responseDate.find("#prescriptInfo").html();if(1==step){$.pdpCommonUtils.doAnimateEdit($("#prescriptInfo"),prescriptInfo);var prescriptionNext=$("#prescriptInfo #prescriptionNext"),prescriptionNextParent=prescriptionNext.parent(".btnBox");prescriptionNext.text().match(/next/gi)?prescriptionNextParent.addClass("btnBox-top0"):prescriptionNextParent.removeClass("btnBox-top0")}else $("#prescriptInfo").html(prescriptInfo);var lensInfo=responseDate.find("#lensInfo").html();2==step?$.pdpCommonUtils.doAnimateEdit($("#lensInfo"),lensInfo):$("#lensInfo").html(lensInfo);var addOnsInfo=responseDate.find("#addOnsInfo").html();$("#addOnsInfo").html(addOnsInfo);var orderSummary=responseDate.find("#orderItem").html();if($("#orderItem").html(orderSummary),1==step){var prescriptionSelectBox=responseDate.find("#selectedPrescriptionSelectBox").val(),prescriptionRadio=responseDate.find("#selectedPrescriptionRadio").val(),prescriptionCheckBox=responseDate.find("#selectedPrescriptionCheckBox").val(),prescriptionText=responseDate.find("#selectedPrescriptionText").val();selectedPrescriptionSelectBox=$.parseJSON(prescriptionSelectBox),selectedPrescriptionRadio=$.parseJSON(prescriptionRadio),selectedPrescriptionCheckBox=$.parseJSON(prescriptionCheckBox),selectedPrescriptionText=$.parseJSON(prescriptionText),processOptions(),processDefaultValue(),processSelectedPrescription(),processView();var selected=$("#prescriptionType").children("option:selected").val();if("Progressive"==selected)if(document.getElementById("pDescription"))document.getElementById("pDescription").style.display="block";else{var myDiv=document.createElement("div");myDiv.id="pDescription",myDiv.innerHTML="<p style='font-size:12px;'>Manufactured using technology covered by a royalty bearing license to U.S. Patent No. 6,089,713 and its foreign counterparts.</p>",document.getElementById("prescriptionType").parentNode.parentNode.parentNode.parentNode.appendChild(myDiv)}else document.getElementById("pDescription")&&(document.getElementById("pDescription").style.display="none")}2==step&&(addLensToOrderSummary(),addTintToOrderSummary())})}function resetButtons(){$(".page-order").length&&($(".select").removeClass("error"),$("#prescriptionFormId .btnBox").removeClass("btnBox-top0"),$("#prescriptionFormId .btnBox").find("#prescriptionNext").html("Submit Prescription"))}function processView(){var selectedPrescription=$("#prescriptionType").children("option:selected").val();"SingleVision"==selectedPrescription&&($("#selNVAdd").hide(),$("#NVAddTitle").hide()),$("#optimize").hide(),"Bifocal"!=selectedPrescription&&"Progressive"!=selectedPrescription&&"LimitlessBifocal"!=selectedPrescription||$("#prismInfo").hide(),"nonPrescription"!=selectedPrescription&&"frameOnly"!=selectedPrescription||($("#prescriptionFormId .fieldset .prescriptionTip").hide(),$("#infoODOS").hide(),$("#prismInfo").hide(),$("#pdInfo").hide(),$("#optimize").hide(),$("#savePrescript").hide()),$("#prescriptionNext").show(),$("#presNextGrey").hide();var odSph=parseFloat($("#odSph").children("option:selected").val()),osSph=parseFloat($("#osSph").children("option:selected").val()),odCyl=parseFloat($("#odCyl").children("option:selected").val()),osCyl=parseFloat($("#osCyl").children("option:selected").val()),minSph=odSph<osSph?odSph:osSph,maxSph=odSph>osSph?odSph:osSph,maxJoint=odSph+odCyl>osSph+osCyl?odSph+odCyl:osSph+osCyl,minJoint=odSph+odCyl<osSph+osCyl?odSph+odCyl:osSph+osCyl;(minSph<-12||minJoint<-18||maxSph>6||maxJoint>6)&&$("#prismInfo").hide()}function clearAll(){processDefaultValue(),$("input:radio[class='pdGroupRadio'][value='true']").attr("checked","checked"),$("input:radio[class='prismGroupRadio'][value='false']").attr("checked","checked"),$("#spanDoulePD").removeClass("checked"),$("#doublePDBox").hide(),$("#spanSignlePD").addClass("checked"),$("#singlePDBox").show(),$("#enablePrism").removeClass("checked"),$("#notEnablePrism").addClass("checked"),$("#prescriptionSavedName").val(""),$("#selNVAdd").show(),$("#NVAddTitle").show(),commerceItemInfo&&"PremiumSunglasses"!==commerceItemInfo.frame.frameType&&$("#prismInfo").show(),$("#prismInfoODOS").hide(),$("#pdInfo").show(),$("#prescriptionFormId .fieldset .prescriptionTip").show(),$("#infoODOS").show(),$("#prescriptionIsToBeSaved [value='true']").attr("checked",!1),$("#prescriptionIsToBeSavedLabel").removeClass("checked"),$("#savePrescript").show(),$("#savePrescriptBody").hide(),$("#presNextGrey").show();var myDate=new Date,defaultYear=myDate.getFullYear(),defaultMonth=myDate.getMonth()+1,defaultDay=myDate.getDate();$("#prescriptionSavedYear").parent().find("label:first-child").text(defaultYear),$("#prescriptionSavedMonth").parent().find("label:first-child").text(defaultMonth),$("#prescriptionSavedDay").parent().find("label:first-child").text(defaultDay),$("#prescriptionSavedYear option[value='"+defaultYear+"']").attr("selected",!0),$("#prescriptionSavedMonth option[value='"+defaultMonth+"']").attr("selected",!0),$("#prescriptionSavedDay option[value='"+defaultDay+"']").attr("selected",!0),$("#prescriptionRenewMonths").parent().find("label:first-child").text("6 Months"),$("#prescriptionRenewMonths option[value='']").attr("selected",!0),resetButtons()}function validatePersonalization(){var selectPersonalization=$('input[type="checkbox"][group="personalizationProduct"]'),iscorrect=!0;return selectPersonalization.each(function(){var isSelected=$(this).is(":checked"),targetId=$(this).attr("id");
if(isSelected){var reservedKey=new RegExp(/(\bChanel\b|\bLV\b|\bD&G\b|\bVersace\b|\bCELINE\b|\bFENDI\b|\bCartier\b|\bGUCCI\b|\bPRADA\b|\bRAY Ban\b|\bHERMES\b|\bDior\b|\bBURBERRY\b|\bCOACH\b|\bMichael Kors\b|\bPOLO\b|\bkingston\b|\bCalvinKlein\b|\bHUGO BOSS\b|\bguess\b|\bHarley-Davidson\b|\bCadillac\b|\bCK\b|\bChloe\b|\bTiffany\b|\bBMW\b|\bAdidas\b)/,"i");if("textInside"==targetId){var textInside=$(".textInside"),insideText=$.trim(textInside.find("#insideText").val()),termInsideText=textInside.find("#termInsideText").is(":checked");""==insideText||""==termInsideText?(""==insideText&&$("#insideText").addClass("error"),showSingalErrorMessage(prescriptionErrorContainer.personalizationInfo,"textInside",prescriptionErrorContainer.textInsideTitle),iscorrect=!1):insideText.length>0&&insideText.search(reservedKey)>=0&&(showSingalErrorMessage(prescriptionErrorContainer.containReservedWords,"textInside",prescriptionErrorContainer.textInsideTitle),iscorrect=!1)}if("textOutside"==targetId){var textOutside=$(".textOutside"),outsideText=$.trim(textOutside.find("#outsideText").val()),outsideTextSkuId=textOutside.find("#outsideTextSkuId").children("option:selected").val(),outsideTextFont=textOutside.find('input:radio[class="outsideTextFont"]:checked').val(),termOutsideText=textOutside.find("#termOutsideText").is(":checked");""!=outsideText&&""!=outsideTextSkuId&&outsideTextFont&&""!=termOutsideText?outsideText.length>0&&outsideText.search(reservedKey)>=0&&(showSingalErrorMessage(prescriptionErrorContainer.containReservedWords,"textOutside",prescriptionErrorContainer.textOutsideTitle),iscorrect=!1):(""==outsideText&&$("#outsideText").addClass("error"),""==outsideTextSkuId&&$("#outsideTextSkuId").closest("span").addClass("error"),showSingalErrorMessage(prescriptionErrorContainer.personalizationInfo,"textOutside",prescriptionErrorContainer.textOutsideTitle),iscorrect=!1)}if("artOutside"==targetId){var artOutside=$(".artOutside"),persImageCode=artOutside.find("#persImageCode").val(),persImageSkuId=artOutside.find("#persImageSkuId").children("option:selected").val();""!=persImageSkuId&&""!=persImageCode||(showSingalErrorMessage(prescriptionErrorContainer.personalizationInfo,"artOutside",prescriptionErrorContainer.artOutsideTitle),iscorrect=!1)}}}),iscorrect}function getTintPrice(id){var price=$("#"+id).children("option:selected").attr("price");if(""!=price&&void 0!=price){var priceTag=$("#"+id).parent().parent().parent().find("span[class=tintSkuPrice]");priceTag.text("$"+price);var $obj=$('input:radio[class="tintRadio"][value="'+id+'"]');$obj.attr("checked","checked"),$obj.trigger("click"),$(".select130").each(function(){if(this.id!=id){this.options[0].selected=!0,$(this).parent().find("label").html($(this).find("option:selected").text());var selValue=$(this).find("option:selected").val();selValue.length<=0?$label.hasClass("gray")||$label.addClass("gray"):$label.hasClass("gray")&&$label.removeClass("gray")}})}}function selectLensSharp(id,isSubmitForm,formId,isProgressiveAvailable,mainSection,backFrameLink){backFrameLink=encodeURIComponent(backFrameLink),$("#"+formId+" input[id='rimlessShapeId']").val(id);var _windowId=$("#_windowId").val();if(isSubmitForm){var skuId=$("#selectedMainSku").val(),step=$("#currentStep").val();if("undefined"!=typeof step&&"1"!=step&&"0"!=step){var targetParam={skuId:skuId,lensShapeId:id,faceId:"",step:step};$.ajax({url:"/misc/ajax/productOrder/changeLensShapeSku.jsp",async:!1,data:{lensShapeSku:id,_windowid:_windowId},success:function(data){"success"!=$.trim(data)?showLensShapeErrorMessage($.trim(data),"processBackPrescriptionError",prescriptionErrorContainer.errorHead,targetParam):$.get("/misc/ajax/productOrder/getOrderUrl.jsp",targetParam,function(data){"1"==targetParam.step?window.location.href=$.trim(data)+"&_windowid="+_windowId+"&backFrameLink="+backFrameLink:window.location.href=$.trim(data)+"&step="+$.trim(targetParam.step)+"&_windowid="+_windowId+"&backFrameLink="+backFrameLink})}})}else if("1"==step){var targetParam={skuId:skuId,lensShapeId:id};$.get("/misc/ajax/productOrder/getOrderUrl.jsp",targetParam,function(data){window.location.href=$.trim(data)+"&_windowid="+_windowId+"&backFrameLink="+backFrameLink})}}else"true"==isProgressiveAvailable?($("#"+mainSection).find("span[id=isProgressiveAvailable]").removeClass("noMsg"),$("#"+mainSection).find("span[id=isProgressiveAvailable]").text("Yes")):($("#"+mainSection).find("span[id=isProgressiveAvailable]").text("No"),$("#"+mainSection).find("span[id=isProgressiveAvailable]").addClass("noMsg")),$("#"+mainSection).find("span[id=pdRange]").text($("#"+id).attr("pd")),$("#"+mainSection).find("span[id=lengthHeight]").text($("#"+id).attr("lengthHeight")),$("#"+mainSection).find("span[id=lensWidth]").text($("#"+id).attr("lensWidth")),$("#"+mainSection).find("span[id=frameWidth]").text($("#"+id).attr("frameWidth")),processOrderUrl(formId,backFrameLink)}function selectMainSku(id,description,formId){if($("#endecaSkuId").val(id),$("#h1SkuId").text(id),void 0!=$(".heroImg")){var altValue=void 0==$(".heroImg").attr("alt")?"":$(".heroImg").attr("alt"),specialIndex=altValue.indexOf("#"),finalResult=altValue.substring(0,specialIndex);finalResult=jQuery.trim(finalResult)+" #"+id,$(".heroImg").attr("alt",finalResult);var titleValue=void 0==$(".heroImg").attr("title")?"":$(".heroImg").attr("title"),indexTitle=titleValue.lastIndexOf(" ");titleValue=titleValue.substring(0,indexTitle),titleValue=titleValue+" "+id,$(".heroImg").attr("title",titleValue);var skuText=$("#"+id).find("input"),skuInfoText={inventoryStatus:skuText.data("inventorystatus"),status:skuText.data("status")},inventoryStatus=skuInfoText.inventoryStatus,status=skuInfoText.status;"disabled"==$.trim(status)?("quickViewFormId"==formId?($("#quickViewoutOfStock").hide(),$("#quickViewInStock").hide()):($("#outOfStock").hide(),$("#orderGlasses").hide()),$("#outOfStockSignUp").hide(),$("#RetiredButton").show()):"outof_stock"==$.trim(inventoryStatus)?("quickViewFormId"==formId?($("#quickViewoutOfStock").show(),$("#quickViewInStock").hide()):($("#outOfStock").show(),$("#orderGlasses").hide()),$("#outOfStockSignUp").show(),$("#RetiredButton").hide()):("quickViewFormId"==formId?($("#quickViewoutOfStock").hide(),$("#quickViewInStock").show()):($("#outOfStock").hide(),$("#orderGlasses").show()),$("#"+formId+" input[id='mainSkuId']").val(id),processOrderUrl(formId,window.location.href),$(".colorName").text(description),$("#outOfStockSignUp").hide(),$("#RetiredButton").hide()),$("#outOfStockSkuId").val(id),$("#outOfStockEmailInput").val(""),$("#outOfStockEmailMessage").html("")}}function processOrderUrl(formId,backFrameLink){var skuId=$("#"+formId+" input[id='mainSkuId']").val(),lensShapeId=$("#"+formId+" input[id='rimlessShapeId']").val(),skuInfoText=$("#"+skuId).find("input"),orderUrl=skuInfoText.data("url"),temp=$.trim(orderUrl);temp.indexOf("?")<0?temp=""!=lensShapeId?temp+"?lensShapeId="+lensShapeId+"&_windowid=new&backFrameLink="+backFrameLink:temp+"?_windowid=new&backFrameLink="+backFrameLink:""!=lensShapeId?(temp=temp.substring(0,temp.indexOf("?")),temp=temp+"?lensShapeId="+lensShapeId+"&_windowid=new&backFrameLink="+backFrameLink):temp=temp+"&_windowid=new&backFrameLink="+backFrameLink,"lensShapeFormId"==formId?$("#orderGlasses").attr("href",temp):"quickViewFormId"==formId&&$("#quickViewInStock").attr("href",temp)}function orderGlasses(){var form=$("#lensShapeFormId");try{var data=$(".frameFit:first").find(".currentItem .carouselItem.recently").find("var").text();data=$.parseJSON(data),form.find("#selectedFaceId").val(data.faceId)}catch(error){}form.submit()}function calcPrice(id){$("#"+id+"qtyError").remove();var selectedCoatingSkuDisplayName=$('input:radio[class="coatingSkus"]:checked').attr("displayName"),selectedCoatingSkuId=$('input:radio[class="coatingSkus"]:checked').val(),subTotal=parseFloat($("#subtotal").val()),coatingPrice=0,clipOnPrice=0,personalizationPrice=0,tryOnImageUrl=$(".frameImg").css("background-image");if("undefined"!=typeof selectedCoatingSkuId)if("ctsku100007"!=selectedCoatingSkuId){if(coatingPrice=parseFloat($("#"+selectedCoatingSkuId+"_price").val()),appendToOrderSummary(coatingPrice.toFixed(2),selectedCoatingSkuDisplayName,"coat"),tryOnImageUrl.indexOf("____")>0||tryOnImageUrl.indexOf("___")>0){if(0==$('input:radio[class="coatingSkus"]:checked').length)return;var selectedTint=$('input:radio[class="coatingSkus"]:checked');$.FrameFitUtils.pdpTintTryon(selectedTint)}}else{if(tryOnImageUrl.indexOf("____")>0||tryOnImageUrl.indexOf("___")>0||tryOnImageUrl.indexOf("ffffff")>0){if(0==$('input:radio[class="coatingSkus"]:checked').length)return;var selectedTint=$('input:radio[class="coatingSkus"]:checked');$.FrameFitUtils.pdpTintTryon(selectedTint)}$("#coat").remove()}var selectedClipons=$('select[class="select150"]');selectedClipons.each(function(){var id=$(this).attr("id"),value=$(this).children("option:selected").val();if(""!=value){var singalCliponPrice=parseFloat($("#"+id+"_price").val()),cliponDisplayName=$(this).attr("displayName"),subSum=singalCliponPrice*parseFloat(value);appendToOrderSummary(subSum.toFixed(2),cliponDisplayName,"clipon"+id),clipOnPrice+=subSum}else $("#clipon"+id).remove()});var singalPersonalizationPrice,personalizationDisplayName,image=$("#persImageSkuId").children("option:selected"),imageCheckBox=$("#artOutside").is(":checked");personalizationDisplayName=$("#artOutside").attr("displayname");var imagePirce=image.attr("price");if("undefined"!=typeof imagePirce&&""!=imagePirce&&1==imageCheckBox){if($("#imagePrice").text("$"+imagePirce),$("#imagePrice").show(),singalPersonalizationPrice=parseFloat(imagePirce),personalizationPrice+=singalPersonalizationPrice,appendToOrderSummary(singalPersonalizationPrice.toFixed(2),personalizationDisplayName,"personalizationpersImageSkuId"),"persImageSkuId"==id){var targetSrc=$("#targetImage").attr("src");if("undefined"!=typeof targetSrc&&""!=targetSrc){var targetCode=image.attr("code");"undefined"!=typeof targetCode&&""!=targetCode&&processImage(targetCode,targetSrc)}}}else $("#imagePrice").hide(),$("#personalizationpersImageSkuId").remove();var insideTextCheckBox=$("#textInside").is(":checked");personalizationDisplayName=$("#textInside").attr("displayname");var insideTextPrice=$("#textInside_price").val();"undefined"!=typeof insideTextPrice&&""!=insideTextPrice&&1==insideTextCheckBox?($("#insideTextPrice").show(),singalPersonalizationPrice=parseFloat(insideTextPrice),personalizationPrice+=singalPersonalizationPrice,appendToOrderSummary(singalPersonalizationPrice.toFixed(2),personalizationDisplayName,"personalizationpersinsideTextSkuId")):($("#personalizationpersinsideTextSkuId").remove(),$("#insideTextPrice").hide());var outsideText=$("#outsideTextSkuId").children("option:selected"),artOutsideCheckBox=$("#textOutside").is(":checked");personalizationDisplayName=$("#outsideTextSkuId").attr("displayname");var outsideTextPrice=outsideText.attr("price");"undefined"!=typeof outsideTextPrice&&""!=outsideTextPrice&&1==artOutsideCheckBox?($("#outsideTextPrice").text("$"+outsideTextPrice),singalPersonalizationPrice=parseFloat(outsideTextPrice),personalizationPrice+=singalPersonalizationPrice,appendToOrderSummary(singalPersonalizationPrice.toFixed(2),personalizationDisplayName,"personalizationpersinsoutsideTextSkuId")):$("#personalizationpersinsoutsideTextSkuId").remove();var total=subTotal+coatingPrice+clipOnPrice+personalizationPrice;$("#priceSlot").text("$"+total.toFixed(2)),$("#subTotal").val(total.toFixed(2)),$("#orderSummaryPrice").text("$"+total.toFixed(2))}function processImage(code,targetSrc){var begin=targetSrc.lastIndexOf("-"),url=targetSrc.substring(0,begin)+"-"+code+".png";$("#targetImage").attr("src",url),$("#persImageCode").val(url)}function showWarningMessage(){var warningData=warningMessage,msgLength=warningData.msgs.length,$wraningBox=$(".productOrder").parent().find(".warningBox");msgLength>0&&($wraningBox.find("p").text(warningData.msgs[0]),$(this).acsPopup({popupSrc:"",popupTitle:warningData.header,maxWidth:650,maxHeight:550,popupID:"warning0",popupContentPreload:$wraningBox,callBack:function(setting){$("#warning0").find(".btnCancel").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)}),$("#warning0").find(".btnOK").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting),setTimeout(function(){var currentObj=commerceItemInfo.prescription;"0.00"===currentObj.odSph&&"0.00"===currentObj.osSph&&"0.00"===currentObj.osCyl&&"0.00"===currentObj.odCyl&&"0"===currentObj.osAxis&&"0"===currentObj.odAxis?submitPrescription():showConfirmationPopup()},500)})}}))}function submitPrescription(){var form=$("#prescriptionFormId"),prescriptionType=commerceItemInfo.prescription.prescriptionType;form.ajaxSubmit({type:"post",url:"/productdetail/prescription.jsp",success:function(data){if("error"==data)showSingalErrorMessage(prescriptionErrorContainer.backendErrorForPrescription,"processPrescription",prescriptionErrorContainer.errorTitle);else{var responseDate=$(data),prescriptInfo=responseDate.find("#prescriptInfo").html();$("#prescriptInfo").html(prescriptInfo);var lensInfo=responseDate.find("#lensInfo").html();$("#lensInfo").html(lensInfo);var orderSummary=responseDate.find("#orderItem").html();if($("#orderItem").html(orderSummary),"frameOnly"!=prescriptionType)$("#lensInfo").removeClass("disable"),addLensToOrderSummary(),addTintToOrderSummary(),$.pdpCommonUtils.doAnimate($("#lensInfo"));else{var addOnsInfo=responseDate.find("#addOnsInfo").html();$("#addOnsInfo").html(addOnsInfo),$("#addOnsInfo").removeClass("disable"),$.pdpCommonUtils.doAnimate($("#addOnsInfo"))}}},error:function(data){}})}function showPrescriptionErrorMessage(){var errorData=errorMessage,msgLength=errorData.msgs.length,$errorBox=$(".productOrder").parent().find(".errorBox");msgLength>0&&($errorBox.find("p").text(errorData.msgs[0]),$(this).acsPopup({popupSrc:"",popupTitle:errorData.header,maxWidth:650,maxHeight:550,popupID:"error0",popupContentPreload:$errorBox,callBack:function(setting){$("#error0").find(".btnOK").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)})}}))}function showLensShapeErrorMessage(message,id,title,targetParam){var $errorBox=$(".productOrder").parent().find(".errorBox");$errorBox.find("p").text(message),$(this).acsPopup({popupSrc:"",popupTitle:title,maxWidth:650,maxHeight:550,popupID:"error_"+id,popupContentPreload:$errorBox,callBack:function(setting){$("#error_"+id).on("click",".btnOK, .popupClose",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting),$.get("/misc/ajax/productOrder/getOrderUrl.jsp",targetParam,function(data){window.location.href=data})})}})}function showSingalErrorMessage(message,id,title){var $errorBox=$(".productOrder").parent().find(".errorBox");$errorBox.find("p").html(message),$(this).acsPopup({popupSrc:"",popupTitle:title,maxWidth:650,maxHeight:550,popupID:"error_"+id,popupContentPreload:$errorBox,callBack:function(setting){$("#error_"+id).find(".btnOK").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)})}})}function changeMainSku(mainProductId,mainSkuId,description,selected,backFrameLink){backFrameLink=encodeURIComponent(backFrameLink);var _windowId=$("#_windowId").val();$.get("/misc/ajax/productOrder/changeMainSku.jsp",{mainSkuId:mainSkuId,_windowid:_windowId,backFrameLink:backFrameLink},function(data){if("outof_stock"==$.trim(data))$("a[name="+description+"]").removeClass("recently"),$("a[name="+selected+"]").addClass("recently"),showSingalErrorMessage(prescriptionErrorContainer.outofStockInfo,"frameoutofStock",prescriptionErrorContainer.outofStockTitle);else{$("#selectedMainSku").val(mainSkuId);var responseDate=$(data),seo=(responseDate.find("#orderItem").html(),responseDate.find("#newSeo").val()),selectedLensShapeId=(responseDate.find("#heroImage").val(),$("#selectedLensShapeId").val()),step=$("#currentStep").val(),facedata=$(".frameFit:first").find(".currentItem .carouselItem.recently").find("var").text();facedata=$.parseJSON(facedata);var faceId=facedata.faceId;""!=selectedLensShapeId?(seo=seo+"?lensShapeId="+selectedLensShapeId,"1"!=step&&(seo=seo+"&step="+step)):"1"!=step&&(seo=seo+"?step="+step),seo=seo.indexOf("?")!=-1?seo+"&curFaceId="+faceId+"&_windowid="+_windowId+"&backFrameLink="+backFrameLink:seo+"?curFaceId="+faceId+"&_windowid="+_windowId+"&backFrameLink="+backFrameLink,window.location.href=seo}})}function importPrescriptionFromProfile(){var prescriptionId=$("#perscriptionFromProfile").children("option:selected").val();if(""==prescriptionId)showSingalErrorMessage(prescriptionErrorContainer.improtPrescriptionInfo,"importPrescriptionError",prescriptionErrorContainer.improtPrescriptionTitle);else{var _windowId=$("#_windowId").val(),rad=Math.floor(1e3*Math.random()+1);$.get("/misc/ajax/productOrder/importPrescription.jsp",{prescriptionId:prescriptionId,_windowid:_windowId,rad:rad},function(data){editSelectedAddonSection(1)})}}function selectPrescriptionFromOrder(orderId,obj){$(obj).attr("onclick","return false;");var $importPre=$(".importPre");$.ajax({url:"/cartridges/productOrder/importPrescript/step03.jsp",data:{orderId:orderId},success:function(str){$importPre.append(str),$importPre.find(".step02").hide();var realHeight=0;$(".prescriptCarousel .carouselContent li.carouselItem").each(function(){var height=$(this).outerHeight();height>realHeight&&(realHeight=height)}),$(".prescriptCarousel .carouselContent").css("height",realHeight+"px"),$importPre.find(".popResize").trigger("click"),$(".importPre .prescriptCarousel").each(function(){var $preCarousel=$(this);$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderCanDrag:!0,sliderList:"carouselContent",sliderButtonCov:"carouselButton",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!1,callBack:function(obj,setting){setting.sliderContainer.find("."+setting.sliderButtonCov).find("a.carouselNext").live("mouseup",function(e){var currentIndex=parseInt($(".importPre .tipMsg span").text());currentIndex+1<=$preCarousel.find("ul > li").length&&$(".importPre .tipMsg span").text(currentIndex+1)}),setting.sliderContainer.find("."+setting.sliderButtonCov).find("a.carouselPrev").live("mouseup",function(e){var currentIndex=parseInt($(".importPre .tipMsg span").text());currentIndex-1>0&&$(".importPre .tipMsg span").text(currentIndex-1)})}})}),$(obj).attr("onclick","selectPrescriptionFromOrder('"+orderId+"',this)")},error:function(){}})}function importPrescriptionFromOrder(commerceItemId){$("#pop_importPre").prev(".popupLayerBg").detach(),$("#pop_importPre").detach();var _windowId=$("#_windowId").val(),rad=Math.floor(1e3*Math.random()+1);$.get("/misc/ajax/productOrder/importPrescription.jsp",{commerceItemId:commerceItemId,_windowid:_windowId,rad:rad},function(data){editSelectedAddonSection(1)})}function validatePD(singalPd){singalPd?$("#pdSingle").parent().parent().find("span[class='select']").removeClass("error"):($("#pdLeft").parent().removeClass("error"),$("#pdRight").parent().removeClass("error")),getPrescription();for(var validateFunction in PrescriptionRules){var functionBody=PrescriptionRules[validateFunction];if(jQuery.isFunction(functionBody)){var targetElementName=PrescriptionRules[validateFunction][elementName],targetEventName=PrescriptionRules[validateFunction][eventName];if("undefined"!=typeof targetEventName&&"undefined"!=typeof targetElementName&&"pdSingle"==targetElementName&&"change"==targetEventName){var callFunction="PrescriptionRules."+validateFunction+"(commerceItemInfo)",evalValue=eval(callFunction);if("success"!=evalValue){var failedresult=getMessage(PrescriptionRules,validateFunction,evalValue);return singalPd?$("#pdSingle").parent().parent().find("span[class='select']").addClass("error"):($("#pdLeft").parent().parent().find("span[class='select']").addClass("error"),$("#pdRight").parent().parent().find("span[class='select']").addClass("error")),void showSingalErrorMessage(failedresult.message,"PDErrorSection",prescriptionErrorContainer.pdErrorTitle)}}}}}function removeVoteError(revieweeId){$("#"+revieweeId+"_emailAddress").attr("class","textInput")}function popup_artChange(){var persImageSkuId=$("#persImageSkuId").children("option:selected").val();if(""==persImageSkuId)return void showSingalErrorMessage(prescriptionErrorContainer.artColorInfo,"perscriptionImageColor",prescriptionErrorContainer.artColorTitle);$("#popup_artChange").attr("layerSrc")+"?skuId="+persImageSkuId;$("#popup_artChange").acsPopup({popMsg:$("#popup_artChangeDom").html(),popupTitle:$("#popup_artChange").attr("layerTitle"),maxWidth:650,maxHeight:550,popupID:"changeArtPop",callBack:function(setting){$.touchUtil.isTouch?$("."+setting.popupLayerContent).find(".artBox").css("overflow","auto"):$("."+setting.popupLayerContent).find(".artBox").acsScrollBar({scrollContainer:$("."+setting.popupLayerContent).find(".artBox")}),$("."+setting.popupLayerContent).find(".artBox a").live("click",function(e){e.preventDefault();var imgSrc=$(this).find("img").attr("src"),skuId=$(this).find("img").attr("skuId"),task=$(this).attr("task");"on"!=task&&($.get("/misc/ajax/productOrder/imageColor.jsp",{persImageSkuId:skuId},function(data){$("#imageCodeSection").html($(data).find("#mainSection").html())}),$artShow=$(".personalization .artOutside .artShow"),$artShow.find("img").attr("src",imgSrc).show(),$("#persImageCode").val(imgSrc),$artShow.find("span").remove(),acsPopup.popupLayerClose(setting))})}})}function cleanInputError(){$("#outsideText").live("keydown",function(e){$("#outsideText").removeClass("error")}),$("#insideText").live("keydown",function(e){$("#insideText").removeClass("error")}),$("#prescriptionSavedName").live("keydown",function(e){$("#prescriptionSavedName").removeClass("error")})}function quickViewOrderGlass(formId){var form=$("#"+formId);form.submit()}function attachFaceIdToOrder(){$("#orderGlasses").hover(function(){var data,dataObj=$(".frameFit:first").find(".currentItem .carouselItem.recently");$(dataObj).find("var").size()>0?(data=$(dataObj).find("var").text(),data=$.parseJSON(data)):(dataObj=$(dataObj).find("a"),data={faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")});var faceId=data.faceId,curHref=$(this).attr("href");if(curHref.indexOf("?")<0)return void $(this).attr("href",curHref+"?curFaceId="+faceId);var faceIdIndex=curHref.search(/curFaceId/gi);faceIdIndex<0?$(this).attr("href",curHref+"&curFaceId="+faceId):$(this).attr("href",curHref.replace(/curFaceId=[\w\d]+/gi,"curFaceId="+faceId))},function(){})}function checkInventory(){$("#addOnsInfo .addToCart").length&&$("#addOnsInfo .addToCart").append('<div style="top:10px;left:0px;" class="loading"><span></span></div>');var fillAllOption=validatePersonalization();if(!fillAllOption)return void $("#addOnsInfo .addToCart .loading").remove();var cliponParamter={},selectedClipons=$('select[class="select150"]');selectedClipons.each(function(){var id=$(this).attr("id"),value=$(this).children("option:selected").val();""!=value&&(cliponParamter["clipon"+id]=value)});var rxQuantity=$("#rxQuantity").children("option:selected").val(),skuId=$("#selectedMainSku").val();cliponParamter.skuId=skuId,cliponParamter.rxQuantity=rxQuantity,$.get("/misc/ajax/productOrder/checkRXInventory.jsp",cliponParamter,function(data){if(""==$.trim(data)){var form=$("#addonFormId");form.submit()}else{$("#addOnsInfo .addToCart .loading").remove();var result=$.parseJSON($.trim(data));void 0!=result.rxQuantity&&($("#rxQuantity").closest("span").addClass("error"),$("#rxQuantity").parent().find(".qtyError").remove(),$("#rxQuantity").after('<span class="qtyError">'+result.rxQuantity+"</span>"));for(var key in result)"rxQuantity"!=key&&($("#"+key).closest("span").addClass("error"),$("#"+key+"qtyError").remove(),$("#"+key).closest("span").after('<p id="'+key+'qtyError" class="error qtyError">'+result[key]+"</p>"));var errArray=$(".error"),scrollTop=$(document).scrollTop(),minOffset=scrollTop;if(errArray.size()>0){for(var index=0;index<errArray.size();index++)minOffset>$(errArray[index]).offset().top&&(minOffset=$(errArray[index]).offset().top);$("html, body").animate({scrollTop:minOffset},"500")}}})}function handleMyFavorites(){$(".addFavorites").find("a:visible").live("click",function(e){e.preventDefault();var favStatus=$(this).attr("favStatus"),$addFavorites=$(this).parents(".addFavorites");"true"==favStatus?removeMyFavorite($addFavorites):addToMyFavoritesForm(this)})}function removeMyFavorite($obj){var $parentCont,className,$prodPanel=$obj.parents(".prodPanel");0!=$prodPanel.length&&(className=$prodPanel.attr("class"),$parentCont=$prodPanel);var $quickView=$obj.parents(".quickView");0!=$quickView.length&&(className=$quickView.attr("class"),$parentCont=$quickView);var options={type:"post",data:{className:className},success:function(data){data=JSON.stringify(data),changeWishListInfo(data,""),lookupFavorites(null)},dataType:"json"},$parent=$obj.parent(),$form=$parent.find("#updateWishListForm");$form.ajaxSubmit(options)}function addToMyFavoritesForm(object){var skuId;if(""!=object){var $prodBrief=$(object).parents(".prodBrief");null!=$prodBrief&&(skuId=$prodBrief.find("#briefSkuId").html())}else skuId=$("#briefSkuId").html();skuId=skuId&&$.trim(skuId).replace(/^#?/i,""),$("#addToGiftlistItemId").length>0&&$("#addToGiftlistItemId").val(skuId),$("#addToGiftlistItemIdQV").length>0&&$("#addToGiftlistItemIdQV").val(skuId);var checkedLensColor=$.trim($("#checkedLensColor").html()),colorDescription=$.trim($("#colorDescription").html());$("#addToGiftListColor").val(colorDescription),$("#addToGiftListLensColor").val(checkedLensColor),$("#addToGiftListHasOptionValue").val($("#hasOptionValue").val());var $parent,json='{"favStatus" : "true"}',className="",$prodPanel=$(object).parents(".prodPanel"),$quickView=$(object).parents(".quickView");0!=$prodPanel.length&&($parent=$prodPanel),0!=$quickView.length&&($parent=$quickView),0==$(object).parents(".accessory").length?null!=$parent&&(className=$parent.attr("class")):null!=$parent&&(className=$parent.attr("class"));var options={type:"post",sortType:"ASC",data:{className:className},success:function(data){changeWishListInfo(json,"."+className),lookupFavorites(data)},dataType:"json"};$("#addToWishListForm").ajaxSubmit(options),"function"==typeof addFavoriteCallback&&addFavoriteCallback(skuId)}function changeFavoriteStatus(param,status){null!=status&&("true"==status?($(param+" .addFavorites").find(".icon_favorite").hide(),$(param+" .addFavorites").find(".icon_favorite").next("a").hide(),$(param+" .addFavorites").find(".icon_favClick").show(),$(param+" .addFavorites").find(".icon_favClick").next("a").show(),$(param+" .addFavorites").find(".icon_favClick").next("a").attr("favstatus",!0)):($(param+" .addFavorites").find(".icon_favorite").show(),$(param+" .addFavorites").find(".icon_favorite").next("a").show(),$(param+" .addFavorites").find(".icon_favClick").hide(),$(param+" .addFavorites").find(".icon_favClick").next("a").hide(),$(param+" .addFavorites").find(".icon_favorite").next("a").attr("favstatus",!1)),$(param).find(".colorCon a.recently").find("input[name='colorCon']").attr("data-favstatus",status))}function changeWishListInfo(obj,param){if(null!=obj){var data=$.parseJSON(obj);null==data&&(data=obj),null!=data.className&&(param="."+data.className),null!=data.favStatus&&changeFavoriteStatus(param,data.favStatus),null!=data.wishListItemId&&$("#removeGiftitemIds").val(data.wishListItemId)}}function addToMyFavoritesHV(obj){var skuId=$(obj).attr("skuid");$.ajax({url:"/misc/ajax/profile.jsp?"+Math.random(),success:function(str){var options={type:"post",sortType:"ASC",errorUrl:window.location.href,success:lookupFavorites,dataType:"json"},form=$(obj).parents(".thumbOver").find(".addToWishListFormHV");$(form).find("#addToGiftlistItemIdHV").val(skuId);var loadedParams=$.trim(str),wishListIdFormInput=$(form).find(".addToGiftlistId"),sessionNumber=$(form).find("input[name='_dynSessConf']");if(""!=loadedParams&&wishListIdFormInput){var dynamicParams=loadedParams.split("|");dynamicParams[0]&&wishListIdFormInput.val(dynamicParams[0]),dynamicParams[1]&&sessionNumber.val(dynamicParams[1])}$(form).ajaxSubmit(options),"function"==typeof addFavoriteCallback&&addFavoriteCallback(skuId)},error:function(){}})}function lookupFavorites(data){if(null!=data){var giftItemId=data.newFavorite,className=data.className;if(""!=className){var jsonData,dataObj=$("."+className).find(".colorCon a.recently").find("var");if(dataObj&&$(dataObj).size()>0){jsonData=$.parseJSON($(dataObj).text()),jsonData.wishlistItemId=giftItemId;var varStringValue=$.toJSON(jsonData);$("."+className).find(".colorCon a.recently").find("var").text(varStringValue)}else dataObj=$("."+className).find(".colorCon a.recently").find("input"),dataObj.attr("data-wishlistitemid",giftItemId);$("."+className).length>0&&$("."+className).find("#updateWishListForm #removeGiftitemIds").val(giftItemId)}}$.ajax({type:"POST",url:rootPath+"/misc/ajax/productDetaill/jsonFavorites.jsp",success:renderMyFavorites})}function renderMyFavorites(data){var tabUnits=$(".favorites.tabs .tabTitle .tabUnit");tabUnits.eq(0).hasClass("recently")||(tabUnits.eq(0).addClass("recently").siblings().removeClass("recently"),$(".favorites.tabs").find(".tabItem").eq(0).addClass("show").siblings().removeClass("show"));var html="",$tabItem=$(".favorites .tabContent .tabItem").eq(0),contentH=parseFloat($tabItem.find(".carouselContent").css("height"));html=data,$tabItem.find(".carouselContent").hasClass("noItem")?($tabItem.find(".carouselContent").removeClass("noItem"),contentH=0):$tabItem.find(".productList").html(""),$tabItem.find(".productList").html(html),$tabItem.find(".productList li").length<=3&&$tabItem.find(".carouselContent").css("height",$(".favorites .productList li").eq(0).outerHeight()*$tabItem.find(".productList li").length),$tabItem.find(".update").trigger("click"),$tabItem.find(".changeCurrentItem").trigger("click");var amount=$("#favoriteSize").val();return $("#pdpFavoriteSize").html(amount),0==amount?void $(".viewAll").addClass("hidden"):void $(".viewAll").removeClass("hidden")}function backOfFacebookLike(data){null!=data.attr("data-shareurl")&&($(".fb-like").attr("data-href",$.trim(data.attr("data-shareurl"))),"undefined"!=typeof FB&&FB.XFBML.parse());var pinterestShare=data.attr("data-pinterestshare"),facebookShare=data.attr("data-facebookshare"),twitterShare=data.attr("data-twittershare");$(".icon_pinterest").html('<var>{"url":"'+pinterestShare+'"}</var>'),$(".icon_facebook").html('<var>{"url":"'+facebookShare+'"}</var>'),$(".icon_twitter").html('<var>{"url":"'+twitterShare+'"}</var>')}function setNewAndSale(parent,isNew,onSale){if(0!=parent.length&&(changeNewAndOnsaleFlag(parent,isNew,onSale),$(parent).closest(".recCarousel").size()>0)){var index=$(parent).find("var").last().text(),$currentItem=$(parent).closest(".recCarousel").find(".carouselContent > ul > li.carouselItem").eq(index),$prodItem=$currentItem.find(".prodItem"),$thumbOver=$currentItem.find(".thumbOver");changeNewAndOnsaleFlag($prodItem,isNew,onSale),changeNewAndOnsaleFlag($thumbOver,isNew,onSale)}}function changeNewAndOnsaleFlag(parent,isNew,onSale){if("true"==isNew){var newIcon=$(parent).find(".icon_new");$(newIcon).show()}else{var newIcon=$(parent).find(".icon_new");$(newIcon).hide()}if("true"==onSale){var saleIcon=$(parent).find(".icon_sale");$(saleIcon).show();var price=$(parent).find(".prodInfo .price");null!=price&&$(price).addClass("salePrice")}else{var saleIcon=$(parent).find(".icon_sale");$(saleIcon).hide();var price=$(parent).find(".prodInfo .price");null!=price&&$(price).removeClass("salePrice")}}function bindAddToCartForQV(){$("#addToCartBtnQV").hasClass("lightYellow")&&addToCartQV()}function bindFromSubmit(){var pageId=$("#windowPageId").val(),inventoryQTY=$("#availableInventoryQTYInput").val(),options={type:"post",data:{pageId:pageId,availableInventoryQTY:inventoryQTY},success:renderQuickView,
dataType:"json"};$("#addToCartFormQV").ajaxSubmit(options)}function renderQuickView(data){var validationErrors=data.mValidationErrors,formExceptions=data.mFormExceptions;if(validationErrors||formExceptions)renderErrorMessages(validationErrors,formExceptions);else{var successUrl=data.successUrl;location.href=successUrl}}function renderErrorMessages(validationErrors,formExceptions){var strengthSelectError=validationErrors[strengthSelect],outOfStockError=(validationErrors[colorSelect],validationErrors[outOfStock]),lensColorSelectError=validationErrors[lensColorSelect],stockThresholdError=validationErrors[stockThreshold],beyondThreholdError=validationErrors[beyondThrehold];null!=strengthSelectError&&($("#propertySpan").addClass("error"),$("#propertyErrorMsgQV").html(strengthSelectError).show()),null!=outOfStockError&&($("#inventoryErrorQV").html(outOfStockError).show(),$("#quantityQV").addClass("error")),null!=stockThresholdError&&($("#inventoryErrorQV").html(stockThresholdError).show(),$("#quantityQV").addClass("error")),null!=beyondThreholdError&&($("#inventoryErrorQV").html(beyondThreholdError).show(),$("#quantityQV").addClass("error")),null!=lensColorSelectError&&($("#propertySpan").addClass("error"),$("#propertyErrorMsgQV").html(lensColorSelectError).show())}function hiddenErrors(){$("#propertySpan").removeClass("error"),$("#quantityQV").removeClass("error"),$("#propertyErrorMsg").hide(),$("#propertyErrorMsgQV").hide(),$("#inventoryError").hide(),$("#inventoryErrorQV").hide()}function getRootPath(){var curWwwPath=window.document.location.href,pathName=window.document.location.pathname,pos=curWwwPath.indexOf(pathName),localhostPaht=curWwwPath.substring(0,pos);return localhostPaht}function addToCartQV(){if(hiddenErrors(),$("#addToCartBtnQV").hasClass("lightYellow")){var flag=preInputValueForSubmitQV();if(flag)return void bindFromSubmit();$(".strength").addClass("error"),$("#selectStrength"+suffix).addClass("error")}}function addToCart(){var flag=preInputValueForSubmit();return flag?($(".productShop .addCartBox").length&&$(".productShop .addCartBox").append('<div style="top:10px;left:0px;" class="loading"><span></span></div>'),void $("#addItemToOrderBtn").click()):($(".strength").addClass("error"),void $("#selectStrength").addClass("error"))}function preInputValueForSubmit(){if(checkError()){if("egc-sku"==$("#productType").val())return!0;var qty=$("#qty").html();""==qty?$("#addItemToOrderQty").val(0):$("#addItemToOrderQty").val(qty);var pattern=($("#checkedLensColor").html(),/^\d+\.{0,1}\d+$/),strength=$("#selectStrength"+suffix).val();return null!=strength&&(0!=strength.indexOf("-")&&0!=strength.indexOf("+")||(strength=strength.substring(1))),pattern.test(strength)?$("#addItemToOrderStrength").val(strength):$("#addItemToOrderStrength").val(""),$("#addItemToOrderLensColor").val($("#selectLensColor").val()),!0}return!1}function preInputValueForSubmitQV(){if(checkError()){""==suffix&&(suffix="QV");var skuId=$(".quickView #briefSkuId").html();if(skuId.indexOf("#")>-1&&(skuId=skuId.substr(skuId.indexOf("#")+1)),$("#addItemToOrderSkuIdQV").val(skuId),"egc-sku"==$("#productType").val())return!0;var qty=$("#qty"+suffix).html();""==qty?$("#addItemToOrderQtyQV").val(0):$("#addItemToOrderQtyQV").val(qty);var pattern=($("#checkedLensColorQV"+suffix).html(),/^\d+\.{0,1}\d+$/),strength=$("#selectStrength"+suffix).val();return null!=strength&&(0!=strength.indexOf("-")&&0!=strength.indexOf("+")||(strength=strength.substring(1))),pattern.test(strength)?$("#addItemToOrderStrengthQV").val(strength):$("#addItemToOrderStrengthQV").val(""),"-Select Your LensColor-"==$("#checkedLensColor"+suffix).html()?$("#addItemToOrderLensColorQV").val(""):$("#addItemToOrderLensColorQV").val($("#checkedLensColor"+suffix).html()),!0}return!1}function setEgcMediaPath(data){$("#egcName"+suffix).html($(data).attr("name"));var id=$(data).attr("id");$("#egcMediaImageId"+suffix).val(id)}function setStaticHostUrl(url){staticHostUrl=url}function checkError(){if("fixedPrescriptionFrameSku"==$("#productType"+suffix)){var strength=$("#checkedStrength"+suffix).html();if(!isNaN(strength)||""==$(".colorName").html)return!1}return!0}function lookupProduct(pageType){hiddenErrors(),$("#qtyBoxLi"+suffix).show(),setPageType(pageType),$("#errorHeader"+suffix).hide(),$("#errorSpan"+suffix).removeClass("error");var productId=$("#productId"+suffix).val(),color=$("#checkedColor"+suffix).val();staticHostUrl=$("#staticHostUrl"+suffix).val();var type=$("#productType"+suffix).val(),strength=$("#selectStrength"+suffix).val(),lensColor=$("#selectLensColor"+suffix).val();return null!=color&&null!=strength?void $.ajax({type:"POST",url:rootPath+"/misc/ajax/jsonLookSkuProperties.jsp",data:{pId:productId,color:color,strength:strength,lensColor:lensColor,type:type,pageType:pageType,outputFormat:"json"},success:backOfSkuDataInfo,dataType:"json"}):null!=color&&null!=lensColor?void $.ajax({type:"POST",url:rootPath+"/misc/ajax/jsonLookSkuProperties.jsp",data:{pId:productId,color:color,strength:strength,lensColor:lensColor,type:type,pageType:pageType,outputFormat:"json"},success:backOfSkuDataInfo,dataType:"json"}):void 0}function lookSkuProperties(color,pId,pType,pPageType){null==color&&null==pId||$.ajax({type:"POST",url:rootPath+"/misc/ajax/jsonLookSkuProperties.jsp",data:{pId:pId,color:color,type:pType,pageType:pPageType,outputFormat:"json"},success:backOfSkuDataInfo,dataType:"json"})}function lensColorChange(data){$("#selectLensColor"+suffix).val(data)}function backOfSkuDataInfo(data){var pageType="";null!=data.pageType&&(pageType=data.pageType,"quickViewPage"==pageType&&(suffix="QV"),"normalPage"==pageType&&(suffix=""));var sku=data.sku;if(null!=sku){$("#heroImg"+suffix).attr("src",sku.image),$("#addItemToOrderSkuId"+suffix).val(sku.skuId);var priceInfo=sku.priceInfo;if($("#briefSkuId"+suffix).html("#"+sku.skuId),null!=priceInfo)if(null!=priceInfo.was){$("#priceLi"+suffix).addClass("sale");var $child=$("#priceLi"+suffix).children("span"),onlyListSpan=$("#priceLi"+suffix).children("span")[0];$(onlyListSpan).html(""),$child.appendTo($("#priceLi"+suffix)),$("#oldPrice"+suffix).show(),$("#salePrice"+suffix).show(),$("#salePrice"+suffix).html(priceInfo.now),$("#oldPrice"+suffix).html(priceInfo.was),$("#oldPrice"+suffix).attr("style",""),$("#salePrice"+suffix).attr("style","")}else{var $child=$("#priceLi"+suffix).children("span"),onlyListSpan=($("#priceLi"+suffix).html(),$("#priceLi"+suffix).children("span")[0]);$(onlyListSpan).html(priceInfo.now),$child.appendTo($("#priceLi"+suffix)),$("#priceLi"+suffix).removeClass("sale"),$("#salePrice"+suffix).hide(),$("#oldPrice"+suffix).hide()}var inventoryStatus=sku.inventoryStatus;1001==inventoryStatus&&($("#addToCartBtn"+suffix).html("OUT OF STOCK"),$("#addToCartBtn"+suffix).unbind("click"),$("#addToCartBtn"+suffix).addClass("gray"),$("#qtyBoxLi"+suffix).hide(),$("#addToCartBtn"+suffix).removeClass("lightYellow"),$("#qtyBoxLi"+suffix).hide()),1e3==inventoryStatus&&($("#addToCartBtn"+suffix).html("ADD TO CART<span class='icon_arrowR'></span>"),$("#addToCartBtn"+suffix).addClass("lightYellow"),$("#addToCartBtn"+suffix).removeClass("gray"),$("#qtyBoxLi"+suffix).show(),"QV"==suffix?($("#addToCartBtn"+suffix).unbind("click"),$("#addToCartBtn"+suffix).bind("click",addToCartQV)):($("#addToCartBtn").unbind("click"),$("#addToCartBtn").bind("click",addToCart)))}var strengths=data.strengths,hasOptionValue=data.hasOptionValue;hasOptionValue?$("#addCartBox"+suffix).removeClass("noSelect"):$("#addCartBox"+suffix).addClass("noSelect"),$("#hasOptionValue"+suffix).val(hasOptionValue);var lensColors=data.lensColors;if(null!=strengths){var html="<option value=>-Select Your Strength-</option>";if(0!=strengths.length){for(var i=0;i<strengths.length;i++)html+=strengths[i]>0?"<option value="+strengths[i]+">+"+strengths[i]+"</option>":"<option value="+strengths[i]+">"+strengths[i]+"</option>";return $("#selectStrength"+suffix).empty(),$("#selectStrength"+suffix).append(html),void(null!=$("#addToCartBtn"+suffix)&&($("#addToCartBtn"+suffix).html("ADD TO CART<span class='icon_arrowR'></span>"),$("#addToCartBtn"+suffix).addClass("lightYellow"),$("#addToCartBtn"+suffix).removeClass("gray"),$("#qtyBoxLi"+suffix).show()))}$("#selectStrength"+suffix).empty(),$("#selectStrength"+suffix).append(html)}if(null!=lensColors){var html="<option value=>-Select Your LensColor-</option>";for(var lensColor in lensColors){var value=lensColors[lensColor],key=lensColor;html+='<option value="'+key+'">'+value+"</option>"}$("#selectLensColor"+suffix).empty(),$("#selectLensColor"+suffix).append(html),null!=$("#addToCartBtn"+suffix)&&($("#addToCartBtn"+suffix).html("ADD TO CART<span class='icon_arrowR'></span>"),$("#addToCartBtn"+suffix).addClass("lightYellow"),$("#addToCartBtn"+suffix).removeClass("gray"),$("#qtyBoxLi"+suffix).show())}}function setSkuProperties(color,pId,pType,colorDescriptor,pageType){hiddenErrors(),$("#qtyBoxLi"+suffix).show(),setPageType(pageType),$("#productColor"+suffix).val(color),$("#checkedStrength"+suffix).html($("#selectStrength"+suffix+" option:first").html()).addClass("gray"),$("#checkedLensColor"+suffix).html($("#selectLensColor"+suffix+" option:first").html()).addClass("gray"),$("#colorDescription"+suffix).html(colorDescriptor),staticHostUrl=$("#staticHostUrl").val(),$("#checkedColor"+suffix).val(color),$("#addItemToOrderColor"+suffix).val(color),lookSkuProperties(color,pId,pType,pageType)}function getSkuInfo(pId,pSkuId){var option={pId:pId,skuId:pSkuId};$.ajax({data:option,type:"POST",url:rootPath+"/misc/ajax/productDetaill/fixedRX/product_shop.jsp",success:backOfSkuDate})}function getSkuInfoQv(pId,pSkuId){var option={pId:pId,skuId:pSkuId};$.ajax({data:option,type:"POST",url:rootPath+"/misc/ajax/productDetaill/fixedRX/product_shop.jsp",success:backOfSkuDateQv})}function backOfSkuDate(data){$(".prodPanel .productShop").html(""),$(".prodPanel .productShop").html(data)}function backOfSkuDateQv(data){$(".qvContainer .productShop").html(""),$(".qvContainer .productShop").html(data)}function showMutableErrorMessage(message,id){var $errorBox=$(".fixedRX").parent().find(".errorBox");$errorBox.find("p").text(message),$(this).acsPopup({popupSrc:"",popupTitle:"error",maxWidth:650,maxHeight:550,popupID:"error_"+id,popupContentPreload:$errorBox,callBack:function(setting){$("#error_"+id).find(".btnOK").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)})}})}function clearErrorInQty(){$("#quantity"+suffix).removeClass("error"),$("#errorHeader"+suffix).hide()}function setPageType(pageType){null==pageType&&(suffix=""),"quickViewPage"==pageType&&(suffix="QV"),"normalPage"==pageType&&(suffix="")}function redirectToWriteRatingPage(thisTag,ratingPage){window.location.href=ratingPage}function pinterestShare(imagePath,url,displayName){$.parseJSON($("#pinterestShare").find("var").text())}function popupError(validateError,formError){}function chooseDefaultSku(skuId,productId,data){var url=$(data).attr("pdpUrl"),parent=$(data).parents(".thumbOver"),img=$(parent).find(".toPdpPage"),order=$(parent).find(".btnOrder");null==url&&(url=$(img).attr("href")),$(img).attr("href",url);var rx=$(data).parents(".rx");rx.length>0||$(order).attr("href",url)}function prodItemChooseDefaultSku(skuId,productId,data){$(data).parent().parent().parent().find(".thumbOver").find("#endecaSkuId").val(skuId),$(data).parent().parent().parent().find(".thumbOver").find("#endecaProductId").val(productId)}function orderToPDP(id,pdpUrl,data){}function goToPdp(pdpUrl,pId,skuId){window.location.href=rootPath+pdpUrl+"?pId="+pId+"&skuId="+skuId}function backOfNonRxInfo(data){$("#mainSection .productShop.nonRX").html(""),$("#mainSection .productShop.nonRX").html(data),$.CommonUtils.changeColor($("#mainSection .nonRX .colorCon a.recently"),$(".l_prodPanel")),$("#quantity").removeClass("error"),$("#outOfStockEmailInput").val(""),$("#outOfStockEmailMessage").html(""),$("#outOfStock").length>0?$("#outOfStockSignUp").show():$("#outOfStockSignUp").hide()}function getFixedSkuInfo(pId,pSkuId){var option={pId:pId,skuId:pSkuId};$.ajax({data:option,type:"POST",url:rootPath+"/misc/ajax/productDetaill/fixedRX/product_shop.jsp",success:backOfFixSkuDate})}function backOfFixSkuDate(data){$("#mainSection .productShop.fixedRX").html(""),$("#mainSection .productShop.fixedRX").html(data),$("#outOfStockEmailInput").val(""),$("#outOfStockEmailMessage").html(""),$("#outOfStock").length>0?$("#outOfStockSignUp").show():$("#outOfStockSignUp").hide()}function filterOnchange(option,page,pdp){var selected=$(option).find("option:selected").val();window.location.href=pdp+"&page="+page+"&"+selected}function filterOnlyRatingOnchange(option,page,pdp){var selected=$(option).find("option:selected").val();url=pdp+"?"+selected+"&action=ajax&randomKey="+Math.random();var $loading=$(this).closest(".ratingReview").find(".loading");$loading.show(),$.ajax({type:"POST",url:url,data:"",success:function(str){$(".ratingReview #voteForm").replaceWith($(str).find(".ratingReview #voteForm")),$loading.hide()},error:function(){$loading.hide()}})}function clearForm(id){$("#"+id+"_flag").hide(),$("#"+id+"_emailAddress").val(""),$("#"+id+"_comments").val("")}function voteReview(isHelp,isFlag,revieweeId){if("true"==isFlag){$("#writeFlag").val("true");var emailAddress=$("#"+revieweeId+"_emailAddress").val();if(!emailAddress)return void $("#"+revieweeId+"_emailAddress").attr("class","textInput error");var comments=$("#"+revieweeId+"_comments").val();$("#email_address_input").val(emailAddress),$("#comments_input").val(comments);var name=revieweeId+"_commentTag",tagValue=$("input[name='"+name+"']:checked").val();$("#comment_tag_input").val(tagValue)}"true"==isHelp&&$("#helpful").val("true"),"true"!=isHelp&&"true"!=isFlag&&$("#helpful").val("false"),$("#revieweeInput").val(revieweeId);var options={type:"post",dataType:"json",success:function(data){$("#"+revieweeId+"_flag").hide(),alert(data),$("#"+revieweeId+"_FeedBack").show(),"true"==isFlag&&($("#writeFlag").val(""),$("#"+revieweeId+"_emailAddress").val(""),$("#"+revieweeId+"_comments").val(""),$("#email_address_input").val(""),$("#comments_input").val(""),$("#comment_tag_input").val(""))},error:function(data){$("#"+revieweeId+"_flag").hide(),$("#"+revieweeId+"_FeedBack").show(),"true"==isFlag&&($("#writeFlag").val(""),$("#email_address_input").val(""),$("#comments_input").val(""),$("#comment_tag_input").val(""),$("#"+revieweeId+"_emailAddress").val(""),$("#"+revieweeId+"_comments").val(""))}};$("#voteForm").ajaxSubmit(options)}$(function(){$.pdpCommonUtils={doSubmit:function(params){$.ajax({url:params.url,success:function(str){var $currentSection=$("."+params.currentName).closest(".productOrder");$currentSection.html(str);var $innerSection=$currentSection.children();$currentSection.children().unwrap(),$.ajax({url:params.nextUrl,success:function(str){$innerSection.next().html(str),$innerSection.next().children(".productOrder").removeClass("disable"),$innerSection.next().children().unwrap()}})},error:function(){}})},doEdit:function(params){$.ajax({url:params.url,success:function(str){var $currentSection=$("."+params.currentName).closest(".productOrder"),$nextNodes=$currentSection.nextAll(".productOrder");$currentSection.html(str),$currentSection.children().removeClass("disable"),$currentSection.children().unwrap(),$nextNodes.addClass("disable"),$nextNodes.find(".blue").removeClass("blue")},error:function(){}})},changeCheckBox:function($obj,$content){$obj.is(":checked")?$content.hide():$content.show()},getRatingSBlue:function(ratingVal){switch(ratingVal){case"0":return"648";case"0.5":return"666";case"1.0":return"684";case"1.5":return"702";case"2.0":return"720";case"2.5":return"738";case"3.0":return"756";case"3.5":return"774";case"4.0":return"792";case"4.5":return"810";case"5.0":return"828";default:return"828"}},gradeVal:function(value){var grades=["Click to rate this product","Not Good","Needs That Special Something","Average, Ordinary","That's Good Stuff","Perfect. It doesn't get any better"];$(".writeReview .grade > .gradeOption").css("background-position","0 "+value*-63.2+"px"),$(".writeReview .grade .gradeDesc").html(grades[value])},doAnimate:function($obj){(!$.browser.msie||7!=$.browser.version&&8!=$.browser.version)&&$obj.slideUp(10).slideDown(1200,function(){$("html, body").animate({scrollTop:$obj.offset().top},"800",function(){$("#error_exchargeMessage").length&&$("#error_exchargeMessage").css("top",$obj.offset().top+100+"px")})})},doAnimateEdit:function($obj,message){!$.browser.msie||7!=$.browser.version&&8!=$.browser.version?$obj.slideUp(10).html(message).slideDown(1200,function(){$("html, body").animate({scrollTop:$obj.offset().top},"800",function(){$("#error_exchargeMessage").length&&$("#error_exchargeMessage").css("top",$obj.offset().top+100+"px")})}):$obj.html(message)},doFixedScroll:function(){if(!($(".productOrder").length<=0||$(".prodPanel").length<=0)){var prodParent=$(".prodPanel"),fixedDom=prodParent.find(".r_prodPanel");prodParent.css("position","relative"),$(window).bind("scroll resize",function(){var dt=prodParent.offset().top,st=$(this).scrollTop(),ww=$("#mainSection").width(),cw=fixedDom.outerWidth(),ch=fixedDom.outerHeight(),ml=parseInt(ww)/2-parseInt(cw),bt=prodParent.outerHeight();st>=dt&&bt+dt>=ch+st?fixedDom.css({top:0,left:"50%",position:"fixed","margin-top":0,"margin-left":ml}):st>=dt&&bt+dt<ch+st?fixedDom.css({top:0,left:"50%","margin-top":bt-ch,position:"absolute","margin-left":ml}):fixedDom.css({top:0,left:"50%","margin-top":"10px",position:"absolute","margin-left":ml})})}}}}),$(document).ready(function(){$.pdpCommonUtils.doFixedScroll(),enquire.register("screen and (min-width: 736px)",{match:function(){$(".prodPanel .changeLensShape").live("click.desktop",function(e){e.preventDefault(),$.CommonUtils.lensShapePop($(this),".prodPanel"),$.browser.msie&&"7.0"==$.browser.version&&$(".orderGlass .orderList").size()>0&&$(".orderGlass .orderList").css("z-index","101")}),$(".prodPanel .lensBox a").live("click.desktop",function(e){e.preventDefault(),$.CommonUtils.ininLensShape($(this),$(".prodPanel .lensImg")),$.CommonUtils.closeLensBox($(this),".prodPanel"),$.browser.msie&&"7.0"==$.browser.version&&$(".orderGlass .orderList").size()>0&&$(".orderGlass .orderList").css("z-index","1")})},unmatch:function(){$(".prodPanel .changeLensShape").die("click.desktop"),$(".prodPanel .lensBox a").die("click.desktop")}}),enquire.register("screen and (max-width: 735px)",{match:function(){$(".prodPanel .changeLensShape").live("click.mobile",$.CommonUtils.lensShapePopMobile)},unmatch:function(){$(".prodPanel .changeLensShape").die("click.mobile")}}),$(".l_prodPanel .selectColor a").live("click",function(e){e.preventDefault(),$(this).addClass("recently").siblings().removeClass("recently"),$(this).closest(".colorBox").find(".colorName").text($(this).attr("name")),$.CommonUtils.changeColor($(this),$(".l_prodPanel"));var dataObj=$(this).find("input"),productInfo={};dataObj&&(productInfo={sku:dataObj.data("sku")||dataObj.data("skuid")});var skuId=productInfo.sku;$("#h1SkuId").text(skuId);var altValue=$(".heroImg").attr("alt"),specialIndex=altValue.indexOf("#"),finalResult=altValue.substring(0,specialIndex);finalResult=jQuery.trim(finalResult)+" #"+skuId,$(".heroImg").attr("alt",finalResult);var titleValue=$(".heroImg").attr("title");if(titleValue){var indexTitle=titleValue.lastIndexOf(" ");titleValue=titleValue.substring(0,indexTitle),titleValue=titleValue+" "+skuId,$(".heroImg").attr("title",titleValue)}}),$.touchUtil.isTouch||$(".l_prodPanel .selectColor a").live("mouseenter",function(e){e.preventDefault(),$(this).closest(".colorBox").find(".colorName").text($(this).attr("name")),$.CommonUtils.changeColor($(this),$(".l_prodPanel"))}).live("mouseleave",function(e){e.preventDefault(),$(this).closest(".colorBox").find(".colorName").text($(".l_prodPanel .selectColor .colorCon .recently").attr("name")),$.CommonUtils.changeColor($(".l_prodPanel .selectColor .colorCon .recently"),$(".l_prodPanel"))}),$(".theDetails .shareBox a").live("click",function(e){e.preventDefault();var data=$.parseJSON($(this).find("var").text()),url=encodeURI(data.url);$.browser.msie?window.open(url,"","width=600,height=700,left=400,top=50"):window.open(url,"","fullscreen=yes")}),$(".orderGlass .changeColor .changeBtn").on("click",function(e){e.preventDefault(),$(this).closest(".orderGlass").find(".colorBox").show()}),$(".orderGlass .colorBox .close").on("click",function(e){e.preventDefault(),$(this).closest(".colorBox").hide()}),$(".orderGlass .colorBox .colorCon a").on("click",function(e){e.preventDefault(),e.stopImmediatePropagation();var data={mainProductId:$(this).data("mainproductid"),mainSkuId:$(this).data("mainskuid"),description:$(this).data("description"),selected:$(this).data("selected"),backFrameLink:$(this).data("backframelink")};data&&changeMainSku(data.mainProductId,data.mainSkuId,data.description,data.selected,data.backFrameLink)}),$(".productOrder .importPreLink").live("click",function(e){e.preventDefault(),$(this).acsPopup({popupSrc:$(this).attr("layerSrc"),popupTitle:$(this).attr("layerTitle"),maxWidth:650,maxHeight:550,initWidth:650,popupID:"pop_importPre",jsonData:{pageid:Math.random()},callBack:function(setting){$(".importPre .btn_ok").live("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)})}})}),$(".importPre .btn_back").live("click",function(e){e.preventDefault();var $step=$(this).closest('div[class^="step"]');$step.hide().prevAll('div[class^="step"]').eq(0).show(),$(this).closest(".importPre").find(".popResize").trigger("click"),$step.detach()}),$(".importPre .step01 .btn_importPre").live("click",function(e){e.preventDefault();var $importPre=$(this).closest(".importPre"),$obj=$(".importPre .step01").removeClass("step01");$.ajax({url:"/cartridges/productOrder/importPrescript/step02.jsp",success:function(str){$importPre.append(str),$obj.addClass("step01"),$importPre.find(".step01").hide(),$importPre.find(".popResize").trigger("click"),$.touchUtil.isTouch?$(".importPre .step02 .itemList").css("overflow","auto"):$(".importPre .step02 .itemList").acsScrollBar({scrollContainer:$(this)})},error:function(){}})}),$(".importPre .step02 .btn_select").live("click",function(e){e.preventDefault();var $importPre=$(this).closest(".importPre");$.ajax({url:"/cartridges/productOrder/importPrescript/step03.jsp",success:function(str){$importPre.append(str),$importPre.find(".step02").hide();var realHeight=0;$(".prescriptCarousel .carouselContent li.carouselItem").each(function(){var height=$(this).outerHeight();height>realHeight&&(realHeight=height)}),$(".prescriptCarousel .carouselContent").css("height",realHeight+"px"),$importPre.find(".popResize").trigger("click"),$.CommonUtils.initPreCarousel($(".importPre .prescriptCarousel"),$(".importPre")),$(".importPre .step03 .btn_import").live("click",function(e){e.preventDefault(),$(this).closest("#pop_importPre").prev(".popupLayerBg").detach(),$(this).closest("#pop_importPre").detach()})},error:function(){}})}),$(".prismInfo").find(".radio").live("click",function(){var $infoODOS=$(this).closest(".prismInfo").find(".infoODOS");$(this).hasClass("no")?$infoODOS.hide().addClass("hidden"):$infoODOS.show().removeClass("hidden")}),$(".savePrescript input[type=checkbox]").live("mouseup",function(){var $content=$(this).parent().parent().next("div");$(this).is(":checked")?($(this).closest(".savePrescript").css("margin-bottom","-42px"),$content.hide()):($(this).closest(".savePrescript").css("margin-bottom","0"),$content.show())}),$(".personalization .popup_artChange").live("click",function(e){e.preventDefault(),$(this).acsPopup({popupSrc:$(this).attr("layerSrc"),popupTitle:$(this).attr("layerTitle"),maxWidth:650,maxHeight:550,popupID:"changeArtPop",callBack:function(setting){$.touchUtil.isTouch?$("."+setting.popupLayerContent).find(".artBox").css("overflow","auto"):$("."+setting.popupLayerContent).find(".artBox").acsScrollBar({scrollContainer:$("."+setting.popupLayerContent).find(".artBox")}),$("."+setting.popupLayerContent).find(".artBox a").live("click",function(e){e.preventDefault();var imgSrc=$(this).find("img").attr("src"),$artShow=$(".personalization .artOutside .artShow");$artShow.find("img").attr("src",imgSrc).show(),$artShow.find("span").remove(),acsPopup.popupLayerClose(setting)})}})}),$(".personalization .agreeBox p").live("click",function(){var msgID=$.trim($(this).find("var").text()),$obj=$(this);$.ajax({url:"/misc/ajax/artCopyRight.jsp",data:{msgID:msgID},success:function(str){$obj.acsPopup({popupSrc:"",popupTitle:"",maxWidth:700,maxHeight:550,popMsg:str,popupID:"artCR",callBack:function(setting){}})},error:function(){}})}),$(".personalization .checkTextIn").live("mousedown",function(){var $content=$(this).closest(".personalization").find(".textInside");$.pdpCommonUtils.changeCheckBox($(this),$content)}),$(".personalization .checkTextOut").live("mousedown",function(){var $content=$(this).closest(".personalization").find(".textOutside");$.pdpCommonUtils.changeCheckBox($(this),$content)}),$(".personalization .checkArtOut").live("mousedown",function(){var $content=$(this).closest(".personalization").find(".artOutside");$.pdpCommonUtils.changeCheckBox($(this),$content)}),$(".personalization .selColor > select").live("change",function(e){e.preventDefault();var colorVal=$(this).find("option:selected").attr("colorVal");$(this).closest(".outStyle").find(".colorShow").css({background:""+colorVal})}),$(".prescriptionBtn").live("click",function(e){e.preventDefault();var errorData={header:"ERROR",msgs:["Your PD is too small for the frame.","Both OS CYL and OS AXIS should equal 0 or not equal 0."]},warningData={header:"ARE YOUR SURE?",msgs:["You have entered both positive and negative SPH values, which is highly unusual. If you are sure about your entries, click OK.  Otherwise, click Cancel if you wish to edit your entries."]},msgLength=errorData.msgs.length+warningData.msgs.length,closePopNum=0,$wraningBox=$(this).closest(".productOrder").parent().find(".warningBox");if(warningData.msgs.length>0)for(var i=0;i<warningData.msgs.length;i++)$wraningBox.find("p").text(warningData.msgs[i]),$(this).acsPopup({popupSrc:"",popupTitle:warningData.header,maxWidth:650,maxHeight:550,popupID:"warning"+i,popupContentPreload:$wraningBox,callBack:function(setting){$("#warning"+i).find(".btnCancel").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)}),$("#warning"+i).find(".btnOK").on("click",function(e){if(e.preventDefault(),acsPopup.popupLayerClose(setting),closePopNum++,closePopNum==msgLength){var param={url:"/cartridges/productOrder/prescription.jsp",nextUrl:"/cartridges/productOrder/lensInfo_form.jsp",currentName:"prescriptionBtn"};$.pdpCommonUtils.doSubmit(param)}})}});var $errorBox=$(this).closest(".productOrder").parent().find(".errorBox");if(errorData.msgs.length>0)for(var i=0;i<errorData.msgs.length;i++)$errorBox.find("p").text(errorData.msgs[i]),$(this).acsPopup({popupSrc:"",popupTitle:errorData.header,maxWidth:650,maxHeight:550,popupID:"error"+i,popupContentPreload:$errorBox,callBack:function(setting){$("#error"+i).find(".btnOK").on("click",function(e){if(e.preventDefault(),acsPopup.popupLayerClose(setting),closePopNum++,closePopNum==msgLength){var param={url:"/cartridges/productOrder/prescription.jsp",nextUrl:"/cartridges/productOrder/lensInfo_form.jsp",currentName:"prescriptionBtn"};$.pdpCommonUtils.doSubmit(param)}})}})}),$(".lensInfoBtn").live("click",function(e){e.preventDefault();var param={url:"/cartridges/productOrder/lensInfo.jsp",nextUrl:"/cartridges/productOrder/addOnsInfo_form.jsp",currentName:"lensInfoBtn"};$.pdpCommonUtils.doSubmit(param)}),$(".prescriptionEditBtn").live("click",function(e){e.preventDefault();var param={url:"/cartridges/productOrder/prescription_form.jsp",currentName:"prescriptionEditBtn"};$.pdpCommonUtils.doEdit(param)}),$(".lensEditBtn").live("click",function(e){e.preventDefault();var param={url:"/cartridges/productOrder/lensInfo_form.jsp",currentName:"lensEditBtn"};$.pdpCommonUtils.doEdit(param)}),$(".thumbnail_eGC .imgBox a").on("click",function(e){e.preventDefault();var heroImage=$(this).attr("heroImg"),desc=$(this).attr("name");$(this).parent().find("a").removeClass("recently"),$(this).addClass("recently"),$(this).closest(".thumbnail_eGC").parent().find(".heroImage_eGC > img").attr("src",heroImage),$(this).parent().find("p > span").text(desc)}),$(".btn_OrderGiftCard").on("click",function(e){e.preventDefault(),$(".productShop.eGC").show()}),$("#egc_amount").keypress(function(event){var keyCode=event.which;return keyCode>=48&&keyCode<=57||8==keycode}),$("#egc_amount").live("change",function(){var amount=parseInt($("#egc_amount").val()),max=parseInt($("#egcMax").val()),min=parseInt($("#egcMin").val());isNaN(amount)?$("#egc_amount").val(""):amount<min?$("#egc_amount").val(min):amount>max?$("#egc_amount").val(max):$("#egc_amount").val(amount)}),$(".ratingReview .positiveReviewLink").on("click",function(e){e.preventDefault(),$(this).acsPopup({popupContentPreload:$(this).closest(".overallBox").find(".positiveReview"),popupTitle:$(this).attr("layerTitle"),maxHeight:$(window).width()>=750?400:800,initWidth:$(window).width()>=750?750:$(window).width()-50,realWidth:$(window).width()>=750?750:$(window).width()-50,popupID:"pop_readFullReview",callBack:function(setting){$.touchUtil.isTouch?$(this).css("overflow","auto"):$("#pop_readFullReview .positiveReview").acsScrollBar({scrollContainer:$(this)})}})}),$(".ratingReview .negativeReviewLink").on("click",function(e){e.preventDefault(),$(this).acsPopup({popupContentPreload:$(this).closest(".overallBox").find(".negativeReview"),popupTitle:$(this).attr("layerTitle"),maxHeight:$(window).width()>=750?700:800,initWidth:$(window).width()>=750?750:$(window).width()-50,realWidth:$(window).width()>=750?750:$(window).width()-50,popupID:"pop_readFullReview",callBack:function(setting){$.touchUtil.isTouch?$(this).css("overflow","auto"):$("#pop_readFullReview .negativeReview").acsScrollBar({scrollContainer:$(this)})}})}),$(".rrItem .comments p > a").on("click",function(e){e.preventDefault(),$(this).addClass("clicked"),"flag"==$(this).html().toLowerCase()&&($(this).closest(".comments").find(".review_flag").show(),$(this).closest(".rrItem").siblings().find(".review_flag").hide())}),$(".rrItem .comments .review_flag .btnCancel").on("click",function(e){e.preventDefault(),$(this).closest(".review_flag").hide()}),$(".rrItem .comments .review_flag .btnSubmit").on("click",function(e){e.preventDefault(),$(this).closest(".review_flag").hide()}),$("body").on("click",".ratingReview .rrPage .pagination a",function(e){e.preventDefault();var $loading=$(this).closest(".ratingReview").find(".loading");$loading.show();var data=$.parseJSON($(this).find("var").text());return data.enable?void $.ajax({type:"POST",url:data.url+"&randomKey="+Math.random(),data:data,success:function(str){$(".ratingReview #voteForm").replaceWith($(str).find(".ratingReview #voteForm")),$loading.hide(),data.isBottom&&$(document).scrollTop($(".ratingReview #voteForm").offset().top)},error:function(){$loading.hide()}}):($loading.hide(),!1)}),$(".writeReview .headline a").on("click",function(e){e.preventDefault();var data=$.parseJSON($(this).find("var").text());$(this).children().hasClass("down")?($(this).find("span").removeClass("down"),$(this).find("em").text(data.show)):($(this).find("span").addClass("down"),$(this).find("em").text(data.hide)),$(this).parent().find(".exampleBox").toggle()}),$(".writeReview .gradeOption > a").hover(function(){var num=$(this).attr("name");$.pdpCommonUtils.gradeVal(num)},function(){var num=$(".writeReview .grade > #gradeId").val();$.pdpCommonUtils.gradeVal(num)}),$(".writeReview .gradeOption a").live("click",function(){var num=$(this).attr("name");$(".writeReview .grade > #gradeId").val(num),$.pdpCommonUtils.gradeVal(num)}),$(".tagAddInput").attr("placeholder","- Add Your Own -").addClass("tInput_ph"),$(".tagAddInput").placeholder("- Add Your Own -"),$(".writeReview .addTags").on("click",function(e){
e.preventDefault();var $dd=$(this).closest("dd"),tagName=$dd.find(".textInput").val(),result=!1;if(0!=$.trim(tagName).length){if($dd.find(".textInput").removeClass("error"),$dd.find("p.error").addClass("hidden"),$dd.find("ul > li").each(function(){$(this).text().toLowerCase()==$.trim(tagName).toLowerCase()&&(result=!0,$(this).find(".checkbox").addClass("checked"),$(this).find(".checkbox input[type=checkbox]").attr("checked","checked"))}),!result){var newLi="<li><span class='checkbox checked'><input type='checkbox' name='' value='' checked /></span>"+tagName+"</li>";$dd.find("ul").append(newLi),$dd.find("ul li:last-child").find("input[type=checkbox]").bind("click",function(){$(this).is(":checked")||$(this).closest("li").detach()})}}else $dd.find(".textInput").addClass("error"),$dd.find("p.error").removeClass("hidden")}),$(".writeReview .btnClear").on("click",function(e){e.preventDefault(),$(this).closest("dd").find(".radio").each(function(){$(this).hasClass("checked")&&($(this).removeClass("checked"),$(this).find("input[type='radio']").attr("checked",!1))})});var showHideHeadings=$(".theDetails .detailTitle, .ratingReview .reviewTitle");enquire.register("screen and (max-width: 540px)",{match:function(){showHideHeadings.addClass("showHide").siblings().hide()},unmatch:function(){showHideHeadings.removeClass("showHide showHide-displayed").siblings().show()}}),enquire.register("screen and (max-width: 735px)",{match:function(){$(".mobile_btn-try_on").on("click",function(e){e.preventDefault(),$.fn.acsPopup({popupSelector:".r_prodPanel",popupID:"frameFitModal",callBack:function(){$.FrameFitUtils.initFrameFit($("#frameFitModal .frameFit")),$.FrameFitUtils.initFrameFitHeight($("#frameFitModal .frameFit").find(".ffCarouselContent > ul")),$(".popupContent .frameFit_container .favorites.tabs").acsTabs({tabTitle:"tabTitle",tabContent:"tabContent",tabItem:"tabItem",tabTitleActive:"recently"})}})})},unmatch:function(){$(".mobile_btn-try_on").off("click")}})});var OutOfStock={createReminder:function(){var thisObj=this,email=$("#outOfStockEmailInput").val();$("#outOfStockEmail").val(email);var form=$("#outOfStockReminderForm");form.ajaxSubmit({type:"post",beforeSend:function(req){req.setRequestHeader("Accept","text/json")},success:function(data){var dataObj=eval("("+data+")");"true"==dataObj.success?($("#outOfStockEmailMessage").removeClass().addClass("successMsg"),$("#outOfStockEmailMessage").html(""),$("#outOfStockEmailMessage").append("Your reminder has been submitted.")):($("#outOfStockEmailMessage").removeClass().addClass("error"),$("#outOfStockEmailMessage").html(""),$("#outOfStockEmailMessage").append("<i>"+dataObj.errorMessage+"<i>"))},error:function(data){alert("error")}})},showOutOfStockSignUp:function(skuId){$("#outOfStockSignUp").show()}},elementName="elementName",eventName="eventName",targetElement=new Array,selectedPrescriptionSelectBox={},selectedPrescriptionRadio={},selectedPrescriptionCheckBox={},selectedPrescriptionText={};$(document).ready(function(){var prescriptionSelectBox=$("#selectedPrescriptionSelectBox").val(),prescriptionRadio=$("#selectedPrescriptionRadio").val(),prescriptionCheckBox=$("#selectedPrescriptionCheckBox").val(),prescriptionText=$("#selectedPrescriptionText").val();selectedPrescriptionSelectBox=$.parseJSON(prescriptionSelectBox),selectedPrescriptionRadio=$.parseJSON(prescriptionRadio),selectedPrescriptionCheckBox=$.parseJSON(prescriptionCheckBox),selectedPrescriptionText=$.parseJSON(prescriptionText),processOptions(),processDefaultValue(),processSelectedPrescription(),bindEvent(),addLensToOrderSummary(),addTintToOrderSummary(),calcPrice(),attachFaceIdToOrder(),cleanInputError(),$.ajaxSetup({async:!1})}),$(document).ready(function(){$("#addToCartBtn").live("click",addToCart),$("#addToCartBtnQV").live("click",bindAddToCartForQV),$(".productShop.fixedRX").find(".colorBox a").live("click",function(e){e.preventDefault();var colorName=$(this).attr("name"),smallColor=$(".frameFit.pdp").find(".carouselItem.currentItem .colorBox").find('a[name="'+colorName+'"]');1==smallColor.length&&smallColor.trigger("click");var skuText=$(this).find("var").text(),skuInfoText=$.parseJSON(skuText);getFixedSkuInfo(skuInfoText.pId,skuInfoText.sku)}),handleMyFavorites(),$(".prodItem .thumbOver .colorBox a").live("click",function(){var thumbOver=$(this).parents(".thumbOver");$(thumbOver).find(".addFav").attr("skuid",$(this).attr("skuid"))}),$(".thumbOver").find(".colorBox").find("a").live("click",function(){chooseDefaultSku("","",this)}),$(".prodItem .colorBox a").live("click",function(){var skuId=$(this).attr("skuid"),prodItem=$(this).parents(".prodItem"),quickView=$(prodItem).find(".styleBtn.white.btnQuickView");$(quickView).data("skuid",skuId)}),$(".prodItem .colorBox a,.thumbOver .colorBox a").live("click",function(){var dataObj=$(this).find('input[name="colorBox"]'),data={image:dataObj.data("image"),distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy"),hoverImage:dataObj.data("hoverimage"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew").toString(),onSale:dataObj.data("onsale").toString(),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus"),color:dataObj.data("color")},isNew=data.isNew,onSale=data.onSale,stockStatus=data.stockStatus,prodItem=$(this).parents(".prodItem"),thumbOver=$(this).parents(".thumbOver");setNewAndSale(prodItem,isNew,onSale),setNewAndSale(thumbOver,isNew,onSale),$.CommonUtils.productStatus(data,prodItem);var url=data.url;return null!=url&&0!=url.indexOf("/")&&(url="/"+url),$(this).parents(".rx").length>0?$(this).parents(".prodItem").length>0?($(this).parents(".prodItem").find(".btnBox").find(".btnOrder .lightYellow").attr("href","/buy"+url),void("undefined"!=typeof stockStatus&&"true"==stockStatus?($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").css("display","inline-block"),$(this).parents(".thumbOver").find(".btnBox").find(".gray").hide()):"undefined"!=typeof stockStatus&&"false"==stockStatus&&($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").hide(),$(this).parents(".thumbOver").find(".btnBox").find(".gray").css("display","inline-block")))):($(this).parents(".thumbOver").find(".btnBox").find(".btnOrder .lightYellow").attr("href","/buy"+url),void("undefined"!=typeof stockStatus&&"true"==stockStatus?($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").css("display","inline-block"),$(this).parents(".thumbOver").find(".btnBox").find(".gray").hide()):"undefined"!=typeof stockStatus&&"false"==stockStatus&&($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").hide(),$(this).parents(".thumbOver").find(".btnBox").find(".gray").css("display","inline-block")))):$(this).parents(".prodItem").length>0?($(this).parents(".prodItem").find(".btnBox").find(".btnOrder .lightYellow").attr("href",+url),void("undefined"!=typeof stockStatus&&"true"==stockStatus?($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").css("display","inline-block"),$(this).parents(".thumbOver").find(".btnBox").find(".gray").hide()):"undefined"!=typeof stockStatus&&"false"==stockStatus&&($(this).parents(".thumbOver").find(".btnBox").find(".lightYellow").hide(),$(this).parents(".thumbOver").find(".btnBox").find(".gray").css("display","inline-block")))):($(this).parents(".thumbOver").find(".btnBox").find(".btnOrder .lightYellow").attr("href",+url),void("undefined"!=typeof stockStatus&&"true"==stockStatus?($(this).parents(".thumbOver").find(".btnBox").find(".btnOrder .lightYellow").css("display","inline-block"),$(this).parents(".thumbOver").find(".btnBox").find(".gray .btnOrder").hide()):"undefined"!=typeof stockStatus&&"false"==stockStatus&&($(this).parents(".thumbOver").find(".btnBox").find(".btnOrder .lightYellow").hide(),$(this).parents(".thumbOver").find(".btnBox").find(".gray .btnOrder").css("display","inline-block"))))}),$(".productShop .colorCon a").live("click",function(){var data=$(this).find('input[name="colorCon"]');backOfFacebookLike(data);var className,$prodPanel=($("#wishlistId").val(),$(this).parents(".prodPanel")),$quickView=$(this).parents(".quickView");$prodPanel.length>0&&(className="prodPanel",$(".prodPanel").find("#updateWishListForm #addToGiftlistItemIdHV").val(data.attr("data-sku"))),$quickView.length>0&&(className="quickView",$(".quickView").find("#updateWishListForm #addToGiftlistItemIdHV").val(data.attr("data-sku")));var parama={className:className,favStatus:data.attr("data-favstatus"),wishListItemId:data.attr("data-wishlistitemid")};changeWishListInfo(JSON.stringify(parama),"");var $primium=$("."+className).find(".lensBoxCov .viewBox p");$primium.length>0&&$primium.text($(this).find('input[name="colorCon"]').attr("data-sunglass-prism-text"))}),$(".btnQuickView").live("click",function(){"undefined"!=typeof FB&&FB.XFBML.parse()}),$("#mainSection .nonRX .colorCon a").live("click",function(){var jsonData;if($(this).find("var").size()>0)jsonData=$.parseJSON($(this).find("var").text());else{var dataObj=$(this).find("input");jsonData={colorId:dataObj.data("colorid"),pId:dataObj.data("pid"),sku:dataObj.data("sku")}}var color=jsonData.colorId,productId=jsonData.pId,skuId=jsonData.sku;$.ajax({type:"POST",url:rootPath+"/misc/ajax/productDetaill/nonRX/product_shop.jsp",data:{pId:productId,colorId:color,skuId:skuId},success:backOfNonRxInfo,dataType:"html"})}),$("#mainSection .nonRX #selectLensColor").live("change",function(){var jsonData=$.parseJSON($("#mainSection .nonRX .colorCon a.recently").find("var").text()),color=jsonData.colorId,productId=jsonData.pId,lensColor=$(this).val();if(""!=lensColor){var errorUrl=$("#errorUrl").val();$.ajax({type:"POST",url:rootPath+"/misc/ajax/productDetaill/nonRX/product_shop.jsp",data:{pId:productId,colorId:color,errorUrl:errorUrl,lensColor:lensColor},success:backOfNonRxInfo,dataType:"html"})}}),$("#mainSection .nonRX #selectLensColor").live("click",function(){var $qtyError=$(this).next(".qtyError");null!=$qtyError&&$qtyError.hide()})});var strengthSelect="skuStrength",colorSelect="skuColor",outOfStock="outOfStock",lensColorSelect="skuLensColor",stockThreshold="stockThreshold",beyondThrehold="beyondThrehold",rootPath=getRootPath(),staticHostUrl=null,suffix="",productId=$("#productId").val();"undefined"!=typeof dataLayer&&"undefined"!=typeof FB&&FB.Event.subscribe("edge.create",function(response){dataLayer.push({event:"zenni_event",operation:"Social Like",eventCategory:"Product Detail",eventLabel:"Facebook",productId:productId,eventValue:"1"})}),$(".shareBox .icon_pinterest").live("click",function(e){e.preventDefault(),"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"Social Share",eventCategory:"Product Detail",eventLabel:"Pinterest",productId:productId,eventValue:"1"})}),$(".shareBox .icon_facebook").live("click",function(e){e.preventDefault(),"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"Social Share",eventCategory:"Product Detail",eventLabel:"Facebook",productId:productId,eventValue:"1"})}),$(".shareBox .icon_twitter").live("click",function(e){e.preventDefault(),"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"Social Share",eventCategory:"Product Detail",eventLabel:"Twitter",productId:productId,eventValue:"1"})}),$(".shareBox .icon_google").live("click",function(e){e.preventDefault(),dataLayer&&dataLayer.push({event:"zenni_event",operation:"Social Share",eventCategory:"Product Detail",eventLabel:"Google Plus",productId:productId,eventValue:"1"})});