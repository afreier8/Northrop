function checkEmptySearchterm(event){var inputStr=$("#atg_store_searchInput").val();if(""==$.trim(inputStr))return!1;var newInputValue=inputStr.replace(/(%|#)*/g,"");return""!=$.trim(newInputValue)}function filterDualPD(option){var rightPDvalue=$("#rightPDSelector").find("option:selected").val(),leftPDvalue=$("#leftPDSelector").find("option:selected").val();if(null!=rightPDvalue&&null!=leftPDvalue){var totalvalue=parseFloat(rightPDvalue)+parseFloat(leftPDvalue);totalvalue=parseInt(totalvalue,10);var filter="option[value="+totalvalue+"]",url=$("#singlePDSelector").find(filter).attr("url");null!=url&&(url+=url.indexOf("?")==-1?"?":"&",url+="rpd="+rightPDvalue+"&lpd="+leftPDvalue,window.location.href=url)}}function initWebcam(){jQuery("#webcam").webcam({swffile:staticHost+"/javascript/feature/framefit/jscam_canvas_only.swf",onSave:function(data){for(var col=data.split(";"),img=image,i=0;i<320;i++){var tmp=parseInt(col[i]);img.data[pos+0]=tmp>>16&255,img.data[pos+1]=tmp>>8&255,img.data[pos+2]=255&tmp,img.data[pos+3]=255,pos+=4}pos>=307200&&(ctx.putImageData(img,0,0),pos=0)},onCapture:function(){webcam.save(),$(".uploadByCam, .pd-upload_photo").removeClass("hidden")},onLoad:function(){$("#noCamTip").addClass("hidden"),$("a.capture").removeClass("hidden")}});var canvas=document.getElementById("canvas");canvas.getContext&&(ctx=document.getElementById("canvas").getContext("2d"),ctx.clearRect(0,0,320,240),image=ctx.getImageData(0,0,320,240))}$(function(){function popupSpeicalMsg(){if($(".errorBox").length>0)$(".errorBox").find("p").html("Special characters are not allowed in the text field.");else{var errorBox='<div class="errorBox hidden"><span class="icon_errorTip"></span><p>Special characters are not allowed in the text field.</p><span class="btnBox"><a href="javascript:void(0)" class="styleBtn black btnOK">OK</span></div>';$(".l_prodPanel").length>0?$(".l_prodPanel").append(errorBox):$("#mainSection .content").append(errorBox)}$(window).acsPopup({popupSrc:"",popupTitle:"Error",maxWidth:650,maxHeight:550,popupID:"error_emojiChars",popupContentPreload:$(".errorBox"),callBack:function(setting){console.log($("#error_emojiChars .btnOK").length),$("#error_emojiChars .btnOK").on("click",function(e){e.preventDefault(),acsPopup.popupLayerClose(setting)})}})}function replaceSpecicalChar(){var emojireg,$AllInput=$("form input[type=text],textarea"),specialStatus=!0;return $AllInput.length>0&&$AllInput.each(function(index){emojireg=$(this).val().match(/\ud83C[\udf00-\udfff]|\ud83d[\udc00-\ude4f]|\ud83d[\ude80-\udeff]/g),emojireg&&(specialStatus=!1,$(this).addClass("error"))}),specialStatus||popupSpeicalMsg(),specialStatus}$.CommonUtils={plusAccordion:function($obj,$content){$content.is(":visible")?($obj.find("span").text("+"),$content.hide()):($obj.find("span").text("-"),$content.show())},getRatingSSBlue:function(ratingVal){switch(ratingVal){case"0.5":return"881";case"1":return"896";case"1.5":return"912";case"2":return"928";case"2.5":return"943";case"3":return"959";case"3.5":return"975";case"4":return"990";case"4.5":return"1006";case"5":return"1022";default:return"864"}},lensShapePop:function($obj,panel){var $lensBox=$obj.closest(".lensBoxCov").find(".lensBox");$lensBox.parent().hasClass("lensBoxOuter")||$lensBox.wrap('<div class="lensBoxOuter"/>');$obj.closest(".lensBoxCov").find(".lensBoxOuter");$.browser.msie&&"7.0"==$.browser.version&&$(".qvContainer").length>0&&0==$obj.closest(".qvContainer").length&&$(".qvContainer").css("z-index","1");var imgName=$(panel).find(".lensImg > img").attr("name"),$lensBox=$obj.closest(".lensBoxCov").find(".lensBox");$lensBox.find("a").removeClass("recently"),$lensBox.find("a[name='"+imgName+"']").addClass("recently"),$(panel).find(".frameFit").find(".popupLayerBg").show(),$lensBox.show(),$.browser.msie&&"7.0"==$.browser.version&&$obj.closest(".qvContainer").length>0&&$obj.closest(".qvContainer").find(".popupLayerBg").show(),$.browser.msie&&"7.0"==$.browser.version&&$("#wrapper").hasClass("category")&&($(".category .categoryList").children().eq(0).before($(panel).find(".frameFit").find(".popupLayerBg").clone()),$(".category .l_prodPanel").css({position:"relative","z-index":"101"})),$lensBox.find(".divider").css("height",$lensBox.find("ul").outerHeight()-20+"px");var $frameFit=$(panel).find(".frameFit"),ffHeight=$frameFit.find(".ffContent").outerHeight();$frameFit.parent().css("min-height",$frameFit.outerHeight()+5),$frameFit.find(".ffContent").css({position:"absolute","z-index":"1000"}),$frameFit.next().css("margin-top",ffHeight+"px")},lensShapePopMobile:function(e){e&&e.preventDefault();var frameFit=$(".frameFit.pdp").eq(0).clone(),pId=$(".js-product-identifier").text();$.CommonUtils.screenSlide.open({url:"/misc/ajax/selectYourLens-mobile.jsp",data:{pId:pId},callback:function(){function initCarousels(){var carousels=$(".tabs-active_content .lens_shape-carousel").not(".carousel-initialized");carousels.find("li").width(carousels.find(".carouselContent").width());var items=new Array;$.each(carousels.find("li"),function(){var skuid=$(this).find("a").attr("id");items.push(skuid)}),items.unshift(items[items.length-1]),items.pop(),carousels.each(function(){$(this).acsCarousel({sliderLoop:!0,sliderMoveNum:1,sliderList:"carouselContent",sliderButtonCov:"carouselButton",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!1,slideCallback:function(currentIndex){var skuId=items[currentIndex];$.FrameFitUtils.tryonLensShape(skuId,frameFit)}})}),carousels.find("li:first-child").addClass("currentItem"),carousels.addClass("carousel-initialized")}$(".lens_shape-frame_fit_container").html(frameFit),$.CommonUtils.tabs(),$(".tabs_nav-progressive").on("tab-switch",function(){initCarousels()}),$(".lens_shape-add_btn").on("click",function(e){e.preventDefault();var active=$(".tabs-active_content .carousel .carouselItem").eq(0).find("a"),activeSku=active.attr("id");selectLensSharp(activeSku,!1,"lensShapeFormId","true","rxDetail"),$.CommonUtils.ininLensShape(active,$(".prodPanel .lensImg")),$.CommonUtils.screenSlide.close()}),initCarousels()}})},closeLensBox:function($obj,panel){var $lensBox=$obj.closest(".lensBox");$obj.find("img").length>0&&($lensBox.find("a.recently").removeClass("recently"),$obj.addClass("recently")),$(panel).find(".popupLayerBg").not(".transparent").hide(),$.browser.msie&&"7.0"==$.browser.version&&$obj.closest(".qvContainer").length>0&&$obj.closest(".qvContainer").find(".popupLayerBg").not(".transparent").hide(),$.browser.msie&&"7.0"==$.browser.version&&$("#wrapper").hasClass("category")&&($(".category .categoryList").find("> .popupLayerBg").detach(),$(".category .l_prodPanel").css({position:"static","z-index":"101"})),$lensBox.hide(),$(panel).find(".frameFit").find(".ffContent").css({position:"static","z-index":"1"}),$(panel).find(".frameFit").next().css("margin-top","-1px"),$.browser.msie&&"7.0"==$.browser.version&&$(".qvContainer").length>0&&0==$obj.closest(".qvContainer").length&&$(".qvContainer").css("z-index","60")},ininLensShape:function($obj,$lensImg){var imgSrc=$obj.find("img").attr("src"),$lensImage=$lensImg.find("> img");$lensImage.attr({src:imgSrc,name:$obj.attr("name")})},closeQuickView:function(){$(".qvContainer").closest(".recBox").size()>0?($(".qvContainer").closest(".recBox").find(".carouselItem.qved").removeClass("qved"),$(".qvContainer").parent("ul").detach()):($(".qvContainer").parent().find("li.qved").removeClass("qved"),$(".qvContainer").detach())},getQVCarousel:function($obj,url){var $prodItem=$obj.closest(".carousel").find(".carouselContent > ul > li").eq($obj.closest(".thumbOver").find("> var").text()).find(".prodItem"),$carousel=$obj.closest(".carousel"),data="";data=$obj.find("var").size()>0?$.parseJSON($obj.find("var").text()):{pId:$obj.data("pid"),skuId:$obj.data("skuid")},$obj.closest(".thumbOver").detach(),$.ajax({url:url,data:data,success:function(str){$.CommonUtils.closeQuickView(),$(document).scrollTop($carousel.offset().top),$carousel.after(str),$carousel.parent(".recBox").find(".qvContainer").wrapAll("<ul></ul>"),$prodItem.parent().addClass("qved");var $quickView=$carousel.parent().find(".quickView"),marginVal=isNaN($carousel.css("margin-left").replace("px",""))?0:parseInt($carousel.css("margin-left")),offsetVal=isNaN($carousel.find(".carouselContent > ul").css("left").replace("px",""))?0:parseInt($carousel.find(".carouselContent > ul").css("left"));$quickView.find(".arrowUp").css("left",$prodItem.parent().position().left+offsetVal+70+marginVal+"px"),$quickView.find(".frameFit").length>0&&($.FrameFitUtils.initFrameFit($quickView.find(".frameFit")),$obj.closest(".thumbOver").hasClass("rx")&&$.FrameFitUtils.attachLensOverEvent($quickView.find(".frameFit"),!0))},error:function(){}})},getQucikView:function($obj,url){var $prodItem=$obj.closest(".prodItem");$prodItem.find(".thumbOver").hide();var $thisLi=$prodItem.parent("li"),conWidth=$thisLi.parent("ul").outerWidth(),itemWidth=$thisLi.width();if("object"==typeof $thisLi.prevAll(".qvContainer")&&$thisLi.prevAll(".qvContainer").length>0)var index=$thisLi.index();else var index=$thisLi.index()+1;var perRow=Math.floor(conWidth/itemWidth),realIndex=Math.ceil(index/perRow)*perRow-1;realIndex>=$thisLi.parent("ul").find(">li[class!=qvContainer]").length&&(realIndex=$thisLi.parent("ul").find(">li[class!=qvContainer]").length-1);var $realItem=$thisLi.parent("ul").find(">li[class!=qvContainer]").eq(realIndex),data="";$obj.data("skuid")&&$obj.data("pid")&&(data={pId:$obj.data("pid"),skuId:$obj.data("skuid")}),$.ajax({url:url,data:data,success:function(str){$.CommonUtils.closeQuickView(),$(document).scrollTop($prodItem.offset().top),$realItem.after(str),$thisLi.addClass("qved"),$thisLi.parent("ul").find(".quickView .arrowUp").css("left",$thisLi.position().left+70+"px");var $quickView=$realItem.parent("ul").find(".quickView");if($quickView.find(".frameFit").length>0&&$.FrameFitUtils.initFrameFit($quickView.find(".frameFit")),$obj.closest(".prodItem").hasClass("rx")&&$.FrameFitUtils.attachLensOverEvent($(".frameFit"),!0),$quickView.find("span.lensImg").length>0){var $frameFit=$(".frameFit.catg .currentItem"),curColorLink=$quickView.find(".colorCon a.recently"),shapeId=$quickView.find("span.lensImg > img").attr("name");$.FrameFitUtils.ffCatgTryon($frameFit,curColorLink,shapeId)}},error:function(){}})},initPreCarousel:function($obj,$rxItemCov){$obj.each(function(){var $preCarousel=$(this);$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderCanDrag:!0,sliderList:"carouselContent",sliderButtonCov:"carouselButton",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!1,callBack:function(obj,setting){var arrH=[];setting.sliderContainer.find(".carouselItem").each(function(){arrH.push($(this).height())}),arrH.sort(function(a,b){return b-a}),setting.sliderContainer.find(".carouselContent").css("height",arrH[0]),setting.sliderContainer.find(".carouselContent > ul").css("height",arrH[0]),setting.sliderContainer.find("."+setting.sliderButtonCov).find("a.carouselNext").live($.touchUtil.mouseUpEvent(),function(e){var currentIndex=parseInt($rxItemCov.find(".tipMsg span").text());currentIndex+1<=$preCarousel.find("ul > li").length&&$rxItemCov.find(".tipMsg span").text(currentIndex+1)}),setting.sliderContainer.find("."+setting.sliderButtonCov).find("a.carouselPrev").live($.touchUtil.mouseUpEvent(),function(e){var currentIndex=parseInt($rxItemCov.find(".tipMsg span").text());currentIndex-1>0&&$rxItemCov.find(".tipMsg span").text(currentIndex-1)})}})})},initCheckBox:function($obj){$obj.find("input[type=checkbox]").each(function(){$(this).is(":checked")&&$(this).closest(".checkbox").addClass("checked")})},changeColor:function($obj,$parentCov){var $product=$obj.find("input");if($product){var productInfo={sku:$product.data("sku"),price:$product.data("price"),salePrice:$product.data("saleprice"),rating:$product.data("rating"),ratingMsg:$product.data("ratingmsg"),pId:$product.data("pid"),favStatus:$product.data("favstatus"),status:$product.data("status"),wishlistItemId:$product.data("wishlistitemid"),inventoryStatus:$product.data("inventorystatus"),url:$product.data("url"),ratioScale:$product.data("ratioscale"),distance:$product.data("distance"),liy:$product.data("liy"),shareUrl:$product.data("shareurl"),pinterestShare:$product.data("pinterestshare"),facebookShare:$product.data("facebookshare"),twitterShare:$product.data("twittershare"),googleShare:$product.data("googleshare")},oldSku=$parentCov.find(".prodBrief .skuId").text().replace("#",""),onClickUrl="";if($(".writeReviewLink").each(function(){onClickUrl=$(this).attr("onClick"),$(this).attr("onClick",onClickUrl.replace(oldSku,productInfo.sku))}),$parentCov.find(".prodBrief .skuId").text("#"+productInfo.sku),$.trim(productInfo.salePrice).length>0){$parentCov.find(".prodBrief .price").addClass("sale"),$parentCov.find(".prodBrief .oldPrice").text(productInfo.price),$parentCov.find(".prodBrief .salePrice").text(productInfo.salePrice),$parentCov.find(".prodBrief .oldPrice, .prodBrief .salePrice").removeClass("hidden"),$parentCov.find(".prodBrief .price > span:not([itemprop])").eq(0).addClass("hidden");var signal=productInfo.price.substring(0,1),oldPrice=productInfo.price.replace(/^\$/,""),salePrice=productInfo.salePrice.replace(/^\$/,"");$parentCov.find(".prodBrief .price span.oldPrice[itemprop=priceCurrency]").text(signal),$parentCov.find(".prodBrief .price span.oldPrice[itemprop=price]").text(oldPrice),$parentCov.find(".prodBrief .price span.salePrice[itemprop=priceCurrency]").text(signal),$parentCov.find(".prodBrief .price span.salePrice[itemprop=price]").text(salePrice),$parentCov.find(".prodBrief .price div[itemprop=offers] *").addClass("hidden"),$parentCov.find(".prodBrief .price div[itemprop=offers]").nextAll("span").removeClass("hidden")}else{$parentCov.find(".prodBrief .price").removeClass("sale"),$parentCov.find(".prodBrief .price > span:not([itemprop])").eq(0).text(productInfo.price).removeClass("hidden"),$parentCov.find(".prodBrief .oldPrice, .prodBrief .salePrice").addClass("hidden");var signal=productInfo.price.substring(0,1),oldPrice=productInfo.price.replace(/^\$/,"");$parentCov.find(".prodBrief .price div[itemprop=offers] span").first().text(signal),$parentCov.find(".prodBrief .price div[itemprop=offers] span").last().text(oldPrice),$parentCov.find(".prodBrief .price div[itemprop=offers] *").removeClass("hidden"),$parentCov.find(".prodBrief .price div[itemprop=offers]").prev("span").addClass("hidden"),$parentCov.find(".prodBrief .price div[itemprop=offers]").nextAll("span").addClass("hidden")}"disabled"==productInfo.status?$("#RetireInfo").show():$("#RetireInfo").hide(),$parentCov.find(".heroImage").find("img[name='sku"+productInfo.sku+"']").show().removeClass("hidden").siblings().hide().addClass("hidden"),productInfo.h1Value&&$.trim(productInfo.h1Value).length>0&&$parentCov.find(".prodBrief h1").html(productInfo.h1Value)}},resizeSelect:function($obj){$obj.find("select").css("width","auto");var selWidth=$obj.width();innerWH=$obj.find("select").width(),selWidth<innerWH&&($obj.css("width",innerWH+55),$obj.find("label").css("width",innerWH+15)),$obj.find("select").css("width","100%")},carouselItemHover:function($obj){if($obj.closest(".recCarousel").length<=0)$.browser.msie&&"7.0"==$.browser.version&&$obj.css("z-index","1000"),$obj.find(".thumbOver").show();else{var $thumbOver=$obj.find(".thumbOver");$obj.closest(".recCarousel").find("> .thumbOver").length>0&&$obj.closest(".recCarousel").find("> .thumbOver").detach(),$obj.closest(".recCarousel").children(".carouselContent").before($thumbOver.clone()),$obj.closest(".recCarousel").find("> .thumbOver").find(".imgBox img").load(function(){$obj.closest(".recCarousel").find("> .thumbOver").show();var offsetVal=isNaN($obj.closest(".carouselContent").find(" > ul").css("left").replace("px",""))?0:parseInt($obj.closest(".carouselContent").find(" > ul").css("left")),currentProd=$obj.closest(".recCarousel").find("> .thumbOver"),prodItemLeft=25;enquire.register("screen and (max-width: 719px)",{match:function(){prodItemLeft=-20},unmatch:function(){prodItemLeft=25}}),currentProd.addClass($obj.attr("class").replace("prodItem","").replace(" ","")),currentProd.css("left",$obj.parent().position().left+offsetVal-prodItemLeft+"px"),currentProd.append("<var>"+$obj.parent(".carouselItem").index()+"</var>")})}},carouselItemHoverClose:function($obj){$obj.closest(".recCarousel").length<=0?($.browser.msie&&"7.0"==$.browser.version&&$obj.css("z-index","1"),$obj.find(".thumbOver").hide()):$obj.closest(".recCarousel").children(".thumbOver").detach()},productStatus:function(data,$prodItem){if(data.stockStatus&&"false"==data.stockStatus){var outOfStockLayer=$prodItem.find(".iOutOfStock");outOfStockLayer.show().siblings(".icon_new, .icon_sale").hide()}else"true"==data.isNew?$prodItem.find(".icon_new").show().siblings(".icon_sale, .iOutOfStock").hide():"true"==data.isSale?$prodItem.find(".icon_sale").show().siblings(".icon_new, .iOutOfStock").hide():$prodItem.find(".iOutOfStock").hide()}},$.browserVer={versions:function(){var u=navigator.userAgent;navigator.appVersion;return{trident:u.indexOf("Trident")>-1,presto:u.indexOf("Presto")>-1,webKit:u.indexOf("AppleWebKit")>-1,gecko:u.indexOf("Gecko")>-1&&u.indexOf("KHTML")==-1,mobile:!!u.match(/AppleWebKit.*Mobile.*/)||!!u.match(/AppleWebKit/),ios:!!u.match(/(i[^;]+\;(U;)? CPU.+Mac OS X)/),android:u.indexOf("Android")>-1||u.indexOf("Linux")>-1,iPhone:u.indexOf("iPhone")>-1||u.indexOf("Mac")>-1,iPad:u.indexOf("iPad")>-1,webApp:u.indexOf("Safari")==-1}}(),language:(navigator.browserLanguage||navigator.language).toLowerCase()},$(".searchBox .textInput").on("click",function(){$(this).closest(".searchBox").find(".keywords").is(":hidden")&&($(this).closest(".searchBox").addClass("focus"),$(this).closest(".searchBox").find(".keywords").show())}),$(document).bind($.touchUtil.mouseUpEvent(),function(e){var container=$(".searchBox");0===container.has(e.target).length&&(container.find(".keywords").hide(),container.find(".textInput").focusout())}),$(".miniCart .miniCartList").acsScrollBar({scrollContainer:$(this)}),$("#header .helpBox").bind("click",function(e){if(!$(e.target).closest(".helpDetail").length&&(e.preventDefault(),$(this).find(".helpDetail").is(":hidden"))){e.stopPropagation();var detailsHeight=$(".helpDetail").height();$("#header").stop(),$(this).find(".helpDetail").css("display","block"),$("#header").animate({"margin-top":detailsHeight+"px"},500,function(){}),$("html").bind("click.headerHelp",function(e){$(e.target).closest(".helpDetail").length||(e.preventDefault(),$("#header").stop(),$("#header").animate({"margin-top":"0"},500,function(){$(this).find(".helpDetail").css("display","none")}),$("html").unbind("click.headerHelp"))})}}),$("#header .cartBox").bind("click",function(e){e.preventDefault(),"a"!=this.tagName.toLowerCase&&(window.location.href=$(this).find("a").attr("href"))}),$(".favorites.tabs").each(function(){$(this).acsTabs({tabTitle:"tabTitle",tabContent:"tabContent",tabItem:"tabItem",tabTitleActive:"recently"})}),$(".thumbOver .addFav, #addOnsInfo .addToCart .btnAddToCart, .addCartBox .btn_order").live("click",function(event){event.preventDefault(),event.stopPropagation()}),$(".colorBox a").live("click",function(e){e.preventDefault(),$(this).addClass("recently").siblings().removeClass("recently"),$(this).closest(".colorBox").find(".colorName").size()>0&&$(this).closest(".colorBox").find(".colorName").text($(this).attr("name"))}),$(".radio > input[type='radio']").live("click",function(){var name=$(this).attr("name"),$node=$("input:radio[name='"+name+"']");$node.each(function(){$(this).is(":checked")?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked")})}),$(".checkbox > input[type='checkbox']").live("change",function(){$(this).is(":checked")?$(this).parent().addClass("checked"):$(this).parent().removeClass("checked")}),$(".select > select").live("change",function(){$(this).closest(".select").hasClass("error")&&($(this).closest(".select").removeClass("error"),$(this).closest(".select").find(">span").text(""));var selValue=$(this).find("option:selected").val();$label=$(this).parent().find("label"),selValue.length<=0?$label.hasClass("gray")||$label.addClass("gray"):$label.hasClass("gray")&&$label.removeClass("gray"),$label.html($(this).find("option:selected").text())}),$.browser.mozilla&&$(".select > select").live("keyup",function(){$(this).closest(".select").hasClass("error")&&($(this).closest(".select").removeClass("error"),$(this).closest(".select").find(">span").text(""));var selValue=$(this).find("option:selected").val();$label=$(this).parent().find("label"),selValue.length<=0?$label.hasClass("gray")||$label.addClass("gray"):$label.hasClass("gray")&&$label.removeClass("gray"),$label.html($(this).find("option:selected").text())}),$(".fileInput input[type=file]").live("change",function(){var uploadFile=$(this).get(0).files;if(uploadFile.length)if(uploadFile[0].size>10485760)$(this).closest(".fileInput").find("span").addClass("error").text("Max file size is 10 MB"),$(this).closest(".ffUpload").find(".btnUploadPhoto").removeClass("gray").addClass("black"),$(this).closest(".ffUpload").find(".btnUploadPhoto").addClass("disabled");else{var fileVal=$(this).val().split("\\"),fileNameArr=fileVal[fileVal.length-1].split("."),fileName=fileVal[fileVal.length-1].substring(0,fileVal[fileVal.length-1].length-fileNameArr[fileNameArr.length-1].length-1);fileName=fileName.length>21?fileName.substring(0,13)+"... ."+fileNameArr[fileNameArr.length-1]:fileVal[fileVal.length-1],$(this).closest(".fileInput").find("span").text(fileName),$(this).closest(".ffUpload").size()>0&&($(this).closest(".ffUpload").find(".btnUploadPhoto").removeClass("gray").addClass("black"),$(this).closest(".ffUpload").find(".btnUploadPhoto").removeClass("disabled"),$(this).closest(".fileInput").find("span").removeClass("error"))}}),$('input[type="text"], textarea').on("change",function(){var status=replaceSpecicalChar();status&&$(this).removeClass("error")}),$("form").on("submit",function(){return replaceSpecicalChar()}),$(".prodItem .colorBox > a").live("click",function(e){e.preventDefault();var index=$(this).index(),$prodItem=$(this).closest(".prodItem"),$current=$prodItem.find(".colorBox");$current.each(function(){$(this).children("a").eq(index).addClass("recently").siblings().removeClass("recently")});var dataObj=$current.find("a").eq(index).find('input[name="colorBox"]');data={image:dataObj.data("image"),hoverImage:dataObj.data("hoverimage"),price:dataObj.data("price").toString(),rating:dataObj.data("rating"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew"),onSale:dataObj.data("onsale"),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus")},$prodItem.find(">.imgBox img").attr("src",data.image),$prodItem.find(">.imgBox > a").attr("href",data.url),$prodItem.find(">.imgBox > a").attr("data-skuId",data.skuId),$prodItem.find(".thumbOver>.imgBox img").attr("src",data.hoverImage),$prodItem.find(".prodInfo>.price").text(data.price),$prodItem.find(".thumbOver>.imgBox > a").attr("href",data.url),$prodItem.find(".thumbOver>.imgBox > a").attr("data-skuId",data.skuId),$prodItem.find(".prodInfo .skuId").text(data.skuId),$prodItem.find(".thumbOver>.imgBox title").text("title",data.color),$prodItem.find(".thumbOver> .btnBox .lightYellow.btnOrder").attr("href",data.url)}),$(".carousel > .thumbOver .colorBox > a").live("click",function(e){e.preventDefault();var index=$(this).closest(".thumbOver").find(">var").eq(0).text(),$objIndex=$(this).index(),$prodItem=$(this).closest(".carousel").find(".carouselContent > ul > li").eq(index).find(".prodItem"),$current=$prodItem.find(".colorBox"),$thumbOver=$(this).closest(".thumbOver");if($current.each(function(){$(this).children("a").eq($objIndex).addClass("recently").siblings().removeClass("recently")}),$current.find("a").eq($objIndex).find("input")||$current.find("a").eq($objIndex).find("var")){if($current.find("a").eq($objIndex).text()&&$.trim($current.find("a").eq($objIndex).text()).length>0)data=$.parseJSON($current.find("a").eq($objIndex).text());else{var dataObj=$current.find("a").eq($objIndex).find("input");data={image:dataObj.data("image"),url:dataObj.data("url"),hoverImage:dataObj.data("hoverimage"),price:dataObj.data("price"),color:dataObj.data("color"),skuId:dataObj.data("skuid"),hoverImage:dataObj.data("hoverimage")}}$prodItem.find(">.imgBox img").attr("src",data.image),$prodItem.find(">.imgBox > a").attr("href",data.url),$prodItem.find(".thumbOver>.imgBox img").attr("src",data.hoverImage),$prodItem.find(".prodInfo>.price").text(data.price),$prodItem.find(".thumbOver>.imgBox > a").attr("href",data.url),$prodItem.find(".prodInfo .skuId").text(data.skuId),$prodItem.find(".thumbOver>.imgBox title").text("title",data.color),$thumbOver.find(".imgBox img").attr("src",data.image),$thumbOver.find(".thumbOver>.imgBox img").attr("src",data.hoverImage),$thumbOver.find(".prodInfo>.price").text(data.price),$thumbOver.find(".prodInfo .skuId").text(data.skuId),$.CommonUtils.productStatus(data,$thumbOver),$.CommonUtils.productStatus(data,$prodItem)}}),$(".prodItem .btnTryOn").live("click",function(e){e.preventDefault(),$.CommonUtils.closeQuickView()}),enquire.register("screen and (min-width: 721px)",{match:function(){$(".prodItem > .imgBox").live($.touchUtil.mouseEnterEvent(),function(){var $prodItem=$(this).closest(".prodItem");$prodItem.parent().hasClass("qved")?$prodItem.find(".thumbOver").hide():($.touchUtil.isTouch&&$(".thumbOver:visible").hide(),$.CommonUtils.carouselItemHover($(this).closest(".prodItem")))}),$(".prodItem .thumbOver").live($.touchUtil.mouseLeaveEvent(),function(){$.CommonUtils.carouselItemHoverClose($(this).closest(".prodItem"))}),$(".recCarousel > .thumbOver").live($.touchUtil.mouseLeaveEvent(),function(){$.CommonUtils.carouselItemHoverClose($(this))})},unmatch:function(){$(".prodItem > .imgBox").die(),$(".prodItem .thumbOver").die(),$(".recCarousel > .thumbOver").die()}}),$(".categoryList .quickView .changeLensShape").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.lensShapePop($(this),".ffCov")}),$(".categoryList .quickView .lensBox .close").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.closeLensBox($(this),".ffCov")}),$(".categoryList .quickView .lensBox a").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.ininLensShape($(this),$(".quickView .lensImg")),$.CommonUtils.closeLensBox($(this),".ffCov")}),$(".view360").live("click",function(e){e.preventDefault();var skuId=$(this).closest(".heroImage").parent().find(".prodBrief .skuId").text().replace("#",""),data={xmlPath:$(this).data("xmlpath"),objPath:$(this).data("objpath")};$.extend(data,{skuId:""+skuId}),$(this).acsPopup({popupSrc:$(this).attr("layerSrc").replace(/skuId=[0-9a-zA-Z]*/,"skuId="+skuId),popupTitle:$(this).attr("layerTitle"),maxWidth:$(window).width(),maxHeight:$(window).height(),realWidth:$(window).width()>500?500:$(window).width(),jsonData:data,popupID:"view360Pop"})}),$(".quickView .l_sec > .close").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.closeQuickView()}),$(".quickView .selectColor a").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$(this).addClass("recently").siblings().removeClass("recently"),$(this).closest(".colorBox").find(".colorName").text($(this).attr("name")),$.CommonUtils.changeColor($(this),$(".quickView"))}),$.touchUtil.isTouch||$(".quickView .selectColor a").live("mouseenter",function(e){e.preventDefault(),$(this).closest(".colorBox").find(".colorName").text($(this).attr("name")),$.CommonUtils.changeColor($(this),$(".quickView"))}).live("mouseleave",function(e){e.preventDefault(),$(this).closest(".colorBox").find(".colorName").text($(".quickView .selectColor .colorCon .recently").attr("name")),$.CommonUtils.changeColor($(".quickView .selectColor .colorCon .recently"),$(".quickView"))});var onquickviewclick=function(obj){if(obj){var selectedItem=$(obj).parent().parent().find("ul li.colorBox a.recently input"),list=$(obj).attr("data-list"),skuId=$(selectedItem).attr("data-skuid");skuId&&"#"==skuId.substr(0,1)&&(skuId=skuId.substr(1,skuId.length));var price=$(obj).attr("data-price"),isInStock=$(selectedItem).attr("data-stockStatus"),searchType=$(obj).attr("data-searchType");dataLayer.push({event:"quickView",ecommerce:{detail:{products:[{id:skuId,price:price,dimension16:isInStock}]}}}),searchType?dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:list},products:[{id:skuId,dimension16:isInStock,dimension20:searchType}]}}}):dataLayer.push({event:"productClick",ecommerce:{click:{actionField:{list:list},products:[{id:skuId,dimension16:isInStock}]}}})}};$("body").on($.touchUtil.mouseClickEvent(),".categoryList .rx .btnQuickView",function(e){e.preventDefault(),$.CatgMenu.closeMenu(),$(".frameFit").hasClass("compareBox")&&$.FrameFitUtils.ffCompareClose($(".frameFit_carousel"),""),onquickviewclick(this),$.CommonUtils.getQucikView($(this),"/misc/ajax/quickView/quickView_rx.jsp")}),$("body").on($.touchUtil.mouseClickEvent(),".categoryList .nonRX .btnQuickView",function(e){e.preventDefault(),$.CatgMenu.closeMenu(),$(".frameFit").hasClass("compareBox")&&$.FrameFitUtils.ffCompareClose($(".frameFit_carousel"),""),onquickviewclick(this),$.CommonUtils.getQucikView($(this),"/misc/ajax/quickView/quickView_nonRX.jsp")}),$("body").on($.touchUtil.mouseClickEvent(),".categoryList .fixedRX .btnQuickView",function(e){e.preventDefault(),$.CatgMenu.closeMenu(),$(".frameFit").hasClass("compareBox")&&$.FrameFitUtils.ffCompareClose($(".frameFit_carousel"),""),onquickviewclick(this),$.CommonUtils.getQucikView($(this),"/misc/ajax/quickView/quickView_fixedRX.jsp")}),$("body").on($.touchUtil.mouseClickEvent(),".categoryList .accessory .btnQuickView",function(e){e.preventDefault(),$.CatgMenu.closeMenu(),$(".frameFit").hasClass("compareBox")&&$.FrameFitUtils.ffCompareClose($(".frameFit_carousel"),""),onquickviewclick(this),$.CommonUtils.getQucikView($(this),"/misc/ajax/quickView/quickView_accessory.jsp")}),$(".carousel .thumbOver.rx .btnQuickView").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.getQVCarousel($(this),"/misc/ajax/quickView/quickView_pdp_rx.jsp")}),$(".carousel .thumbOver.nonRX .btnQuickView").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.getQVCarousel($(this),"/misc/ajax/quickView/quickView_pdp_nonRX.jsp")}),$(".carousel .thumbOver.fixedRX .btnQuickView").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.getQVCarousel($(this),"/misc/ajax/quickView/quickView_pdp_fixedRX.jsp")}),$(".carousel .thumbOver.accessory .btnQuickView").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.getQVCarousel($(this),"/misc/ajax/quickView/quickView_pdp_accessory.jsp")}),$(".recBox .quickView .changeLensShape").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.lensShapePop($(this),".quickView .qvCon")}),$(".recBox .quickView .lensBox .close").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.closeLensBox($(this),".quickView .qvCon")}),$(".recBox .quickView .lensBox a").live($.touchUtil.mouseClickEvent(),function(e){e.preventDefault(),$.CommonUtils.ininLensShape($(this),$(".quickView .lensImg")),$.CommonUtils.closeLensBox($(this),".quickView .qvCon")}),$(".recCarousel").each(function(){$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderCanDrag:!0,sliderList:"carouselContent",sliderButtonCov:"carouselButton",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!1,callBack:function(obj,setting){setting.sliderContainer.find("."+setting.sliderButtonCov).find("a").live($.touchUtil.mouseUpEvent(),function(e){e.preventDefault(),$.CommonUtils.closeQuickView(),$.touchUtil.isTouch&&$(this).closest(".recCarousel").find("> .thumbOver").length>0&&$(this).closest(".recCarousel").find("> .thumbOver").detach();
})}})}),$(".acctNav").hover(function(e){e.preventDefault(),$(this).find(".dropDown").stop(!0,!0).slideDown(100),$(this).find("> * > a").addClass("expand")},function(e){e.preventDefault(),$(this).find(".dropDown").stop(!0,!0).slideUp(100),$(this).find("> * > a").removeClass("expand"),$(this).find(".arr").attr("class","arrowD arr")}),$(".i_help, .icon_helpMark, .link_help, .show-help").live("click",function(e){e.preventDefault();var msgID=$(this).attr("msg_key"),$obj=$(this);$(this).hasClass("link_help")||(msgID=$.trim($(this).find("var").text())||$.trim($(this).find("i").text())),$.ajax({url:"/misc/ajax/helpMsg.jsp",data:{msgID:msgID},success:function(str){var $objCon=null;text="",$(str).find(".jspPane").size()>0?($objCon=$(str).find(".jspPane").parent().wrapAll("<div />").parent(),$objCon.find(".jspPane").outerWidth(!0)<=640?$objCon.find(".helpMsgPane").css("width",$(str).find(".jspPane").outerWidth(!0)):$objCon.find(".helpMsgPane").css("width","640px"),text=$objCon.html()):text=str,$("#help_pop").length>0||$obj.acsPopup({popupSrc:"",popupTitle:"",maxWidth:700,maxHeight:550,popMsg:text,popupID:"help_pop",callBack:function(setting){$.touchUtil.isTouch?$("#help_pop .helpMsgPane").css("overflow","auto"):($("#help_pop .helpMsgPane").acsScrollBar({scrollContainer:$(this)}),$("#help_pop .helpMsgPane").acsScrollBarX({scrollContainer:$(this),conSize:$("#help_pop .helpMsgPane").find(".jspPane").outerWidth(!0)}))}})},error:function(){}})}),$(".sliderShow").acsSlider({sliderProgress:!1,sliderPager:!0,sliderMethod:"left",sliderLoop:!0,sliderCanDrag:$(this).find(".sliderItem").size()>1,toScale:!0,sliderButton:!1,startwidth:$("#mainSection").width(),startheight:495*$("#mainSection").width()/1024,afterPlay:function(obj,setting){setTimeout(function(){$("."+setting.sliderItem+" > .text").addClass("active"),$("."+setting.sliderItem+" > .text > .styleBtn").addClass("active")},500)},beforePlay:function(obj,setting){$("."+setting.sliderItem+" > .text").removeClass("active"),$("."+setting.sliderItem+" > .text > .styleBtn").removeClass("active")}}),$(".pdInfo").find(".radio").live("click",function(){var $pdInfo=$(this).closest(".pdInfo"),$singlePD=$pdInfo.find(".singlePDBox"),$doublePD=$pdInfo.find(".doublePDBox");$(this).hasClass("single")?($singlePD.show(),$doublePD.hide()):($singlePD.hide(),$doublePD.show())}),$.touchUtil.isTouch?$(".i_pa").live("click",function(e){e.preventDefault();var $obj=$(this).closest(".cl_t_pa").find(".t_bx"),$parentNode=$(this).closest(".cl_t_pa");$obj.is(":visible")?($parentNode.offset().left<280&&($(this).parents(".cl_t_pa").find(".t_bx").attr("style",""),$(this).parents(".cl_t_pa").find(".c_blue").removeClass("hover")),$obj.stop(!0,!0).hide(300)):($(this).offset().left<280&&($(this).parents(".cl_t_pa").find(".t_bx").css({left:-$parentNode.offset().left,bottom:$(this).parents(".cl_t_pa").find(".c_blue").height()+5}),$(this).parents(".cl_t_pa").find(".c_blue").addClass("hover")),$obj.stop(!0,!0).show(300))}):$(".i_pa").live("mouseenter",function(e){e.preventDefault(),$(this).parents(".cl_t_pa").find(".t_bx").stop(!0,!0).show(300)}).live("mouseleave",function(e){e.preventDefault(),$(this).parents(".cl_t_pa").find(".t_bx").stop(!0,!0).hide(300)}),$("[placeholder]").each(function(){"text"==$(this).attr("type")||"textarea"==this.tagName.toLowerCase()?($(this).placeholder($(this).attr("placeholder")),0==$(this).val().length&&$(this).addClass("tInput_ph")):$(this).hasClass("select")&&($(this).selectPlaceholder($(this).attr("placeholder")),$(this).attr("placeholder")==$(this).find("select option:selected").text()&&$(this).addClass("tInput_ph"))})}),$(function(){$.touchUtil.isTouch}),$(document).ready(function(){if(($("body").find(".categoryList").length>0||$("body").find(".visualSearchCon").length>0)&&1==$("body").find(".frameFit").length){if($(".categoryHeader").length>0){var catgHeaderHeight=-$(".categoryHeader").outerHeight(!0);$(".frameFit").css("margin-top",catgHeaderHeight/2+"px")}$(".frameFit").parent().children().wrapAll('<div class="ffCov frameFit_container" style="margin-top: '+$(".frameFit").css("margin-top")+'" />'),$(".frameFit").css("margin-top","0");var initParam={preElementH:$(".myAccount .favCov").size()>0?$("#header").outerHeight():$(".ffCov").offset().top,elementH:$(".frameFit").parent().outerHeight(),nextElementToTop:$(".ffCov").parent().parent().offset().top+$(".ffCov").parent().parent().outerHeight(),parElementH:$(".ffCov").parent().parent().outerHeight(),marginTop:$(".ffCov").css("margin-top")};jQuery(window).scroll(function(){if(!$(".frameFit").hasClass("ffTryOnBox")){initParam.nextElementToTop=$(".ffCov").parent().parent().offset().top+$(".ffCov").parent().parent().outerHeight(),initParam.parElementH=$(".ffCov").parent().parent().outerHeight(!0),initParam.elementH=$(".frameFit").parent().outerHeight();var changeFav=!1,$favObj=null,favParam=null;if($(".ffCov .favorites").size()>0&&($favObj=$(".favorites.tabs .tabContent .tabItem.show"),favParam={favItemH:$favObj.find(".productList").find(" > .carouselItem").outerHeight(),favConH:$favObj.find(".carouselContent").height()}),$(document).scrollTop()>initParam.preElementH&&$(document).scrollTop()+initParam.elementH<initParam.nextElementToTop?$(".frameFit").parent().css({position:"fixed","margin-top":"0",top:"0"}):$(document).scrollTop()<=initParam.preElementH&&$(".frameFit").parent().css({position:"static","margin-top":initParam.marginTop}),$(document).scrollTop()+initParam.elementH>=initParam.nextElementToTop)$(".frameFit").parent().css({position:"static","margin-top":initParam.parElementH-initParam.elementH+"px"}),$(".ffCov .favorites").size()>0&&favParam.favConH>favParam.favItemH+20&&!$favObj.find(".carouselContent").hasClass("noItem")&&($favObj.find(".carouselContent").css("height",favParam.favConH-favParam.favItemH),favParam.favConH=$favObj.find(".carouselContent").height(),changeFav=!0);else{var offsetVal=initParam.nextElementToTop-initParam.elementH-$(document).scrollTop();$(".ffCov .favorites").size()>0&&offsetVal>favParam.favItemH&&initParam.elementH+$(document).scrollTop()<$(window).height()&&!$favObj.find(".carouselContent").hasClass("noItem")&&Math.floor((favParam.favConH+favParam.favItemH)/favParam.favItemH)<=$favObj.find(".carouselContent > ul > li").length&&$favObj.find(".carouselContent > ul > li.currentItem").index()+1<$favObj.find(".carouselContent > ul > li").length&&($favObj.find(".carouselContent").css("height",favParam.favConH+favParam.favItemH),favParam.favConH=$favObj.find(".carouselContent").height(),changeFav=!0)}changeFav&&$(".favorites .carousel.show .update").each(function(){$(this).trigger("click")})}})}$(".favorites.tabs").length>0&&($(".favorites.tabs").find(".tabItem").each(function(){if(!$(this).find(".carouselContent").hasClass("noItem")){var size=$(this).find(".carouselContent > ul > li").length,itemH=$(this).find(".carouselContent > ul > li").outerHeight();size<=3?$(this).find(".carouselContent").css("height",itemH*size+"px"):$(this).find(".carouselContent").css("height",3*itemH+"px")}}),$(".favorites .carousel").each(function(){$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderList:"carouselContent",sliderButtonCov:"carouselUpBtn",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!1,sliderMethod:"up",callBack:function(obj,setting){$(obj).closest(".carousel").hasClass("initItem")&&$(obj).closest(".carousel").removeClass("initItem")}})}));var mainNav=$("#header .mainNav");enquire.register("screen and (max-width: 767px)",{match:function(){mainNav.on("click",function(){mainNav.toggleClass("nav-active"),mainNav.hasClass("nav-active")?$("body").on("click.mobile-nav",function(e){$(e.target).closest("#header .mainNav").length<1&&mainNav.trigger("click")}):$("body").unbind("click.mobile-nav")})},unmatch:function(){mainNav.unbind("click")}});var footerCmsHeadings=$(".cms h2"),footerCategoryHeadings=$(".catgNav .catList > .vList > li:first-child");enquire.register("screen and (max-width: 540px)",{match:function(){footerCmsHeadings.add(footerCategoryHeadings).addClass("showHide").siblings().hide()},unmatch:function(){footerCmsHeadings.add(footerCategoryHeadings).removeClass("showHide showHide-displayed").siblings().show()}})}),function($j){$j.EndecaSearchSuggestor=function(ele,opts){this._active=!0,this._options=opts,this._lastValue="",this._element=ele,this._container=$j('<div class="'+this._options.containerClass+'"></>'),this._timeOutId,this._hideTimeOutId,this._selectedIndex=-1;var suggestor=this;$j("div.searchBox").append(this._container),ele.keydown(function(e){switch(e.keyCode){case 38:suggestor._active?suggestor.moveToPrev():suggestor.show();break;case 40:suggestor._active?suggestor.moveToNext():suggestor.show();break;case 9:suggestor.hide();break;case 13:if(suggestor._active&&suggestor._selectedIndex!=-1)return e.preventDefault(),suggestor.selectItem(),!1;break;case 27:suggestor._active&&suggestor.hide();break;default:suggestor.handleRequest()}}),ele.blur(function(e){var hideFunction=function(){suggestor.hide()};suggestor._hideTimeOutId=setTimeout(hideFunction,200)})},$j.EndecaSearchSuggestor.prototype.moveToPrev=function(){if(this._selectedIndex==-1)this._selectedIndex=0;else{if(0==this._selectedIndex)return;this._selectedIndex--}$j(this._container).show(),$j("div.keywords").find("li").css("background-color","");var selectSuggest=$j($j("div.keywords").find("li").get(this._selectedIndex));$j(selectSuggest).css("background-color","#e5f2c1"),$j("#atg_store_searchInput").val($j(selectSuggest).text())},$j.EndecaSearchSuggestor.prototype.moveToNext=function(){if(this._selectedIndex==-1)this._selectedIndex=0;else{if(this._selectedIndex==$j(".dimResult",this._container).size()-1)return;this._selectedIndex++}$j(this._container).show(),$j("div.keywords").find("li").css("background-color","");var selectSuggest=$j($j("div.keywords").find("li").get(this._selectedIndex));$j(selectSuggest).css("background-color","#e5f2c1"),$j("#atg_store_searchInput").val($j(selectSuggest).text())},$j.EndecaSearchSuggestor.prototype.selectItem=function(){if(this._selectedIndex!=-1){var selectSuggest=$j($j("div.keywords").find("li a").get(this._selectedIndex)),url=selectSuggest.attr("href");null!=url&&(document.location.href=url)}},$j.EndecaSearchSuggestor.prototype.hide=function(){this._container.hide(),this._active=!1},$j.EndecaSearchSuggestor.prototype.show=function(){this._container.is(":hidden")&&(this.setPosition(),this._container.show(),this._active=!0,this._selectedIndex=-1)},$j.EndecaSearchSuggestor.prototype.handleRequest=function(){var suggestor=this,callback=function(){var text=$j.trim(suggestor._element.val());text!=suggestor._lastValue&&(text.length>=suggestor._options.minAutoSuggestInputLength?suggestor.requestData():suggestor.hide()),suggestor._lastValue=text};this._timeOutId&&clearTimeout(this._timeOutId),this._timeOutId=setTimeout(callback,this._options.delay)},$j.EndecaSearchSuggestor.prototype.requestData=function(){var suggestor=this;$j.ajax({url:suggestor.composeUrl(),dataType:"html",async:!0,success:function(data){suggestor.showSearchResult(data)}})},$j.EndecaSearchSuggestor.prototype.composeUrl=function(){var url=this._options.autoSuggestServiceUrl,searchTerm=$j.trim(this._element.val());return url+=url.indexOf("?")==-1?"?":"&",url+="D="+searchTerm+"*"},$j.EndecaSearchSuggestor.prototype.showSearchResult=function(data){var htmlResult=data;null!=htmlResult?(this._container.empty(),this._container.append(htmlResult),this.bindEventHandler(),this.show()):this.hide()},$j.EndecaSearchSuggestor.prototype.processSearchResult=function(data){var dimSearchResult=data.dimSearch;return null!=dimSearchResult?(dimSearchResult.displayImage=!0,this.generateHtmlContent(dimSearchResult)):null},$j.EndecaSearchSuggestor.prototype.generateHtmlContent=function(dimSearchResult){var newContent=null;if(null!=dimSearchResult&&dimSearchResult.results.length>0){newContent=$j("<ul></ul>");for(var dimSearchGroupList=dimSearchResult.results,i=0;i<dimSearchGroupList.length;i++)for(var dimResultGroup=dimSearchGroupList[i],j=0;j<dimResultGroup.length;j++){var dimResult=dimResultGroup[j].dimValue,action="N="+dimResult.id+"&contenSearch=Y",text=dimResult.name,ancestors=dimResult.ancestors,ancestorsStr="";if(null!=ancestors&&ancestors.length>0)for(var n=0;n<ancestors.length;n++)ancestorsStr+=ancestors[n].label+" > ";if(dimSearchResult.displayImage){var imageUrl="";null==dimResult.count?"":"&nbsp;("+dimResult.count+")";imageUrl=""!=$j.trim(dimResult.properties.img_url_thumbnail)?dimResult.properties.img_url_thumbnail:this._options.defaultImage,newContent.append('<li><img src="'+imageUrl+'"/><a href="'+this._options.searchUrl+action+'">'+ancestorsStr+this.highlightMatched(text)+"</a></li>")}else newContent.append('<li><a href="'+this._options.searchUrl+action+'">'+ancestorsStr+this.highlightMatched(text)+"</a></li>")}}return null!=newContent?newContent[0]:null},$j.EndecaSearchSuggestor.prototype.highlightMatched=function(text){var inputText=$j.trim(this._element.val()).toLowerCase(),highlighted=text.toLowerCase();if(highlighted.indexOf(inputText)!=-1){var index=highlighted.indexOf(inputText),prefix=text.substring(0,index),suffix=text.substring(index+inputText.length);inputText=text.substr(index,inputText.length),highlighted=prefix+"<b>"+inputText+"</b>"+suffix}return highlighted},$j.EndecaSearchSuggestor.prototype.bindEventHandler=function(){var suggestor=this;$j(".dimResult",this._container).mouseover(function(e){$j(".dimResult",suggestor._container).removeClass("selected"),$j(this).addClass("selected"),suggestor._selectedIndex=$j(".dimResult",suggestor._container).index($j(this))}),$j(".dimResult",this._container).click(function(e){suggestor.selectItem()}),$j("a",$j(".dimResult",this._container)).click(function(e){e.preventDefault(),suggestor.selectItem()}),$j(".dimRoots",this._container).click(function(){clearTimeout(suggestor._hideTimeOutId),suggestor._element.focus()})},$j.EndecaSearchSuggestor.prototype.setPosition=function(){this._element.offset()},$j.fn.endecaSearchSuggest=function(options){var opts=$j.extend({},$j.fn.endecaSearchSuggest.defaults,options);this.each(function(){var element=$j(this);new $j.EndecaSearchSuggestor(element,opts)})},$j.fn.endecaSearchSuggest.defaults={minAutoSuggestInputLength:3,displayImage:!1,delay:250,autoSuggestServiceUrl:"",collection:"",searchUrl:"",containerClass:"dimSearchSuggContainer",defaultImage:"no_image.gif"}}(jQuery),$(document).ready(function(event){$("#atg_store_searchInput").endecaSearchSuggest({minAutoSuggestInputLength:3,autoSuggestServiceUrl:typeAheadUrl,collection:"",searchUrl:"${url}${searchPath}?",containerClass:"keywords",defaultImage:""}),$("#simpleSearch").keydown(function(e){var curKey=e.which;if(13==curKey)return $("#atg_store_searchSubmit").click(),!1})});var pos=0,ctx=null,image=null;!function($){var webcam={extern:null,append:!0,width:320,height:240,mode:"callback",swffile:"jscam_canvas_only.swf",quality:90,debug:function(){},onCapture:function(){},onTick:function(){},onSave:function(){},onLoad:function(){}};window.webcam=webcam,$.fn.webcam=function(options){if("object"==typeof options)for(var ndx in webcam)void 0!==options[ndx]&&(webcam[ndx]=options[ndx]);var source='<object id="XwebcamXobjectX" type="application/x-shockwave-flash" data="'+webcam.swffile+'" width="'+webcam.width+'" height="'+webcam.height+'"><param name="movie" value="'+webcam.swffile+'" /><param name="FlashVars" value="mode='+webcam.mode+"&amp;quality="+webcam.quality+'" /><param name="allowScriptAccess" value="always" /></object>';null!==webcam.extern?$(webcam.extern)[webcam.append?"append":"html"](source):this[webcam.append?"append":"html"](source),(_register=function(run){var cam=document.getElementById("XwebcamXobjectX");void 0!==cam.capture?(webcam.capture=function(x){try{return cam.capture(x)}catch(e){}},webcam.save=function(x){try{return cam.save(x)}catch(e){}},webcam.setCamera=function(x){try{return cam.setCamera(x)}catch(e){}},webcam.getCameraList=function(){try{return cam.getCameraList()}catch(e){}},webcam.onLoad()):0==run?webcam.debug("error","Flash movie not yet registered!"):window.setTimeout(_register,1e3*(4-run),run-1)})(3)}}(jQuery);var lensOverOpt,tryonImgMap;$(function(){function createTryonImages($selectedTint){var opacity=$selectedTint.attr("tintopacity");opacity&&opacity.length>1&&(opacity=opacity.substring(0,opacity.length-1));var tintRGB=$selectedTint.attr("tintrgb");tintRGB&&tintRGB.length>=6&&(tintRGB=tintRGB.substring(1));var $currentItem=$(".frameFit:first").find(".currentItem"),lensShapeId=$currentItem.find("#shapeId").val(),frameSkuId=$currentItem.find("#skuId").val();$("#frameSkuIdCheckTryon").val(frameSkuId),$("#colorCheckTryon").val(tintRGB),$("#opacityCheckTryon").val(opacity),$("#lensShapeIdCheckTryon").val(lensShapeId);var form=$("#checkTryonForm");form.ajaxSubmit({type:"post",async:!1,beforeSend:function(req){req.setRequestHeader("Accept","text/json")},success:function(data){},error:function(data){window.location.reload()}})}$.FrameFitUtils={ffPopupClose:function($obj){$obj.closest(".frameFit").find(".ffUpload").hide(),$obj.closest(".frameFit").find(".popupLayerBg").hide(),$obj.closest(".frameFit").find(".ffContent").css("position","static"),$obj.closest(".frameFit").next().css("margin-top","-1px"),$.FrameFitUtils.removeffOverflow($obj.closest(".frameFit"))},ffCompareColor:function($obj){var currentFrameFit=$obj.closest(".frameFit"),productId=currentFrameFit.find("#productId").val(),allColorStrs="",$ffParent=currentFrameFit.parent(),colorRefs=$obj.closest(".carouselItem").find(".colorBox").find("a input:hidden");$.each(colorRefs,function(){allColorStrs=allColorStrs+$(this).val()+","});var selectedShape,url="/cartridges/frameFit/frameFit_pdp.jsp?compare=color&pId="+productId+"&skuIds="+allColorStrs,parentQV=$.FrameFitUtils.findParentQuickView(currentFrameFit),isInQuickView=null!=parentQV;selectedShape=isInQuickView?parentQV.find("span.lensImg").find("img"):$(".l_prodPanel .lensBoxCov span.lensImg").find("img");var shapeId=selectedShape.length>1?selectedShape[0].attr("name"):selectedShape.attr("name");shapeId&&shapeId.length>0&&(url=url+"&shapeId="+shapeId),currentFrameFit.find("div.loading").removeClass("hidden");var faceData=currentFrameFit.find(".currentItem .carouselItem.recently").find("var").text();faceData=$.parseJSON(faceData),url=url+"&curFaceId="+faceData.faceId,$.ajax({url:url,success:function(framefitPage){currentFrameFit.replaceWith($(framefitPage)),$.FrameFitUtils.initFrameFit($ffParent.find("> .frameFit"),!0),$obj=$ffParent.find("> .frameFit").find(".btn_compare .color").eq(0),$.FrameFitUtils.ffCompare($obj),"undefined"!=typeof dataLayer&&dataLayer.push({event:"Zenni_event",operation:"Compare colors",eventCategory:"Browse",eventLabel:"Frame compare",productId:productId,eventValue:"1"})}})},ffCompareShapes:function($obj){var curFramfit=$obj.closest(".frameFit");$ffParent=curFramfit.parent();var skuId=curFramfit.find(".currentItem #skuId").val(),productId=curFramfit.find("#productId").val(),url="/cartridges/frameFit/frameFit_pdp.jsp?compare=shape&skuId="+skuId+"&pId="+productId;curFramfit.find("div.loading").removeClass("hidden");var allShapeLinks,parentQV=$.FrameFitUtils.findParentQuickView(curFramfit),isInQuickView=null!=parentQV;allShapeLinks=isInQuickView?parentQV.find(".lensBox").find("li a"):$(".l_prodPanel .lensBox").find("li a");var allShapes="";if($.each(allShapeLinks,function(){allShapes=allShapes+$(this).attr("id")+","}),!(allShapes.length>0))return void curFramfit.find("div.loading").addClass("hidden");url=url+"&shapeIds="+allShapes;var faceData=curFramfit.find(".currentItem .carouselItem.recently").find("var").text();faceData=$.parseJSON(faceData),url=url+"&curFaceId="+faceData.faceId,$.ajax({url:url,type:"post",success:function(framefitPage){curFramfit.replaceWith($(framefitPage)),$.FrameFitUtils.initFrameFit($ffParent.find("> .frameFit"),!0),$obj=$ffParent.find("> .frameFit").find(".btn_compare .lensShape").eq(0),$.FrameFitUtils.ffCompare($obj),"undefined"!=typeof dataLayer&&dataLayer.push({event:"Zenni_event",operation:"Compare lens shapes",eventCategory:"Browse",eventLabel:"Frame compare",skuId:skuId,eventValue:"1"})}})},ffCompare:function($obj){$obj.closest(".frameFit").addClass("compareBox");var $compareBox=$obj.closest(".compareBox"),$ffCarouselContent=$compareBox.find(".ffCarouselContent");$.FrameFitUtils.addffOverflow($compareBox),$compareBox.hasClass("pdp")&&($compareBox.before("<div class='popupLayerBg transparent'></div>"),$.CommonUtils.closeLensBox($(".lensBox"),$compareBox.parent().parent())),$compareBox.hasClass("catg")&&this.initFrameFitHeight($ffCarouselContent.find("> ul"));var itemHeight=$ffCarouselContent.find("> ul > li").eq(0).outerHeight(),itemWidth=$ffCarouselContent.find("> ul > li").eq(0).outerWidth(),itemLength=$ffCarouselContent.find("> ul > li").length;$ffCarouselContent.find("> ul").css({height:itemHeight,left:"0"}),$ffCarouselContent.css("height",itemHeight),$compareBox.next().css({position:"relative",top:itemHeight+38+"px"});var leftMoveNum=0,wrapperW=$("#mainSection").width();perCol=Math.floor(wrapperW/itemWidth),leftMoveNum=itemLength>=perCol?itemWidth*(perCol-1)-(perCol-1):itemWidth*(itemLength-1)-itemLength+1,$obj.closest(".ffContent").animate({"margin-left":"-"+leftMoveNum},2e3,function(){$ffCarouselContent.find("> ul").css("width",parseFloat($ffCarouselContent.outerWidth())+1+"px"),$ffCarouselContent.find("> ul").css("height","auto");var length=$ffCarouselContent.find("> ul > li").length,num=1;length>perCol&&(num+=Math.floor((length-perCol)/(perCol-1)),(length-perCol)%(perCol-1)!=0&&(num+=1));var realHeight=num*itemHeight;$ffCarouselContent.find("> ul").css("height",realHeight),$ffCarouselContent.find("> ul > li:gt("+(perCol-1)+")").wrapAll('<ul class="newColumn" />'),$ffCarouselContent.find("ul.newColumn > li").each(function(index){index%(perCol-1)==0&&$(this).addClass("first-child"),(index+1)%(perCol-1)!=0&&index+1!=$ffCarouselContent.find("ul.newColumn > li").length||$(this).addClass("last-child")}),$ffCarouselContent.animate({height:realHeight},1e3,function(){})}),$obj.closest(".frameFit").hasClass("catg")&&parseInt($(".ffCov").css("margin-top"))<0&&$(".categoryList").animate({"margin-top":"210px"},2e3,function(){})},ffCompareClose:function($obj,type){var $frameFit=$obj.closest(".frameFit"),$ffUL=$frameFit.find(".ffCarouselContent > ul");itemHeight=$ffUL.find("> li").eq(0).outerHeight(),$ffCarouselContent=$frameFit.find(".ffCarouselContent"),$frameFit.hasClass("pdp")&&$frameFit.prev(".popupLayerBg").detach(),$(document).scrollTop()>$frameFit.offset().top&&$(document).scrollTop($frameFit.offset().top),$ffCarouselContent.find("> ul").css({height:itemHeight,overflow:"hidden"}),$obj.closest(".ffContent").animate({"margin-left":"0"},2e3,function(){$frameFit.removeClass("compareBox"),$frameFit.find(".ffCarouselContent .newColumn").children().unwrap(),$frameFit.hasClass("catg")&&$.FrameFitUtils.initFrameFitHeight($frameFit.find(".ffCarouselContent > ul")),itemHeight=$ffUL.find(" > li").eq(0).outerHeight(),$ffCarouselContent.css("height",itemHeight),$(this).find(".frameFit_carousel > .update").trigger("click");var $currentItem;if("pdpBtnOrder"==type){$currentItem=$obj.closest(".carouselItem");var isInOrder=$frameFit.hasClass("odr");if(!isInOrder){var data,productId=$frameFit.find("#productId").val(),skuId=$currentItem.find(".colorBox a.recently").find("input:hidden").val(),shapeId=$currentItem.find("#shapeId").val(),dataObj=$currentItem.find(".ffThumbnail .carouselItem.recently a");data=dataObj.find("var").length?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")};var selectedFaceId=data.faceId;return void $.get("/misc/ajax/framefit/redirectUrl.jsp",{skuId:skuId,pId:productId,lensShapeId:shapeId,faceId:selectedFaceId},function(url){window.location.href=url})}$ffUL.css("left",-$obj.closest(".carouselItem").index()*$ffUL.find(" > li").eq(0).outerWidth()+"px");var curPd=$obj.closest(".carouselItem").find(".itemPDInfo").find("> span").text();$frameFit.find(".ffTitle > h4 > a").html("PD: "+curPd);var colorName=$currentItem.find(".colorBox").find("a.recently").attr("name"),colorSpan=$(".colorCon").find('a[name="'+colorName+'"]');1==colorSpan.length&&colorSpan.trigger("click");var lensShapeId=$currentItem.find("#shapeId").val(),selectedShape=$(".lensBox li").find("#"+lensShapeId);1==selectedShape.length&&selectedShape.trigger("click")}else if("catgClose"==type){$currentItem=$frameFit.find(".ffCarouselContent > ul > li.currentItem"),$ffUL.css("left",-$currentItem.index()*$ffUL.find(" > li").eq(0).outerWidth()+"px"),$(this).find(".frameFit_carousel > .changeCurrentItem").attr("currentItemIndex",$currentItem.index()),$(this).find(".frameFit_carousel > .changeCurrentItem").trigger("click");var curPd=$frameFit.find(".currentItem").find(".itemPDInfo").find("> span").text();$frameFit.find(".ffTitle > h4 > a").html("PD: "+curPd)}else{if("catgBtnOrder"==type){$currentItem=$obj.closest(".carouselItem");var data,productId=$currentItem.find("#tempProductId").val(),skuId=$currentItem.find(".colorBox a.recently").find("input:hidden").last().val(),shapeId=$currentItem.find("#shapeId").val(),dataObj=$currentItem.find(".ffThumbnail .carouselItem.recently a");data=dataObj.find("var").length?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")};var selectedFaceId=data.faceId;return void $.get("/misc/ajax/framefit/redirectUrl.jsp",{skuId:skuId,pId:productId,lensShapeId:shapeId,faceId:selectedFaceId},function(url){window.location.href=url})}$ffUL.css("left",0);var curPd=$ffUL.find(" > li").eq(0).find(".itemPDInfo").find("> span").text();$(".ffTitle > h4 > a").html("PD: "+curPd),$currentItem=$ffUL.find("> li.carouselItem").eq(0);var curPDPcolor,parentQV=$.FrameFitUtils.findParentQuickView($currentItem);curPDPcolor=null==parentQV?$(".l_prodPanel .colorCon").find("a.recently").attr("name"):parentQV.find(".colorCon").find("a.recently").attr("name");var colorSpan=$currentItem.find(".colorBox").find('a[name="'+curPDPcolor+'"]');1==colorSpan.length&&colorSpan.trigger("click")}$currentItem.addClass("currentItem").siblings().removeClass("currentItem"),$frameFit.next().css({top:"0",position:"static"}),$.FrameFitUtils.removeffOverflow($frameFit)}),$obj.closest(".frameFit").hasClass("catg")&&parseInt($(".categoryList").css("margin-top"))>0&&$(".categoryList").animate({"margin-top":"0"},2e3,function(){})},updateSelectedFaceToOrder:function(){var data,$currentItem=$(".frameFit.pdp").find(".carouselItem.currentItem").eq(0),dataObj=$currentItem.find(".ffThumbnail .carouselItem.recently a");data=dataObj.find("var").length?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")},$("#selectedFaceId").val(data.faceId)},initFrameFitHeight:function($ffUL){var $maxHeightItem,maxHeight=0;$ffUL.find(">li").css("height","auto"),$ffUL.find(">li").each(function(){$(this).height()>maxHeight&&(maxHeight=$(this).height(),$maxHeightItem=$(this))}),0==maxHeight&&($maxHeightItem=$ffUL.find(">li").eq(0)),$ffUL.parent().css("height",$maxHeightItem.outerHeight()+"px"),$ffUL.css("height",$maxHeightItem.outerHeight()+"px"),$ffUL.find(">li").css("height",$maxHeightItem.height()+"px")},uploadCallback:function(result){var resultObj=result;if("failed"==resultObj.status)return resultObj.pupil?$(".ffUpload .errorBox").removeClass("hidden").find(".error").html(resultObj.pupil):$(".ffUpload .errorBox").addClass("hidden"),void(resultObj.image&&$(".ffUpload .fileInput span").addClass("error").html(resultObj.image));var $ffUpload=$("#uploadForm").closest(".ffUpload");$.ajax({url:"/misc/ajax/framefit/selectPupils.jsp",success:function(str){$ffUpload.replaceWith(str),"function"==typeof selectPupilCallback&&selectPupilCallback(resultObj);var data=result,selPupilsH=$(".selPupils .r_sec").height(),$image=$(".selPupils .r_sec img");$image.attr("src",result.image.originUrl);var leftOrginX=data.leftPupil.coordX,rightOrginX=data.rightPupil.coordX,leftOrginY=data.leftPupil.coordY,rightOrginY=data.rightPupil.coordY;if(data.image.height>selPupilsH){var newImg=new Image;newImg.src=$image.attr("src"),newImg.onload=function(){$.touchUtil.isTouch?$(".selPupils .r_sec").css("overflow","auto"):$(".selPupils .r_sec").acsScrollBar({scrollContainer:$(".selPupils .r_sec")})}}data.leftPupil.coordY=parseFloat(data.leftPupil.coordY)-32.5,data.rightPupil.coordY=parseFloat(data.rightPupil.coordY)-32.5,data.leftPupil.coordX=parseFloat(data.leftPupil.coordX)-32.5,data.rightPupil.coordX=parseFloat(data.rightPupil.coordX)-32.5,$image.css({width:data.image.width+"px",height:data.image.height+"px"}),$(".selPupils .r_sec").find(".l_pupil").css({top:data.leftPupil.coordY+"px",left:data.leftPupil.coordX+"px"}),$(".selPupils .r_sec").find(".r_pupil").css({top:data.rightPupil.coordY+"px",left:data.rightPupil.coordX+"px"}),$("#lPupil").val(leftOrginX+","+leftOrginY),$("#rPupil").val(rightOrginX+","+rightOrginY),$("#updatePupilForm #addToProfile").val(data.transientImage),$("#updatePupilForm #faceImageId").val(data.faceId);var native_width=0,native_height=0;$(".selPupils .l_pupil, .selPupils .r_pupil").draggable({containment:"parent",start:function(){$(".pupilImageContainer .large").css({background:"url('"+$(".pupilImageContainer .small").attr("src").replace(".jpg","_large.jpg")+"') no-repeat"})},drag:function(e){if($.browser.msie&&"8.0"==$.browser.version);else{if(!native_width&&!native_height){var image_object=new Image;image_object.src=$(".pupilImageContainer .small").attr("src").replace(".jpg","_large.jpg"),native_width=image_object.width,native_height=image_object.height}var sty=$(e.target).attr("style"),TopStartPosition=$.trim(sty.substring(sty.indexOf("top:")+4)),my=Math.round(parseFloat(TopStartPosition.substring(0,TopStartPosition.indexOf("px;")))+$(e.target).height()/2),leftStartPosition=$.trim(sty.substring(sty.indexOf("left:")+5)),mx=Math.round(parseFloat(leftStartPosition.substring(0,leftStartPosition.indexOf("px;")))+$(e.target).width()/2);mx<$(".pupilImageContainer .magnify").width()&&my<$(".pupilImageContainer .magnify").height()&&mx>0&&my>0&&$(".pupilImageContainer .large").fadeIn(100);var isRotate=$(".pupilImageContainer .magnify").attr("style"),Rotate_Deg="";if(null!=isRotate&&isRotate.indexOf("rotate")>0&&(Rotate_Deg=isRotate.substring(isRotate.indexOf("rotate")+7,isRotate.indexOf("deg"))),$(".pupilImageContainer .large").is(":visible"))switch(Rotate_Deg){case"90":var relativeLeft=mx-$(".pupilImageContainer .magnify").position().left,relativeTop=my-$(".pupilImageContainer .magnify").position().top,rx=Math.round(($(".pupilImageContainer .small").outerHeight()-relativeLeft)/$(".pupilImageContainer .small").height()*native_height-$(".pupilImageContainer .large").height()/2)*-1,ry=Math.round(relativeTop/$(".pupilImageContainer .small").width()*native_width-$(".pupilImageContainer .large").width()/2)*-1,bgp=ry+"px "+rx+"px",px=relativeLeft-$(".pupilImageContainer .large").width()/2,py=relativeTop-$(".pupilImageContainer .large").height()/2;$(".pupilImageContainer .large").css({bottom:px,left:py,"background-position":bgp});break;case"180":var rx=Math.round(($(".pupilImageContainer .small").outerWidth()-mx)/$(".pupilImageContainer .small").width()*native_width-$(".pupilImageContainer .large").width()/2)*-1,ry=Math.round(($(".pupilImageContainer .small").outerHeight()-my)/$(".pupilImageContainer .small").height()*native_height-$(".pupilImageContainer .large").height()/2)*-1,bgp=rx+"px "+ry+"px",px=mx-$(".pupilImageContainer .large").width()/2,py=my-$(".pupilImageContainer .large").height()/2;$(".pupilImageContainer .large").css({right:px,bottom:py,"background-position":bgp
});break;case"270":var relativeLeft=mx-$(".pupilImageContainer .magnify").position().left,relativeTop=my-$(".pupilImageContainer .magnify").position().top,rx=Math.round(relativeLeft/$(".pupilImageContainer .small").height()*native_height-$(".pupilImageContainer .large").height()/2)*-1,ry=Math.round(($(".pupilImageContainer .small").outerWidth()-relativeTop)/$(".pupilImageContainer .small").width()*native_width-$(".pupilImageContainer .large").width()/2)*-1,bgp=ry+"px "+rx+"px",px=relativeLeft-$(".pupilImageContainer .large").width()/2,py=relativeTop-$(".pupilImageContainer .large").height()/2;$(".pupilImageContainer .large").css({right:py,top:px,"background-position":bgp});break;default:var rx=Math.round(mx/$(".pupilImageContainer .small").width()*native_width-$(".pupilImageContainer .large").width()/2)*-1,ry=Math.round(my/$(".pupilImageContainer .small").height()*native_height-$(".pupilImageContainer .large").height()/2)*-1,bgp=rx+"px "+ry+"px",px=mx-$(".pupilImageContainer .large").width()/2,py=my-$(".pupilImageContainer .large").height()/2;$(".pupilImageContainer .large").css({left:px,top:py,"background-position":bgp})}}},stop:function(event,ui){$(".pupilImageContainer .large").removeAttr("style");var pupilID="#lPupil";$(event.target).attr("class").indexOf("r_pupil")>-1&&(pupilID="#rPupil");var centerX=ui.position.left+32.5,centerY=ui.position.top+32.5,miniDist=0;miniDist=event.target.className.match(/l_pupil/gi)?$(event.target).position().left-$(".r_pupil").position().left:$(event.target).position().left-$(".l_pupil").position().left,miniDist=0===miniDist?1:miniDist,Math.abs(miniDist)<10?($(event.target).css({top:ui.position.top+"px",left:ui.position.left+miniDist/Math.abs(miniDist)*10+"px"}),$(pupilID).val(centerX+miniDist/Math.abs(miniDist)*10+","+centerY)):($(event.target).css({top:ui.position.top+"px",left:ui.position.left+"px"}),$(pupilID).val(centerX+","+centerY))}}),$(".ffUpload .btnClear").live("click",function(e){e.preventDefault(),$(".selPupils .pupilImageContainer").off("click"),$(".selPupils .pupilImageContainer").on("click",function(){$(".l_pupil.pupil.ui-draggable").css({top:"0",left:"0",display:"block"}),$(".r_pupil.pupil.ui-draggable").css({top:"0",left:"0",display:"block"})}),$(this).closest(".ffUpload").find(".r_sec div.pupil").hide(),$("#lPupil").val(""),$("#rPupil").val(""),$(".ffUpload .btnConfirm").removeClass("lightYellow"),$(".ffUpload .btnConfirm").addClass("gray")}),$("#lPupil").val().length>0&&$("#rPupil").val().length>0&&($(".ffUpload .btnConfirm").removeClass("gray"),$(".ffUpload .btnConfirm").addClass("lightYellow")),$(".ffUpload .btnConfirm").die("click"),$(".ffUpload .btnConfirm").live("click",function(e){if(e.preventDefault(),$("#lPupil").val().length>0&&$("#rPupil").val().length>0){var data=$("#updatePupilForm").serialize();$.ajax({url:"/misc/ajax/framefit/ajaxFormResult.jsp",data:data,dataType:"json",success:function(resultObj){"function"==typeof uploadImageCallback&&uploadImageCallback(resultObj);var myFramefits=$(".imgList.myFrameFit");myFramefits.length>0&&location.reload(),$(".ffContent .imgBox").find("li").removeClass("recently");var newli=$.FrameFitUtils.createNewLi(resultObj);$(".ffContent .imgBox").find("ul").prepend(newli),$(".ffContent .imgBox").find("img:first").attr("src",resultObj.imageUrl),$(".ffTitle > h4 a").html("PD: "+resultObj.actualPd),$(".ffTitle > span.selPD > label").text(resultObj.actualPd),$(".ffContent .itemPDInfo span").text(resultObj.actualPd);var $ffThumbnail=$(".frameFit").find(".ffThumbnail");$ffThumbnail.find(".update").trigger("click"),$ffThumbnail.find(".changeCurrentItem").attr("currentItemIndex","0"),$ffThumbnail.find(".changeCurrentItem").trigger("click"),$.FrameFitUtils.updateSessionSlots(resultObj.faceId,"","single")}}),$.FrameFitUtils.ffPopupClose($(this))}}),$("#clockwise").die("click"),$("#clockwise").live("click",function(e){e.preventDefault();var degree_ie=0,degree=parseInt($("#rotateDegree").val());if(degree=(90+degree)%360,$("#rotateDegree").val(degree),$(".pupilImageContainer .magnify").css({transform:"rotate("+degree+"deg)","-moz-transform":"rotate("+degree+"deg)","-webkit-transform":"rotate("+degree+"deg)","-ms-transform":"rotate("+degree+"deg)"}),$.browser.msie&&"8.0"==$.browser.version){switch(degree){case 0:degree_ie=0;break;case 90:degree_ie=1;break;case 180:degree_ie=2;break;case 270:degree_ie=3}$(".pupilImageContainer .magnify").css({filter:"progid:DXImageTransform.Microsoft.BasicImage(rotation="+degree_ie+")"})}}),$(".selPupils .r_sec").die($.touchUtil.mouseClickEvent()),$(".selPupils .pupilImageContainer").on("click",function(){$(".l_pupil.pupil.ui-draggable,.r_pupil.pupil.ui-draggable").css({top:"0",left:"0"})})},error:function(){}})},createNewLi:function(resultObj){var newLi=$('<li class="carouselItem recently"><a data-zoomimg="'+resultObj.largeUrl+'" data-heroimg="'+resultObj.imageUrl+'" data-pd="'+resultObj.actualPd+'" data-systemface="'+resultObj.systemFace+'" data-faceid="'+resultObj.faceId+'" href="/rimless-women"><img src="'+resultObj.thumbnailUrl+'" alt="" /><var>{"faceId":"'+resultObj.faceId+'","systemFace":"'+resultObj.systemFace+'","pd":"'+resultObj.actualPd+'","heroImg":"'+resultObj.imageUrl+'","zoomImg":"'+resultObj.largeUrl+'"}</var></a></li>');return newLi},ffPDPFavTryon:function(carouselItem,frameSkuId){var tryonImageDiv=carouselItem.find(".imgBox > .frameImg"),tryonLargeImage=carouselItem.find(".toolBox #largeFrameImg");frameSkuId&&carouselItem.find(".delBox .frameId").html("#"+$.trim(frameSkuId.toString()));var ratioScale,distance,liy,productId=frameSkuId.substring(0,frameSkuId.length-2);$.ajax({url:"/misc/ajax/framefit/favoriteSkuData.jsp?skuId="+frameSkuId,success:function(tryonData){var data=$.parseJSON(tryonData);ratioScale=data.ratioScale,ratioScale||(ratioScale=894),distance=data.distance,distance||(distance=126),liy=data.liy,liy||(liy=93);var imageUrl=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"small",ratioScale,distance,liy,"","",""),largeImageUrl=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"large",ratioScale,distance,liy,"","","");tryonImageDiv.css("background-image","url("+imageUrl+")"),tryonLargeImage.val(largeImageUrl),carouselItem.find("#tempProductId").val(productId),carouselItem.find("#skuId").val(frameSkuId);var faceId;$.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,"single")}})},ffPDPTryon:function(carouselItem,frameSkuId,lensShapeId,options,colorCon){var tryonImageDiv=carouselItem.find(".imgBox > .frameImg"),tryonLargeImage=carouselItem.find(".toolBox #largeFrameImg");frameSkuId&&carouselItem.find(".delBox .frameId").html("#"+$.trim(frameSkuId.toString()));var ratioScale,distance,liy,productId=frameSkuId.substring(0,frameSkuId.length-2),tintColor=options.tintColor,opacity=options.opacity,data={};if(colorCon)if(colorCon.find("var").size()>0)data=$.parseJSON(colorCon.find("var").text());else{var dataObj=colorCon.find("input");data={ratioScale:dataObj.data("ratioscale"),distance:dataObj.data("distance"),liy:dataObj.data("liy")}}else if(carouselItem.find(".colorBox.small").find("a.recently var").size()>0)data=$.parseJSON(carouselItem.find(".colorBox.small").find("a.recently var").text());else{var dataObj=carouselItem.find(".colorBox.small").find("a.recently input");data={ratioScale:dataObj.data("ratioscale"),distance:dataObj.data("distance"),liy:dataObj.data("liy")}}ratioScale=data.ratioScale,ratioScale||(ratioScale=894),distance=data.distance,distance||(distance=126),liy=data.liy,liy||(liy=93),lensShapeId=lensShapeId||"",tintColor=tintColor||"",opacity=opacity||"";var imageUrl=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"small",ratioScale,distance,liy,lensShapeId,tintColor,opacity),largeImageUrl=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"large",ratioScale,distance,liy,lensShapeId,tintColor,opacity);tryonImageDiv.css("background-image","url("+imageUrl+")"),tryonLargeImage.val(largeImageUrl),carouselItem.find("#tempProductId").val(productId),carouselItem.find("#skuId").val(frameSkuId),lensShapeId&&carouselItem.find("#shapeId").val(lensShapeId)},ffCatgTryon:function(carouselItem,colorLink,lensShapeId,isTryonFav,favSkuId){var frameSkuId;frameSkuId=isTryonFav?favSkuId.toString():$.FrameFitUtils.getSkuIdFromColorLink(colorLink);var productId=frameSkuId.substring(0,frameSkuId.length-2),tryonImageDiv=carouselItem.find(".imgBox > .frameImg"),tryonLargeImage=carouselItem.find(".toolBox #largeFrameImg");lensShapeId||(lensShapeId="");var ratioScale,distance,liy;if(!isTryonFav){var dataObj=colorLink.find("input"),data={ratioScale:dataObj.data("ratioscale"),distance:dataObj.data("distance"),liy:dataObj.data("liy")};ratioScale=data.ratioScale,ratioScale||(ratioScale=894),distance=data.distance,distance||(distance=126),liy=data.liy,liy||(liy=93);var tryonImage=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"small",ratioScale,distance,liy,lensShapeId,"",""),largeImage=$.FrameFitUtils.constructTryonImgUrl(frameSkuId,"large",ratioScale,distance,liy,lensShapeId,"","");tryonImageDiv.css("background-image","url("+tryonImage+")"),tryonLargeImage.val(largeImage)}var curSkuId=carouselItem.find("#stickedSkuId").val(),curProdId=curSkuId.substring(0,curSkuId.length-2);if(productId!=curProdId||isTryonFav)if(isTryonFav)var colorPageUrl="/cartridges/frameFit/gadgets/itemColorSwatch.jsp?frameSkuId="+frameSkuId+"&pId="+productId,promise=$.ajax({url:colorPageUrl,success:function(colorPage){var colorBox=carouselItem.find(".colorBox");colorBox.length>0?colorBox.replaceWith($(colorPage)):carouselItem.append($(colorPage)),carouselItem.find(".colorBox a.recently").trigger("click"),$.FrameFitUtils.initFrameFitHeight(carouselItem.parent())}});else{var ffColorSwatch=$.FrameFitUtils.buildFramefitColorSwatch(colorLink),colorBox=carouselItem.find(".colorBox");colorBox.length>0?colorBox.replaceWith(ffColorSwatch):carouselItem.append(ffColorSwatch),$.FrameFitUtils.initFrameFitHeight(carouselItem.parent())}else{var colors=carouselItem.find(".colorBox a");$.each(colors,function(){$(this).removeClass("recently"),$(this).find("input:hidden").last().val()==frameSkuId&&$(this).addClass("recently")})}if(!(curSkuId&&0!=curSkuId.length||isTryonFav)){carouselItem.find(".imgBox .frameImg").after($('<p class="delBox"><span class="frameId"></span><a class="icon_delete delFrame"></a></p>'));var compareBtn=carouselItem.find(".toolBox > .btn_compare");compareBtn.length>0?compareBtn.after($('<a href="javascript:void(0)" class="styleBtn lightYellow btnOrder">'+orderLabel+"</a>")):carouselItem.find(".toolBox").prepend($('<a href="javascript:void(0)" class="styleBtn lightYellow btnOrder">'+orderLabel+"</a>")),carouselItem.find(".toolBox > .last-child").prepend($('<a href="javascript:void(0)" class="fackBook"><span class="tipBox">'+sharePhotoLabel+'<b class="arrowD"></b></span></a><a href="javascript:void(0)" class="icon_zoom small btnZoom"><span class="tipBox">'+zoomInLabel+'<b class="arrowD"></b></span><input type="hidden" id="largeFrameImg" value="'+largeImage+'" /></a>'))}carouselItem.find("#skuId").val(frameSkuId),carouselItem.find("#stickedSkuId").val(frameSkuId),carouselItem.find("#tempProductId").val(productId),carouselItem.find("#shapeId").val(lensShapeId),carouselItem.find(".delBox .frameId").html("#"+$.trim(frameSkuId));var faceId;return $.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,carouselItem.attr("id")),"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"try on frame",eventCategory:"try-on",eventLabel:frameSkuId,skuId:frameSkuId,eventValue:"1"}),promise},retrievePreviousTryon:function($frameFit){var prevSkuId=$frameFit.find("#stickedSkuId").val(),tryonImageDiv=$frameFit.find(".imgBox > .frameImg"),tryonLargeImage=$frameFit.find(".toolBox #largeFrameImg");if(prevSkuId&&prevSkuId.length>0){var tryonImage=tryonLargeImage.val().replace("large","small");tryonImageDiv.css("background-image","url("+tryonImage+")"),$frameFit.find("#tempProductId").val(prevSkuId.substring(0,prevSkuId.length-2)),$frameFit.find("#skuId").val(prevSkuId)}else tryonImageDiv.css("background-image","url(about:blank)"),tryonLargeImage.val(""),$frameFit.find("#tempProductId").val(""),$frameFit.find("#skuId").val("")},tentativeTryon:function($frameFit,skuId,ratioScale,distance,liy){var tryonImageDiv=$frameFit.find(".imgBox > .frameImg"),tryonImage=$.FrameFitUtils.constructTryonImgUrl(skuId,"small",ratioScale,distance,liy,"","","");tryonImageDiv.css("background-image","url("+tryonImage+")"),$frameFit.find("#tempProductId").val(skuId.substring(0,skuId.length-2)),$frameFit.find("#skuId").val(skuId)},tentativeVSTryon:function($frameFit,url){var tryonImageDiv=$frameFit.find(".imgBox > .frameImg"),tryonImage=url;tryonImageDiv.css("background-image","url("+tryonImage+")"),$frameFit.find("#tempProductId").val(""),$frameFit.find("#skuId").val("")},initFrameFit:function($frameFit,compare){$frameFit.find(".frameFit_carousel").each(function(){$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderList:"ffCarouselContent",sliderButtonCov:"ffCarouselBtn",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",sliderCanDrag:!!$.touchUtil.isTouch,isResize:!1,callBack:function(obj,setting){if($.FrameFitUtils.removeffOverflow($frameFit),$(".ffThumbnail .carouselItem a").live("click",function(e){e.preventDefault();var data="";data=void 0==$(this).data("faceid")||null==$(this).data("faceid")?$.parseJSON($(this).find("var").text()):{faceId:$(this).data("faceid"),systemFace:$(this).data("systemface"),pd:$(this).data("pd"),heroImg:$(this).data("heroimg"),zoomImg:$(this).data("zoomimg")},$(this).closest(".ffThumbnail").parent().find("> img").attr("src",data.heroImg),$(this).parent().addClass("recently").siblings().removeClass("recently");var largeImgItemIndex=$(this).closest(".ffThumbnail").parent().parent().index(),rPanelCurItem=$(".r_prodPanel .ffContent ul").eq(0).find(">li").eq(largeImgItemIndex),ThumbnailImgindex=rPanelCurItem.find(".ffThumbnail li").eq($(this).parent().index()).index();rPanelCurItem.find(".imgBox > img").attr("src",data.heroImg),rPanelCurItem.find(".ffThumbnail li").eq(ThumbnailImgindex).addClass("recently").siblings().removeClass("recently"),$(".ffTitle > h4 a").text("PD: "+data.pd),$(this).closest(".ffThumbnail").parent().prev().find("> span").html(data.pd),$ffTitle=$(this).closest(".frameFit").find(".ffTitle"),$ffTitle.find("h4 > a").show(),$ffTitle.find(".selPD").hide()}),$(".frameFit.catg .ffThumbnail .carouselItem a").live("click",function(e){e.preventDefault();var frameSkuId,data={faceId:$(this).data("faceid"),systemFace:$(this).data("systemface"),pd:$(this).data("pd"),heroImg:$(this).data("heroimg"),zoomImg:$(this).data("zoomimg")},faceId=data.faceId,index=$(this).closest(".ffThumbnail").closest(".carouselItem").attr("id");$.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,index)}),$(".frameFit.pdp .ffThumbnail .carouselItem a").live("click",function(e){e.preventDefault();var data;data=$(this).find("var").size()>0?$.parseJSON($(this).find("var").text()):{faceId:$(this).data("faceid"),systemFace:$(this).data("systemface"),pd:$(this).data("pd"),heroImg:$(this).data("heroimg"),zoomImg:$(this).data("zoomimg")};var frameSkuId,faceId=data.faceId;$.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,"single")}),$(".frameFit_carousel .ffCarouselBtn a").live("click",function(e){e.preventDefault();var curFrameFit=$(this).closest(".frameFit"),thumbnailObj=$(this).closest(".frameFit_carousel").find(".currentItem .ffThumbnail .recently a"),data={faceId:thumbnailObj.data("faceid"),systemFace:thumbnailObj.data("systemface"),pd:thumbnailObj.data("pd"),heroImg:thumbnailObj.data("heroimg"),zoomImg:thumbnailObj.data("zoomimg")};curFrameFit.find("h4 > a").text("PD: "+data.pd);var frameSkuId,currentItem=curFrameFit.find(".currentItem"),index=currentItem.attr("id"),faceId=data.faceId;$.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,index)}),$frameFit.hasClass("catg")&&"function"==typeof setDefaultFaceForCatgPage&&setDefaultFaceForCatgPage(),$frameFit.hasClass("pdp")){var lensShapes,defaultShapeImg,parentQV=$.FrameFitUtils.findParentQuickView($frameFit);if(null!=parentQV?(lensShapes=parentQV.find(".lensBox ul li a"),defaultShapeImg=parentQV.find("span.lensImg > img")):(lensShapes=$(".l_prodPanel .lensBox ul li a"),defaultShapeImg=$("span.lensImg > img")),lensShapes.length<2&&($frameFit.find(".imgBox .toolBox .dropDown > .lensShape").remove(),0==$frameFit.find(".imgBox .toolBox .dropDown > .color").length&&$frameFit.find(".imgBox .toolBox .btn_compare").remove()),defaultShapeImg.length>0&&!compare){var defaultShape=defaultShapeImg.attr("name"),currentShape=$frameFit.find(".currentItem").find("#shapeId").val();currentShape!=defaultShape&&$.FrameFitUtils.tryonLensShape(defaultShape,$frameFit)}}}})}),$frameFit.find(".ffThumbnail .carousel").each(function(){$(this).acsCarousel({sliderLoop:!1,sliderMoveNum:1,sliderList:"carouselContent",sliderButtonCov:"carouselButton",sliderButtonPrev:"carouselPrev",sliderButtonNext:"carouselNext",isResize:!1,sliderCanDrag:!!$.touchUtil.isTouch,callBack:function(obj,setting){$(".ffThumbnail .close").live("click",function(e){e.preventDefault(),$(this).closest(".ffThumbnail").hide()})}})});var catgFrameFit=$(".frameFit.catg");if(catgFrameFit&&catgFrameFit.length>0){var frameSkuId,currentFaceNode=catgFrameFit.find(".frameFit_carousel").first().find(".currentItem").first(),index=currentFaceNode.attr("id"),thumbnailObj=currentFaceNode.find(".ffThumbnail .recently a").first(),data={faceId:thumbnailObj.data("faceid"),systemFace:thumbnailObj.data("systemface"),pd:thumbnailObj.data("pd"),heroImg:thumbnailObj.data("heroimg"),zoomImg:thumbnailObj.data("zoomimg")},faceId=data.faceId;$.FrameFitUtils.updateSessionSlots(faceId,frameSkuId,index)}},updateSessionSlots:function(faceId,frameSkuId,index){$.cookie.json=!0;var sessionSlots=$.cookie("sessionSlots");if(null==sessionSlots){var sessionSlots={frameFit:[{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""}],activeIndex:0};$.cookie("sessionSlots",sessionSlots,{expires:7,path:"/"})}if(sessionSlots=$.cookie("sessionSlots"),"single"==index&&(index=sessionSlots.activeIndex),index||0==index||"0"==index)faceId&&(sessionSlots.frameFit[index].faceId=faceId),frameSkuId&&(sessionSlots.frameFit[index].skuId=frameSkuId),sessionSlots.activeIndex=index;else for(var i=0;i<sessionSlots.frameFit.length;i++)faceId&&(sessionSlots.frameFit[i].faceId=faceId),frameSkuId&&(sessionSlots.frameFit[i].skuId=frameSkuId);$.cookie("sessionSlots",sessionSlots,{expires:7,path:"/"})},deleteFrame:function(index){var catgFrameFit=$(".frameFit.catg");if(catgFrameFit&&catgFrameFit.length>0){catgFrameFit.find("#removeFrameFit");$.cookie.json=!0;var sessionSlots=$.cookie("sessionSlots");if(null==sessionSlots){var sessionSlots={frameFit:[{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""},{faceId:"",skuId:"",shapeId:""}],activeIndex:0};$.cookie("sessionSlots",sessionSlots,{expires:7,path:"/"})}sessionSlots=$.cookie("sessionSlots"),sessionSlots.frameFit[index].skuId="",$.cookie("sessionSlots",sessionSlots,{expires:7,path:"/"}),catgFrameFit.find(".carouselItem#"+index).find(".imgBox .frameImg").css("background-image",""),catgFrameFit.find(".carouselItem#"+index).find(".colorBox").remove(),catgFrameFit.find(".carouselItem#"+index).find(".toolBox > .btnOrder").remove(),catgFrameFit.find(".carouselItem#"+index).find(".toolBox > .last-child > .fackBook").remove(),catgFrameFit.find(".carouselItem#"+index).find(".toolBox > .last-child > .icon_zoom").remove(),catgFrameFit.find(".carouselItem#"+index).find("#stickedSkuId").val(""),catgFrameFit.find(".carouselItem#"+index).find("#skuId").val(""),$.FrameFitUtils.initFrameFitHeight(catgFrameFit.find(".ffCarouselContent > ul"))}},addffOverflow:function($frameFit){$frameFit.hasClass("pdp")&&($frameFit.find(".frameFit_carousel > .ffCarouselContent").css("overflow","hidden"),$frameFit.parent().removeClass("overflowX"))},removeffOverflow:function($frameFit){$frameFit.hasClass("pdp")&&($frameFit.find(".frameFit_carousel > .ffCarouselContent").css("overflow","visible"),$frameFit.find(".frameFit_carousel > .ffCarouselContent > ul").css("overflow","visible"),$frameFit.parent().addClass("overflowX"))},pdpTintTryon:function($selectedTint){createTryonImages($selectedTint);var opacity=$selectedTint.attr("tintOpacity");opacity&&opacity.length>1&&(opacity=opacity.substring(0,opacity.length-1));var tintRGB=$selectedTint.attr("tintRGB"),$currentItem=$(".frameFit:first").find(".currentItem"),currentSkuId=$currentItem.find("#skuId").val(),lensShapeId=$currentItem.find("#shapeId").val(),options={};tintRGB&&tintRGB.length>=6&&(tintRGB=tintRGB.substring(1),options={tintColor:tintRGB,opacity:opacity,addonType:"tinted"}),$.FrameFitUtils.ffPDPTryon($currentItem,currentSkuId,lensShapeId,options)},findParentQuickView:function($obj){var qvCon=$obj.closest(".qvCon");return 1==qvCon.length?qvCon:null},attachLensOverEvent:function($frameFit,isInQV){var parentContainer;parentContainer=isInQV?$(".qvCon:first"):$(".l_prodPanel"),parentContainer.find(".lensBox ul li a").hover(function(){clearTimeout(lensOverOpt);var lensShapeId=$(this).attr("id");$.FrameFitUtils.tryonLensShape(lensShapeId,$frameFit)},function(){var lensShapeId=$(this).closest("ul").find("a.recently").attr("id");lensOverOpt=setTimeout(function(){$.FrameFitUtils.tryonLensShape(lensShapeId,$frameFit)},700)})},tryonLensShape:function(lensShapeId,$frameFit){var $currentItem=$frameFit.find(".currentItem"),colorBox=$currentItem.find(".colorBox"),currentSkuId=$currentItem.find(".colorBox a.recently").find("input:hidden").last().val(),options={},checkedTintSection=$("#lensTintChoose:visible").find(".radio.checked").closest("dl");if(checkedTintSection.length>0){var selectedTint=checkedTintSection.find("select > option:selected"),opacity=selectedTint.attr("tintOpacity"),tintRGB=selectedTint.attr("tintRGB");tintRGB&&tintRGB.length>=6&&(options.tintColor=tintRGB.substring(1),options.addonType="tinted",opacity&&(options.opacity=opacity))}return $.FrameFitUtils.ffPDPTryon($currentItem,currentSkuId,lensShapeId,options),$currentItem.find(".btn_compare .color").length>0&&colorBox.removeClass("disable"),currentSkuId},tryonMyFavorite:function(favLink){var frameSkuId=favLink.attr("skuId"),curFramefit=$(".popupContent .frameFit").size()?$(".popupContent .frameFit"):$(".frameFit:first"),$currentItem=curFramefit.find(".currentItem");if(curFramefit.hasClass("pdp")){var colorBox=$currentItem.find(".colorBox");colorBox.hasClass("disable")||colorBox.addClass("disable"),$.FrameFitUtils.ffPDPFavTryon($currentItem,frameSkuId),"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"try on frame",eventCategory:"try-on",eventLabel:frameSkuId,skuId:frameSkuId,eventValue:"1"})}else if(curFramefit.hasClass("catg")){var colorLink,shapeId;$.FrameFitUtils.ffCatgTryon($currentItem,colorLink,shapeId,!0,frameSkuId)}},removeScalePoint:function(inputData){if(!inputData)return inputData;var resultDate=""+inputData;return resultDate.indexOf(".0")>0&&(resultDate=resultDate.substring(0,resultDate.length-2)),resultDate},constructTryonImgUrl:function(frameSkuId,size,ratioScale,distance,liy,shapeId,tintColor,opacity){ratioScale=$.FrameFitUtils.removeScalePoint(ratioScale),distance=$.FrameFitUtils.removeScalePoint(distance),liy=$.FrameFitUtils.removeScalePoint(liy);var url=staticHost+"/images/cacheImg/tryon/",fileName=frameSkuId+"_"+shapeId+"_"+tintColor+"_"+opacity+"_"+ratioScale+"_"+distance+"_"+liy+".png";return url=url+frameSkuId.substring(0,2)+"/"+frameSkuId.substring(2,4)+"/"+frameSkuId+"/"+size+"/"+fileName},buildFramefitColorSwatch:function(hoverColorLink){if(!hoverColorLink)return"";var colorLinks=hoverColorLink.parent().find("a"),colorSwatchSmall=$('<div class="colorBox small'+(colorLinks.length<=1?" hidden":"")+'"></div>');return $.each(colorLinks,function(){var colorLink=$.FrameFitUtils.buildColorLinkInFF($(this));colorSwatchSmall.append(colorLink)}),colorSwatchSmall},buildColorLinkInFF:function(hoverColorLink){var colorLink=$("<a></a>");colorLink.attr("name",hoverColorLink.attr("name")),hoverColorLink.hasClass("recently")&&colorLink.addClass("recently");var colorSpan=hoverColorLink.find("span");if(colorSpan.length>0)colorLink.append(colorSpan.clone());else{var colorImg=hoverColorLink.find("img");colorImg.length>0&&colorLink.append(colorImg.clone())}var variableText;variableText=hoverColorLink.find("var").size()>0?hoverColorLink.find("var"):hoverColorLink.find("input"),colorLink.append(variableText.clone());var hiddenSku=$('<input type="hidden"/>'),skuId=$.FrameFitUtils.getSkuIdFromColorLink(hoverColorLink);return hiddenSku.val(skuId),colorLink.append(hiddenSku),colorLink},getSkuIdFromColorLink:function(colorLink){var skuId=colorLink.attr("skuid");if(!skuId&&(skuId=colorLink.find("input:hidden").val(),!skuId)){var dataObj=colorLink.find("var");if(dataObj&&$(dataObj).size()>0){var data=$.parseJSON($(dataObj).text());skuId=data.sku||data.skuId}else dataObj=colorLink.find("input"),skuId=dataObj.data("sku")||dataObj.data("skuid")}skuId=skuId.toString();var strengthIndex=skuId.indexOf("-");return strengthIndex>0&&(skuId=skuId.substring(0,strengthIndex)),0==skuId.indexOf("#")&&(skuId=skuId.substring(1)),skuId},MovePupilPosition:function(e,obj){if($(e.target).closest(".pupil").size())return!1;var lPupilVisible=$(obj).find(".l_pupil").is(":visible"),rPupilVisible=$(obj).find(".r_pupil").is(":visible");$(obj).offset();"undefined"!=typeof e.pageX&&"undefined"!=typeof e.pageY||(e.pageX=e.originalEvent.touches[0].pageX,e.pageY=e.originalEvent.touches[0].pageY,e.srcElement=e.target);var centerX=$(obj).position().left+32.5,centerY=$(obj).position().top+32.5,scrollBarOffset=parseFloat($(obj).find(".sbarContent").css("margin-top"));scrollBarOffset=isNaN(scrollBarOffset)?0:scrollBarOffset;var x=centerX-32.5,y=centerY-32.5+scrollBarOffset,lPupil=$(obj).find(".l_pupil"),rPupil=$(obj).find(".r_pupil");lPupilVisible?rPupilVisible||(rPupil.show(),rPupil.css({top:y+"px",left:x+"px"}),$("#rPupil").val(centerX+","+centerY)):(lPupil.show(),lPupil.css({top:y+"px",left:x+"px"}),$("#lPupil").val(centerX+","+centerY));var lPupilX=parseFloat(lPupil.css("left")),lPupilY=parseFloat(lPupil.css("top")),distanceToLpupil=Math.sqrt((x-lPupilX)*(x-lPupilX)+(y-lPupilY)*(y-lPupilY)),rPupilX=parseFloat(rPupil.css("left")),rPupilY=parseFloat(rPupil.css("top")),distanceToRpupil=Math.sqrt((x-rPupilX)*(x-rPupilX)+(y-rPupilY)*(y-rPupilY));distanceToLpupil<distanceToRpupil?(lPupil.css({top:y+"px",left:x+"px"}),$("#lPupil").val(centerX+","+centerY)):(rPupil.css({top:y+"px",left:x+"px"}),$("#rPupil").val(centerX+","+centerY)),$("#lPupil").val().length>0&&$("#rPupil").val().length>0&&($(".ffUpload .btnConfirm").removeClass("gray"),$(".ffUpload .btnConfirm").addClass("lightYellow"))}},$.FrameFitUtils.initFrameFit($(".frameFit")),$.FrameFitUtils.attachLensOverEvent($(".frameFit"),!1),$(".frameFit .setting").live("click",function(e){e.preventDefault(),$(this).closest(".imgBox").find(".ffThumbnail").show()}),$(".frameFit.pdp .btn_compare").live("click",function(e){e.preventDefault();var $content=$(this).find(".dropDown");$content.is(":visible")?$content.addClass("hidden"):$content.removeClass("hidden")}),$(".frameFit.pdp .btn_compare").live("hover",function(event){"mouseover"==event.type||$(this).find(".dropDown").addClass("hidden")}),$(".compareBox.pdp .compareTitle .close").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareClose($(this),"")}),$(".compareBox.catg .compareTitle .close").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareClose($(this),"catgClose")}),$(".frameFit.pdp .ffContent .btnOrder").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareClose($(this),"pdpBtnOrder")}),$(".frameFit.catg .ffContent .btnOrder").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareClose($(this),"catgBtnOrder")}),$(".frameFit.ffTryOnBox .btnOrder").live("click",function(e){e.preventDefault();var data,$currentItem=$(this).closest(".carouselItem"),skuId=$currentItem.find("#skuId").val(),productId=$currentItem.find("#tempProductId").val(),dataObj=$currentItem.find(".ffThumbnail .carouselItem.recently a");data=dataObj.find("var").length?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")};var curFaceId=data.faceId;$.get("/misc/ajax/framefit/redirectUrl.jsp",{skuId:skuId,pId:productId,faceId:curFaceId},function(data){window.location.href=data})}),$(".frameFit .btn_compare .color").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareColor($(this))}),$(".frameFit .btn_compare .lensShape").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffCompareShapes($(this))}),$(".frameFit.catg .btn_compare").live("click",function(e){e.preventDefault();var $container=$(".l_prodPanel"),$closeBtn=$(".compareTitle .close"),$refineBtn=$(".btnRefine"),containerFilter=$container.hasClass("filterOpened");$.CommonUtils.closeLensBox($(".lensBox"),$(".ffCov")),$.CommonUtils.closeQuickView(),$.CatgMenu.closeMenu(),$.FrameFitUtils.ffCompare($(this)),"function"==typeof compareFramefitCallback&&compareFramefitCallback(),containerFilter?($closeBtn.off("click"),$closeBtn.on("click",function(){setTimeout(function(){$refineBtn.trigger("click")},2500)})):$closeBtn.off("click")}),$(".frameFit.catg.compareBox .ffCarouselContent > ul > .carouselItem").live("click",function(){$(".ffCarouselContent .newColumn").find("> .currentItem").removeClass("currentItem"),$(".ffCarouselContent > ul").find("> .currentItem").removeClass("currentItem"),$(this).addClass("currentItem");var faceId,frameId,index=$(this).attr("id");$.FrameFitUtils.updateSessionSlots(faceId,frameId,index)}),$(".frameFit .btnZoom").live("click",function(e){e.preventDefault();var currentItem=$(this).closest(".carouselItem"),dataObj=currentItem.find(".ffThumbnail .recently").find("a"),data="";data=$(dataObj).find("var").size()>0?$.parseJSON($(dataObj).find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")};var tempProductId=currentItem.find("#tempProductId").val(),$frameFit=currentItem.closest(".frameFit"),productId=$frameFit.find("#productId").val(),largeFrameUrl=$(this).find("#largeFrameImg").val(),$ffViewLarger=$(this).closest(".ffContent").find(".ffViewLarger");$ffViewLarger.find("img").eq(0).attr("src",data.zoomImg),largeFrameUrl&&$ffViewLarger.find(".frameImg").css("background-image","url("+largeFrameUrl+")"),$ffViewLarger.find(".pd > span").text(data.pd),$(this).acsPopup({popupSrc:$(this).attr("layerSrc"),popupTitle:$(this).attr("layerTitle"),maxWidth:750,maxHeight:750,realHeight:560,initWidth:600,popupID:"ffViewLargerPop",popupContentPreload:$ffViewLarger,callBack:function(setting){$("."+setting.popupLayerContent).find(".btn_order").die("click").live("click",function(e){if(e.preventDefault(),!$frameFit.hasClass("odr")){var skuId=currentItem.find("#skuId").val(),selectedFaceId=data.faceId,shapeId=currentItem.find("#shapeId").val();return tempProductId!=productId?void $.get("/misc/ajax/framefit/redirectUrl.jsp",{skuId:skuId,pId:tempProductId,lensShapeId:shapeId,faceId:selectedFaceId},function(url){window.location.href=url}):void $.get("/misc/ajax/framefit/redirectUrl.jsp",{skuId:skuId,pId:productId,lensShapeId:shapeId,faceId:selectedFaceId},function(url){window.location.href=url})}$(this).closest("#ffViewLargerPop").find(".popupTitle .popupClose").trigger("click");var btnOrder=currentItem.find(".toolBox .btnOrder");btnOrder.trigger("click")})}})}),$(".frameFit.pdp .carouselItem .colorBox > a").live("click",function(e){e.preventDefault();var currentItem=$(this).closest(".carouselItem"),frameSkuId=(currentItem.find("#skuId"),$(this).find("input:hidden").val()),lensShapeId=currentItem.find("#shapeId").val();
lensShapeId||(lensShapeId=$("span.lensImg > img").attr("name"));currentItem.find(".imgBox > .frameImg"),currentItem.find(".toolBox #largeFrameImg");currentItem.find(".delBox .frameId").html("#"+$.trim(frameSkuId.toString()));var checkedTintSection=$("#lensTintChoose:visible").find(".radio.checked").closest("dl"),options={};if(checkedTintSection.length>0){var selectedTint=checkedTintSection.find("select > option:selected"),opacity=selectedTint.attr("tintOpacity");opacity&&opacity.length>1&&(opacity=opacity.substring(0,opacity.length-1));var tintRGB=selectedTint.attr("tintRGB");tintRGB&&tintRGB.length>2&&(tintRGB=tintRGB.substring(1)),options.tintColor=tintRGB,options.opacity=opacity}else{var frameType=$("#frameType").attr("frametype");frameType&&"PremiumSunglasses"==frameType&&(options.tintColor="6c6f70",options.opacity="80")}$.FrameFitUtils.ffPDPTryon(currentItem,frameSkuId,lensShapeId,options,$(this))}),$(".frameFit.catg .carouselItem .colorBox > a").live("click",function(e){e.preventDefault();var $frameFit=$(this).closest(".carouselItem"),lensShapeId=$frameFit.find("#shapeId").val();$.FrameFitUtils.ffCatgTryon($frameFit,$(this),lensShapeId)}),$(".frameFit .btnUpload").live("click",function(e){e.preventDefault(),$.FrameFitUtils.addffOverflow($(this).closest(".frameFit")),$.CommonUtils.closeLensBox($(".lensBox"),$(this).closest(".frameFit").parent().parent());var $frameFit=$(this).closest(".frameFit"),ffHeight=$frameFit.find(".ffContent").outerHeight();$frameFit.find(".ffUpload").detach(),$.ajax({url:"/misc/ajax/framefit/upload.jsp",success:function(str){$frameFit.find(".ffContent").append(str),$frameFit.find(".ffUpload").show(),$frameFit.find(".popupLayerBg").show(),cssua.ua.mobile&&$frameFit.find(".ffUpload .r_sec .btnCamera").addClass("hidden"),$frameFit.find(".ffContent").css({position:"absolute","z-index":"22"}),$frameFit.next().css("margin-top",ffHeight+"px"),"function"==typeof uploadOpenCallback&&uploadOpenCallback()},error:function(){}})}),$(".ffUpload .btnCamera").live("click",function(e){e.preventDefault();var $ffUpload=$(this).closest(".ffUpload"),popParent=$ffUpload.parent();$.ajax({url:"/misc/ajax/framefit/upload_camera.jsp",success:function(str){var pdInfoSec=$ffUpload.find(".pdInfo");$ffUpload.replaceWith(str),popParent.find(".ffUpload .pdInfo").replaceWith(pdInfoSec),initWebcam(),$(".capture").live("click",function(){webcam.capture()})},error:function(){}})}),$(".ffUpload .close").live("click",function(e){e.preventDefault(),$.FrameFitUtils.ffPopupClose($(this)),$(this).closest(".frameFit").next().css("margin-top","-1px")}),$(".frameFit .popupLayerBg").live("click",function(){$(".lensBox").size()>0&&$(".lensBox").is(":visible")||$.FrameFitUtils.ffPopupClose($(this))}),$(".ffUpload .btnUploadPhoto").live("click",function(e){$("#uploadForm").submit()}),$(".uploadByCam").live("click",function(e){var canvas=document.getElementById("canvas"),imageData=canvas.toDataURL("image/png",.9),index=imageData.indexOf(",")+1;$("#imageData").val(imageData.substring(index)),$("#uploadForm").submit()}),$(".frameFit .fackBook").live("click",function(e){var data,dataObj=$(this).closest(".carouselItem").find(".ffThumbnail .carouselItem.recently > a");data=dataObj.find("var").length?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid"),systemFace:dataObj.data("systemface"),pd:dataObj.data("pd"),heroImg:dataObj.data("heroimg"),zoomImg:dataObj.data("zoomimg")};var largeFaceUrl=encodeURI(data.zoomImg),largeFrameUrl=$(this).parent().find(".icon_zoom").find("#largeFrameImg").val();largeFrameUrl=encodeURI(largeFrameUrl);var faceId=data.faceId,frameSkuId=$(this).closest(".carouselItem").find("#skuId").val(),redirectUrl="/cartridges/frameFit/gadgets/shareFacebookRedirect.jsp?frameSkuId="+frameSkuId+"&faceId="+faceId+"&faceImageUrl="+largeFaceUrl+"&frameImageUrl="+largeFrameUrl;window.open(redirectUrl,"FacebookShare","height=300,width=500,top=100,left=280,toolbar=no,menubar=no,scrollbars=no, resizable=no,location=no, status=no"),"function"==typeof shareFacebookCallback&&shareFacebookCallback(frameSkuId)});var catgff=$(".frameFit.catg");if(catgff.length>0){$.FrameFitUtils.initFrameFitHeight(catgff.find(".ffCarouselContent > ul")),catgff.find(".icon_delete").live("click",function(e){e.preventDefault();var index=$(this).closest(".carouselItem").attr("id");$.FrameFitUtils.deleteFrame(index),$(this).closest(".delBox").remove()});var pd=catgff.find(".carouselItem.currentItem").find(".itemPDInfo").find("> span").text();catgff.find(".ffTitle h4 a").text("PD: "+pd),catgff.find(".ffTitle label").text(pd)}if($(".frameFit .ffTitle h4 > a").live("click",function(e){e.preventDefault();var dataObj=$(this).closest(".frameFit").find(".ffCarouselContent > ul > .currentItem").find(".ffThumbnail .recently a"),data={systemFace:dataObj.systemface};if("true"!=data.systemFace){var pd=$(this).text().replace("PD:",""),pd=pd.replace(" ","");$(this).closest(".ffTitle").find(">.select label").text(pd),$(this).closest(".ffTitle").find(">.select select").val(pd),$(this).closest(".ffTitle").find(">.select").show(),$(this).hide()}}),$(document).bind("mouseup",function(e){var container=$(".frameFit");0===container.has(e.target).length&&(container.find(".selPD").hide(),container.find(".ffTitle").find("h4 > a").show())}),$(".frameFit .selPD select").live("change",function(){var updatePDForm=$(this).closest(".frameFit").find("#updatePDForm"),currentItem=$(this).closest(".frameFit").find(".ffCarouselContent > ul > .currentItem"),$ffTitle=$(this).closest(".ffTitle"),dataObj=currentItem.find(".ffThumbnail .recently a"),faceData="";faceData=dataObj.find("var").size()>0?$.parseJSON(dataObj.find("var").text()):{faceId:dataObj.data("faceid")};var faceId=faceData.faceId,newPD=$(this).val();updatePDForm.find("#faceImageId").val(faceId),updatePDForm.find("#newPd").val(newPD);var data=updatePDForm.serialize();$.ajax({url:"/misc/ajax/framefit/ajaxFormResult.jsp",data:data,dataType:"json",success:function(resultObj){var updatedFace=resultObj;$ffTitle.find("h4 > a").text("PD: "+updatedFace.actualPd),$ffTitle.find("h4 > a").show(),$ffTitle.find(".selPD").hide(),currentItem.find(".imgBox > img:first").attr("src",updatedFace.imageUrl),currentItem.find(".ffThumbnail .recently a").data("faceid",updatedFace.faceId),currentItem.find(".ffThumbnail .recently a").data("systemface",updatedFace.systemFace),currentItem.find(".ffThumbnail .recently a").data("pd",updatedFace.actualPd),currentItem.find(".ffThumbnail .recently a").data("heroimg",updatedFace.imageUrl),currentItem.find(".ffThumbnail .recently a").data("zoomimg",updatedFace.largeUrl),"function"==typeof updatePDCallback&&updatePDCallback(newPD)}})}),$(".productDetail .colorCon a").live("click",function(e){e.preventDefault();var currentItem,colorName=$(this).attr("name"),parentQV=$.FrameFitUtils.findParentQuickView($(this));if(null!=parentQV)currentItem=parentQV.find(".frameFit").find(".currentItem");else if(currentItem=$(".frameFit:first").find(".currentItem"),window.history&&history.pushState){var curUrl=window.location.origin+$(this).attr("href");window.history.replaceState(null,null,curUrl)}var colorBox=currentItem.find(".colorBox");colorBox.removeClass("disable"),colorBox.find('a[name="'+colorName+'"]').trigger("click")}),$(".recBox .qvCon .colorCon a").live("click",function(e){e.preventDefault();var currentItem,colorName=$(this).attr("name"),parentQV=$.FrameFitUtils.findParentQuickView($(this));currentItem=parentQV.find(".frameFit").find(".currentItem");var colorBox=currentItem.find(".colorBox");colorBox.removeClass("disable"),colorBox.find('a[name="'+colorName+'"]').trigger("click")}),$(".l_prodPanel .lensBox ul li a").live("click",function(e){var lensShapeId=$(this).attr("id"),currentSkuId=$.FrameFitUtils.tryonLensShape(lensShapeId,$(".frameFit:first"));"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"try on frame",eventCategory:"try-on",eventLabel:currentSkuId+"_"+lensShapeId,skuId:currentSkuId+"_"+lensShapeId,eventValue:"1"})}),$(".qvCon .lensBox ul li a").live("click",function(e){var lensShapeId=$(this).attr("id"),$frameFit=$(this).closest(".qvCon").find(".frameFit"),currentSkuId=$.FrameFitUtils.tryonLensShape(lensShapeId,$frameFit);"undefined"!=typeof dataLayer&&dataLayer.push({event:"zenni_event",operation:"try on frame",eventCategory:"try-on",eventLabel:currentSkuId+"_"+lensShapeId,skuId:currentSkuId+"_"+lensShapeId,eventValue:"1"})}),$("#lensTintChoose").find("select").live("change",function(e){if(0!=$(this).closest("dl").find(".checked").length){var selectedTint=$(this).find("option:selected");$.FrameFitUtils.pdpTintTryon(selectedTint)}}),$("#lensFormId").find("span.radio").live("click",function(e){var selectedTint=$(this).closest("dl").find("select > option:selected");$.FrameFitUtils.pdpTintTryon(selectedTint)}),$("#lensTintChoose").length>0){var checkedRadio=$("#lensTintChoose").find(".radio.checked");if(1==checkedRadio.length){var selectedTint=checkedRadio.closest("dl").find("option:selected");$.FrameFitUtils.pdpTintTryon(selectedTint)}}var mouseLeaveEvent=!1;$(".categoryList .catgTryon").live("click",function(e){var clickedEl=$(this);mouseLeaveEvent=!1;var prodItem=clickedEl.closest(".prodItem");if(!prodItem.hasClass("eGC")&&!prodItem.hasClass("accessory")){var isFavPage=!1,colorLink=clickedEl.closest(".thumbOver").find(".colorBox a.recently");$(this).closest(".categoryList").parent().hasClass("favCov")&&0==colorLink.length&&(isFavPage=!0);var skuId,promise;if(isFavPage){var skuData=$(this).closest(".btnBox").find("a.btnQuickView");skuData={skuId:skuData.data("skuid")},skuId=skuData.skuId;var colorLinkNon,shapeId;promise=$.FrameFitUtils.ffCatgTryon($(".frameFit_carousel .ffCarouselContent > ul > .carouselItem.currentItem"),colorLinkNon,shapeId,!0,skuId)}else promise=$.FrameFitUtils.ffCatgTryon($(".frameFit_carousel .ffCarouselContent > ul > .carouselItem.currentItem"),colorLink);$(".carouselItem.currentItem").find(".delBox").show(),$(window).width()<735&&(promise?promise.done(function(){clickedEl.acsPopup({popupSelector:".ffCov",popupID:"frameFitModal",callBack:function(){$.FrameFitUtils.initFrameFit($("#frameFitModal .frameFit")),$.FrameFitUtils.initFrameFitHeight($("#frameFitModal .frameFit").find(".ffCarouselContent > ul")),$(".popupContent .frameFit_container .favorites.tabs").acsTabs({tabTitle:"tabTitle",tabContent:"tabContent",tabItem:"tabItem",tabTitleActive:"recently"})}})}):clickedEl.acsPopup({popupSelector:".ffCov",popupID:"frameFitModal",callBack:function(){$.FrameFitUtils.initFrameFit($("#frameFitModal .frameFit")),$.FrameFitUtils.initFrameFitHeight($("#frameFitModal .frameFit").find(".ffCarouselContent > ul")),$(".popupContent .frameFit_container .favorites.tabs").acsTabs({tabTitle:"tabTitle",tabContent:"tabContent",tabItem:"tabItem",tabTitleActive:"recently"})}}))}}),enquire.register("screen and (min-width: 721px)",{match:function(){$(".categoryList .prodItem .thumbOver").live("mouseenter.framefit",function(){if($(this).parent().hasClass("eGC")||$(this).parent().hasClass("accessory"))return void(mouseLeaveEvent=!1);mouseLeaveEvent=!0;var $frameFit=$(".frameFit.catg .currentItem"),isFavPage=!1;$(this).closest(".categoryList").parent().hasClass("favCov")&&(isFavPage=!0);var data;if(isFavPage){var dataObj=$(this).find("ul:first .recently input").length&&$(this).find("ul:first .recently input")||$(this).find("ul:first > input");data={distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy")}}else{var dataObj=$(this).find("li.colorBox").find("a.recently input");data={image:dataObj.data("image"),distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy"),hoverImage:dataObj.data("hoverimage"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew"),onSale:dataObj.data("onsale"),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus"),color:dataObj.data("color")}}var ratioScale=data.ratioScale;ratioScale||(ratioScale=894);var distance=data.distance;distance||(distance=126);var liy=data.liy;liy||(liy=93);var frameSkuId=$(this).find("li.colorBox").find("a.recently").attr("skuid");isFavPage&&(frameSkuId=$(this).find("ul:first p.skuId").text()||data.skuId.toString(),0==frameSkuId.indexOf("#")&&(frameSkuId=frameSkuId.substring(1))),$.FrameFitUtils.tentativeTryon($frameFit,frameSkuId,ratioScale,distance,liy),$frameFit.find(".delBox").hide()}).live("mouseleave",function(){if(mouseLeaveEvent){var $frameFit=$(".frameFit.catg .currentItem");$.FrameFitUtils.retrievePreviousTryon($frameFit),$frameFit.find(".delBox").show()}})},unmatch:function(){$(".categoryList .prodItem .thumbOver").die("mouseenter.framefit")}}),$(".visualSearchCon .itemList .item").live("mouseenter.framefit",function(){var url="",dynamicFrameFitFlag=$.trim($(this).find("input[name=dynamicFrameFitFlag]").data("value"));if(dynamicFrameFitFlag){var FrameFitParams=$(this).find("input[name=dynamicFrameFitParams]"),data={headSkuId:FrameFitParams.data("skuid"),headSkuDistance:FrameFitParams.data("distance"),headSkuRatioScale:FrameFitParams.data("ratioscale"),headSkuLiy:FrameFitParams.data("liy")},skuId=data.headSkuId.toString(),ratioScale=data.headSkuRatioScale;ratioScale||(ratioScale=894);var distance=data.headSkuDistance;distance||(distance=126);var liy=data.headSkuLiy;liy||(liy=93),url=$.FrameFitUtils.constructTryonImgUrl(skuId,"small",ratioScale,distance,liy,"","","")}else url=$.trim($(this).find("input[name=frameFitUrl]").data("value"));if(url.length>0){var $frameFit=$(".frameFit.catg .currentItem");$.FrameFitUtils.tentativeVSTryon($frameFit,url),$frameFit.find(".delBox").hide()}}).live("mouseleave",function(){var $frameFit=$(".frameFit.catg .currentItem");$.FrameFitUtils.retrievePreviousTryon($frameFit),$frameFit.find(".delBox").show()}),$(".categoryList .prodItem .thumbOver .colorBox a").live("click",function(){var $frameFit=$(".frameFit.catg .currentItem"),dataObj=$(this).find('input[name="colorBox"]'),data={image:dataObj.data("image"),distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy"),hoverImage:dataObj.data("hoverimage"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew"),onSale:dataObj.data("onsale"),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus"),color:dataObj.data("color")},skuId=$(this).attr("skuid")||data.skuId;0==skuId.indexOf("#")&&(skuId=skuId.substring(1));var ratioScale=data.ratioScale;ratioScale||(ratioScale=894);var distance=data.distance;distance||(distance=126);var liy=data.liy;liy||(liy=93),$.FrameFitUtils.tentativeTryon($frameFit,skuId,ratioScale,distance,liy)}),$("body").on("mouseenter",".categoryList .prodItem .colorBox a",function(){var $frameFit=$(".frameFit.catg .currentItem"),skuId=$(this).attr("skuid"),dataObj=$(this).closest(".prodItem").find('.thumbOver .colorBox a[skuid="'+skuId+'"] input'),data={image:dataObj.data("image"),distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy"),hoverImage:dataObj.data("hoverimage"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew"),onSale:dataObj.data("onsale"),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus"),color:dataObj.data("color")};0==skuId.indexOf("#")&&(skuId=skuId.substring(1));var ratioScale=data.ratioScale;ratioScale||(ratioScale=894);var distance=data.distance;distance||(distance=126);var liy=data.liy;liy||(liy=93),$.FrameFitUtils.tentativeTryon($frameFit,skuId,ratioScale,distance,liy),$frameFit.find(".delBox").hide()}).on("mouseleave",".categoryList .prodItem .colorBox a",function(){if($(this).closest(".thumbOver").size()<1){var $frameFit=$(".frameFit.catg .currentItem");$.FrameFitUtils.retrievePreviousTryon($frameFit),$frameFit.find(".delBox").show()}else{var $frameFit=$(".frameFit.catg .currentItem"),activeLink=$(this).parent().find("a.recently"),skuId=activeLink.attr("skuid")||data.skuId,dataObj=$(this).closest(".prodItem").find('.thumbOver .colorBox a[skuid="'+skuId+'"] input'),data={image:dataObj.data("image"),distance:dataObj.data("distance"),ratioScale:dataObj.data("ratioscale"),liy:dataObj.data("liy"),hoverImage:dataObj.data("hoverimage"),skuId:dataObj.data("skuid"),isNew:dataObj.data("isnew"),onSale:dataObj.data("onsale"),url:dataObj.data("url"),stockStatus:dataObj.data("stockstatus"),color:dataObj.data("color")};0==skuId.indexOf("#")&&(skuId=skuId.substring(1));var ratioScale=data.ratioScale;ratioScale||(ratioScale=894);var distance=data.distance;distance||(distance=126);var liy=data.liy;liy||(liy=93),$.FrameFitUtils.tentativeTryon($frameFit,skuId,ratioScale,distance,liy)}}),$(".categoryList .qvCon .colorCon a").live("click",function(){var shapeId,$frameFit=$(".frameFit.catg .currentItem"),lensImg=$(this).closest(".qvCon").find("span.lensImg > img");1==lensImg.length&&(shapeId=lensImg.attr("name")),$.FrameFitUtils.ffCatgTryon($frameFit,$(this),shapeId)}),$(".favorites").find(".carouselItem a.tryon").live("click",function(e){e.preventDefault(),$.FrameFitUtils.tryonMyFavorite($(this))});var oldSize=$("#mainSection").width();$(window).bind("resize",function(e){$("#mainSection").width()==oldSize||720!=$("#mainSection").width()&&960!=$("#mainSection").width()||!$(".frameFit").hasClass("compareBox")||($(".frameFit").find(".close").trigger("click"),oldSize=$("#mainSection").width())}),$(".r_prodPanel .tabTitle .tabUnit a").live("click",function(event){event.preventDefault(),event.stopPropagation()})}),function(){$("body").on("touchstart.showhide",".showHide",function(e){e.preventDefault();var trigger=$(this);trigger.toggleClass("showHide-displayed").siblings().slideToggle()})}(),$(function(){function populateCartContents(data,content,mobile){data.mobile=mobile,$.ajax({beforeSend:function(){content.addClass("responsive_table-loading").empty()},url:"/misc/ajax/responsive_table-ajax.jsp?randomKey="+Math.random(),data:data,success:function(data){content.html(data).removeClass("responsive_table-loading")}})}var tables=$(".responsive_table");$.each(tables,function(index,el){var $el=$(el),content=$el.find(".responsive_table-content"),pageData=$el.data("responsive")||{};pageData.page=$el.data("page"),($(".hideLt768").size()<=0||$(".hideLt768").size()>0&&!$(".hideLt768").is(":visible"))&&enquire.register("screen and (max-width: 840px)",{match:function(){populateCartContents(pageData,content,!0)},unmatch:function(){populateCartContents(pageData,content,!1)}}),$("body").width()>840&&content.removeClass("responsive_table-loading")})}),$(function(){var SS,ScreenSlide=function(){return arguments.callee._singletonInstance?arguments.callee._singletonInstance:(arguments.callee._singletonInstance=this,SS=this,SS.defaults={url:"",callback:function(){},data:{},fullWidth:!1},SS)};ScreenSlide.prototype={init:function(){var body=$("body");SS.root=$('<aside class="screen_slide-root"><figure class="screen_slide-loader"></figure><a  href="#" class="screen_slide-close"></a><div class="screen_slide-content"></div></aside>'),body.append(SS.root),SS.content=$(".screen_slide-content"),SS.root.on("click",".js-screen_slide-close",SS.close)},isActive:function(){return SS.root.hasClass("screen_slide-active")},open:function(options){var opts=$.extend({},SS.defaults,options);if(SS.root||SS.init(),SS.isActive())SS.close(function(){SS.open(options)});else{var rootClass=opts.fullWidth?"screen_slide-active_full":"screen_slide-active";SS.root.addClass(rootClass),SS.request(opts.url,opts.data).done(function(){opts.callback()}),$("#wrapper, .popupLayerBg").one("click",SS.close)}},close:function(e){"object"==typeof e?e.preventDefault():"function"==typeof e&&SS.root.one(SS.whichTransitionEvent(),e),SS.root.attr("class","screen_slide-root")},request:function(url,data){return $.ajax({url:url,data:data,beforeSend:function(){SS.root.addClass("screen_slide-loading"),SS.content.empty(),SS.content.hide()},complete:function(){SS.root.removeClass("screen_slide-loading")},success:function(data){SS.content.html(data),SS.content.fadeIn(200)}})},whichTransitionEvent:function(){var t,el=document.createElement("fakeelement"),transitions={transition:"transitionend",OTransition:"oTransitionEnd",MozTransition:"transitionend",WebkitTransition:"webkitTransitionEnd"};for(t in transitions)if(void 0!==el.style[t])return transitions[t]}},$.CommonUtils.screenSlide=new ScreenSlide}),$(function(){function Tabs(el){this.root=el,this.triggers=this.root.find(".tabs-navigation li"),this.triggers.on("click",this,this.handleTabClick)}function initTabs(){var tabContainers=$(".js-tabs").not(".tabs-active");$.each(tabContainers,function(index,el){var $el=$(el),instance=new Tabs($el);$el.data("tabs",instance).addClass("tabs-active")})}Tabs.prototype={handleTabClick:function(e){e.preventDefault();var trigger=$(this),tabsInstance=e.data,target=tabsInstance.root.find(".tab-"+trigger.find("a").data("target"));tabsInstance.root.find(".tabs-content").removeClass("tabs-active_content"),tabsInstance.triggers.removeClass("tabs-active_tab"),trigger.addClass("tabs-active_tab"),target.addClass("tabs-active_content"),trigger.trigger("tab-switch")}},initTabs(),$.CommonUtils.tabs=initTabs}),$(function(){function PDMeasure(){return arguments.callee._singletonInstance?arguments.callee._singletonInstance:(arguments.callee._singletonInstance=this,PD=this,PD.mobile=PD.isMobile(),PD.coords={},PD.dom={},PD.values={},void(PD.svgSupported()&&PD.initPD()))}var PD;PDMeasure.prototype={initPD:function(){var body=$("body");body.addClass("pd_measure-display"),PD.mobile?body.on("click",".pd_measure-init",PD.switchPage("info-1")):body.on("click",".pd_measure-init",PD.switchPage("desktop-capture"))},svgSupported:function(){return!!document.createElementNS&&!!document.createElementNS("http://www.w3.org/2000/svg","svg").createSVGRect},attachHandlers:function(){PD.root.unbind(".pd"),PD.root.on("click.pd",".pd_measure-next_btn",PD.switchPage("info-2")),PD.root.on("click.pd",".js-pd_upload_photo",PD.handleTakePhoto),PD.root.on("click.pd",".pd-webcam_btn",PD.switchPage("desktop-capture")),PD.root.on("change.pd",".pd-take_photo_input",PD.processImage),PD.root.on("click.pd",".pd-upload_photo",PD.processImage),PD.root.on("click.pd",".pd_measure-confirm_btn",PD.confirmPD),PD.root.on("click.pd",".pd_measure-retake_btn",PD.handleTakePhoto)},switchPage:function(page,data){var pageInfo=PD.pageRouter(page,data);return PD.mobile?PD.switchPageSlide(pageInfo):PD.switchPageModal(pageInfo)},switchPageSlide:function(pageInfo){return function(e){e&&e.preventDefault(),$.CommonUtils.screenSlide.open({url:pageInfo.url,data:pageInfo.data,callback:function(){pageInfo.callback&&pageInfo.callback()}})}},switchPageModal:function(pageInfo){return function(e){e&&e.preventDefault(),$.fn.acsPopup({popupSrc:pageInfo.url,maxWidth:pageInfo.modalWidth,maxHeight:pageInfo.modalHeight,hideTitle:!0,popupLayerCov:"popupCov",jsonData:pageInfo.data,popupLayerBg:"popupLayerBg acspopup",callBack:function(){$(".popupClose").unbind().on("click",function(e){e.preventDefault(),$(".popupLayerBg.acspopup").click()}),pageInfo.callback&&pageInfo.callback()}})}},pageRouter:function(page,data){var pageInfo={"info-1":{url:"/misc/ajax/PDMeasure/1_PD_info-step_1.jsp",callback:function(){PD.root=$(".pd_measure-container").parent(),PD.attachHandlers()}},"info-2":{url:"/misc/ajax/PDMeasure/2_PD_info-step_2.jsp"},measure_pd:{url:"/misc/ajax/PDMeasure/3_PD_measure.jsp",modalWidth:500,modalHeight:"auto",callback:function(){$(".pd-measure_ui").css("max-height",window.innerHeight-100+"px").append(data.image),PD.cacheCommonDOM(),PD.values.headerHeight=PD.dom.heading.outerHeight(),$(".screen_slide-root, .popupContent").addClass("pd-measure_tool"),PD.zoomInit(data),PD.svgInit(data)}},"desktop-capture":{url:"/misc/ajax/PDMeasure/4_PD_desktop-capture.jsp",modalWidth:760,modalHeight:500,data:{origin:"pd"},callback:function(){$(".pd-take_photo_input")[0].files||$(".pd_measure-upload_photo_btn").addClass("hidden"),PD.root=$(".popupCov"),PD.attachHandlers(),PD.cacheCommonDOM(),$(".ffUpload.camera").addClass("pd-desktop_capture"),$(".capture").live("click",function(){PD.initiateDesktopCapture()}),window.initWebcam()}}};return pageInfo[page]},handleTakePhoto:function(e){e&&e.preventDefault(),$(".pd-take_photo_input").click()},processImage:function(e){var img=document.createElement("img"),pageData={};if($(img).addClass("pd-captured_image"),this.files){var fr=new FileReader,file=this.files[0];pageData.imageName=file.name,fr.onloadend=function(){img.src=pageData.imageUri=fr.result,pageData.image=img,PD.switchPage("measure_pd",pageData)()},fr.readAsDataURL(file),PD.readEXIF(file)}},initiateDesktopCapture:function(){webcam.capture();var img=document.createElement("img"),canvas=$(".webcam_capture-canvas")[0],url=canvas.toDataURL("image/jpeg",.9),pageData={imageUri:url,name:"webcam-capture"};$(".pd_ui").removeClass("hidden"),PD.values.headerHeight=PD.dom.heading.outerHeight(),img.src=url,pageData.image=img,$(img).css({left:"-999999px",position:"absolute"}),img.onload=function(){PD.zoomInit(pageData),$(img).remove(),PD.svgInit(pageData)},$(".pd-measure_ui").append(img),PD.switchButtons($(".pd-desktop_capture_btn"),$(".pd-desktop_retake_btn"))},switchButtons:function(toHide,toShow){toShow.is(":hidden")&&(toHide.hide(),toShow.show())},readEXIF:function(file){var fr=new FileReader;fr.onloadend=function(){PD.values.exif=EXIF.readFromBinaryFile(new BinaryFile(this.result)),PD.values.curve=PD.curveByFocalLength()},fr.readAsBinaryString(file)},svgInit:function(pageData){$("#pd_ui-crosshair_left, #pd_ui-crosshair_right").on("mousedown touchstart",PD.svgMoveStart(PD.svgPupilMove)),$("#pd_ui-crosshair_cc_left, #pd_ui-crosshair_cc_right").on("mousedown touchstart",PD.svgMoveStart(PD.svgCCMove)),PD.dom.svg.width(PD.dom.capturedImage.width()+"px"),PD.dom.svg.height(PD.dom.capturedImage.height()-PD.values.headerHeight+"px"),PD.cacheCommonCoords(),pageData&&pageData.imageUri?PD.ajaxLocatePupils(pageData).always(function(data){PD.svgPlacePupils(PD.parsePupilData(data)),PD.svgPlaceCC(PD.parseCcData(data))}):(PD.svgPlacePupils(),PD.svgPlaceCC())},ajaxLocatePupils:function(data){return $.ajax({url:"//74.201.58.51/recognizepd.php",beforeSend:function(){$('<figure class="pd-pupil_loading"></figure>').appendTo(".pd-measure_ui_container")},complete:function(){$(".pd-pupil_loading").remove()},cors:!0,type:"POST",dataType:"json",data:{image:data.imageUri.match(/,(.*)$/)[1],base64:"true",name:data.name}})},parsePupilData:function(data){if("object"==typeof data&&data.pupil){var left=PD.findMidpoint(data.pupil.leftCoords),right=PD.findMidpoint(data.pupil.rightCoords);return[_.map(left,PD.transformPoints),_.map(right,PD.transformPoints)]}},parseCcData:function(data){if("object"==typeof data&&data.cc)return[_.map(data.cc.stripCoords[1],PD.transformPoints),_.map(data.cc.stripCoords[0],PD.transformPoints)]},transformPoints:function(point,index){var transformed=Math.round(1/PD.values.imageRatio*point);return 1===index&&(transformed-=PD.values.headerHeight),transformed},findMidpoint:function(points){return[(points[0][0]+points[1][0])/2,(points[0][1]+points[1][1])/2]},svgMoveStart:function(moveHandler){return function(e){e.preventDefault(),PD.dom.target=$(this),PD.dom.siblingTarget=PD.dom.target.siblings("g").eq(0),PD.coords.mouseStartX=e.pageX||e.originalEvent.targetTouches[0].pageX,PD.coords.mouseStartY=e.pageY||e.originalEvent.targetTouches[0].pageY,PD.dom.svg.on("mousemove touchmove",function(mmEvent){PD.svgMove(mmEvent,moveHandler)}),$("body").on("mouseup touchend",function(muEvent){muEvent.preventDefault(),PD.dom.svg.unbind("mousemove touchmove"),$(this).unbind("mouseup touchend")})}},svgMove:function(e,moveHandler){e&&e.preventDefault&&e.preventDefault(),PD.coords.mouseCurrentX=e.pageX||e.originalEvent.targetTouches[0].pageX,PD.coords.mouseCurrentY=e.pageY||e.originalEvent.targetTouches[0].pageY,moveHandler(e),PD.zoomScroll(),PD.updatePDDisplay(),PD.coords.mouseStartX=PD.coords.mouseCurrentX,PD.coords.mouseStartY=PD.coords.mouseCurrentY},svgPlaceCC:function(ccCoords){var svgWidth=PD.dom.svg.width(),svgHeight=PD.dom.svg.height(),ccLeftEnd=ccCoords?ccCoords[0]:[svgWidth/2-60,Math.round(.7*svgHeight)],ccRightEnd=ccCoords?ccCoords[1]:[svgWidth/2+60,ccLeftEnd[1]];PD.svgMoveCrosshairToPoint(PD.dom.ccCrosshairLeft,PD.svgCrosshairCalculateCenter(PD.dom.ccCrosshairLeft),ccLeftEnd),PD.svgMoveCrosshairToPoint(PD.dom.ccCrosshairRight,PD.svgCrosshairCalculateCenter(PD.dom.ccCrosshairRight),ccRightEnd)},svgPlacePupils:function(pupilCoords){var svgWidth=PD.dom.svg.width(),svgHeight=PD.dom.svg.height(),pupilLeftEnd=pupilCoords?[pupilCoords[0][0],pupilCoords[0][1]]:[svgWidth/2-60,Math.round(.3*svgHeight)],pupilRightEnd=pupilCoords?[pupilCoords[1][0],pupilCoords[1][1]]:[svgWidth/2+60,pupilLeftEnd[1]];PD.svgMoveCrosshairToPoint(PD.dom.pupilCrosshairLeft,PD.svgCrosshairCalculateCenter(PD.dom.pupilCrosshairLeft),pupilLeftEnd),PD.svgMoveCrosshairToPoint(PD.dom.pupilCrosshairRight,PD.svgCrosshairCalculateCenter(PD.dom.pupilCrosshairRight),pupilRightEnd)},svgMoveCrosshairToPoint:function(target,startPoint,endPoint){var ident=target.attr("id"),type=ident.indexOf("_cc_")>=0?"cc":"pupil",map={pupil:{handler:PD.svgPupilMove},cc:{handler:PD.svgCCMove}};PD.dom.target=target,PD.dom.siblingTarget=target.siblings("g").eq(0),PD.coords.mouseStartX=startPoint[0],PD.coords.mouseStartY=startPoint[1],PD.svgMove({pageX:endPoint[0],pageY:endPoint[1]},map[type].handler)},svgPupilMove:function(e){e&&e.preventDefault&&e.preventDefault(),PD.svgMoveCrosshair(PD.dom.target,"xy"),PD.svgMoveCrosshair(PD.dom.siblingTarget,"y"),PD.cacheCommonCoords(),PD.svgMoveCrosshairConnector(),PD.svgMoveVerticalConnector(),PD.svgMoveTextboxes()},svgCCMove:function(e){e&&e.preventDefault&&e.preventDefault(),PD.svgMoveCrosshair(PD.dom.target,"xy"),PD.svgMoveCrosshair(PD.dom.siblingTarget,"y"),PD.cacheCommonCoords(),PD.svgMoveCCconnector()},svgMoveCrosshair:function(target,axis){var offsets=[0,0];"x"!==axis&&"xy"!==axis||(offsets[0]=PD.coords.mouseCurrentX-PD.coords.mouseStartX),"y"!==axis&&"xy"!==axis||(offsets[1]=PD.coords.mouseCurrentY-PD.coords.mouseStartY),PD.svgTranslateTo(target,offsets)},svgMoveCrosshairConnector:function(){PD.dom.pupilCrosshairConnector.attr("x1",PD.coords.pupilCrosshairLeftVertical[0]).attr("y1",PD.coords.pupilCrosshairLeftVertical[1]).attr("x2",PD.coords.pupilCrosshairRightVertical[0]).attr("y2",PD.coords.pupilCrosshairRightVertical[1])},svgMoveVerticalConnector:function(){var xOffset=(PD.coords.pupilCrosshairRightVertical[0]-PD.coords.pupilCrosshairLeftVertical[0])/2+PD.coords.pupilCrosshairLeftVertical[0];PD.dom.verticalConnector.attr("x1",xOffset).attr("x2",xOffset).attr("y2",PD.coords.pupilCrosshairRightVertical[1])},svgMoveCCconnector:function(){PD.dom.ccConnector.attr("x1",PD.coords.ccCrosshairCircleLeft[0]).attr("y1",PD.coords.ccCrosshairCircleLeft[1]).attr("x2",PD.coords.ccCrosshairCircleRight[0]).attr("y2",PD.coords.ccCrosshairCircleRight[1])},svgMoveTextboxes:function(){PD.dom.pupilTextboxLeft.attr("x",parseInt(PD.dom.verticalConnector.attr("x1"),10)-58).attr("y",PD.coords.pupilCrosshairLeftVertical[1]-20),PD.dom.pupilTextboxRight.attr("x",parseInt(PD.dom.verticalConnector.attr("x1"),10)+12).attr("y",PD.coords.pupilCrosshairRightVertical[1]-20)},updatePDDisplay:function(){var calculatedPD=PD.calculatePD();dualPDDisplay=calculatedPD/2+"mm",PD.dom.pupilDistanceDisplay.text(calculatedPD),PD.dom.pupilTextboxRight.text(dualPDDisplay),PD.dom.pupilTextboxLeft.text(dualPDDisplay)},calculatePD:function(){var pixelsToMM=Math.abs(PD.coords.ccCrosshairCircleLeft[0]-PD.coords.ccCrosshairCircleRight[0])/86,initialPD=Math.round(Math.abs(PD.coords.pupilCrosshairRightVertical[0]-PD.coords.pupilCrosshairLeftVertical[0])/pixelsToMM),curve=PD.values.curve||4;return Math.round(initialPD+curve)},curveByFocalLength:function(){var length=parseFloat(PD.values.exif.FocalLength,10);return length<=5?-.5*length+9.425:0},zoomInit:function(data){var img=data.image,actualDimensions=[img.naturalWidth,img.naturalHeight],currentDimensions=[img.clientWidth,img.clientHeight];PD.values.imageRatio=actualDimensions[0]/currentDimensions[0],
PD.dom.zoomWindow.css("background-image","url("+data.imageUri+")")},zoomScroll:function(){var centerCoords=PD.svgCrosshairCalculateCenter(PD.dom.target),zoomCoords=_.map([centerCoords[0]+1,centerCoords[1]+PD.values.headerHeight-1],function(index){return(Math.round(index*PD.values.imageRatio)-34)*-1});PD.dom.zoomWindow.css("background-position",zoomCoords[0]+"px "+(zoomCoords[1]+"px"))},svgCrosshairCalculateCenter:function(target){var ident=target.attr("id"),type=ident.indexOf("_cc_")>=0?"cc":"pupil",side=ident.indexOf("right")>=0?"right":"left",map={pupil:{right:PD.coords.pupilCrosshairRightHorizontal,left:PD.coords.pupilCrosshairLeftHorizontal},cc:{right:PD.coords.ccCrosshairCircleRight,left:PD.coords.ccCrosshairCircleLeft}},coords=map[type][side];return"pupil"===type&&(coords=[(coords[2]-coords[0])/2+coords[0],coords[1]]),coords},svgTranslateTo:function(target,offsets){var currentTranslate=PD.parseTranslate(target.attr("transform")),translateX=currentTranslate[0]+offsets[0],translateY=Math.round(currentTranslate[1]+offsets[1]);target.attr("transform","translate("+translateX+" "+translateY+")")},getTransformAttr:function(){return"transform"},calculateCoords:function(element,shape,transformParent){var shapeAttributes="circle"===shape?["cx","cy"]:["x1","y1","x2","y2"],translate=PD.parseTranslate(transformParent.attr("transform"));return _.map(shapeAttributes,function(attr){var index=attr.indexOf("x")>=0?0:1;return parseInt(element.attr(attr),10)+translate[index]})},cacheCommonDOM:function(){PD.dom.svg=$("#pd_ui-svg"),PD.dom.capturedImage=$(".pd-captured_image"),PD.dom.zoomWindow=$(".pd_ui-zoom_window"),PD.dom.heading=$(".pd_ui-heading"),PD.dom.pupilCrosshairRight=$("#pd_ui-crosshair_right"),PD.dom.pupilCrosshairLeft=$("#pd_ui-crosshair_left"),PD.dom.pupilCrosshairRightVertical=$("#pd_ui-crosshair_right_vertical"),PD.dom.pupilCrosshairLeftVertical=$("#pd_ui-crosshair_left_vertical"),PD.dom.pupilCrosshairRightHorizontal=$("#pd_ui-crosshair_right_horizontal"),PD.dom.pupilCrosshairLeftHorizontal=$("#pd_ui-crosshair_left_horizontal"),PD.dom.pupilTextboxLeft=$("#pd_ui-pd_left"),PD.dom.pupilTextboxRight=$("#pd_ui-pd_right"),PD.dom.pupilCrosshairConnector=$("#pd_ui-crosshair_connector"),PD.dom.verticalConnector=$("#pd_ui-vertical_connector"),PD.dom.ccCrosshairCircleLeft=$("#pd_ui-cc_circle_left"),PD.dom.ccCrosshairCircleRight=$("#pd_ui-cc_circle_right"),PD.dom.ccCrosshairRight=$("#pd_ui-crosshair_cc_right"),PD.dom.ccCrosshairLeft=$("#pd_ui-crosshair_cc_left"),PD.dom.ccConnector=$("#pd_ui-cc_connector"),PD.dom.pupilDistanceDisplay=$(".pd_ui-distance")},cacheCommonCoords:function(){PD.coords.pupilCrosshairRightVertical=PD.calculateCoords(PD.dom.pupilCrosshairRightVertical,"line",PD.dom.pupilCrosshairRight),PD.coords.pupilCrosshairLeftVertical=PD.calculateCoords(PD.dom.pupilCrosshairLeftVertical,"line",PD.dom.pupilCrosshairLeft),PD.coords.pupilCrosshairRightHorizontal=PD.calculateCoords(PD.dom.pupilCrosshairRightHorizontal,"line",PD.dom.pupilCrosshairRight),PD.coords.pupilCrosshairLeftHorizontal=PD.calculateCoords(PD.dom.pupilCrosshairLeftHorizontal,"line",PD.dom.pupilCrosshairLeft),PD.coords.ccCrosshairCircleLeft=PD.calculateCoords(PD.dom.ccCrosshairCircleLeft,"circle",PD.dom.ccCrosshairLeft),PD.coords.ccCrosshairCircleRight=PD.calculateCoords(PD.dom.ccCrosshairCircleRight,"circle",PD.dom.ccCrosshairRight)},confirmPD:function(){for(var pupilDistance=$.trim($(".pd_ui-distance").text()),select=$(".pd-confirm_select"),options=select.find("option"),i=0;i<options.size();i++)if(options.eq(i).val()===pupilDistance){select[0].selectedIndex=i,select.trigger("change");break}PD.root.find(".popupClose, .close").click()},parseTranslate:function(str){var arr=str?str.slice(10,-1).split(" "):[0,0];return _.map(arr,PD.arrayParseInt)},arrayParseInt:function(str){return parseInt(str,10)},isMobile:function(){return document.body.clientWidth<=735}},new PDMeasure});